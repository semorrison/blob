%!TEX root = ../blob1.tex
\nn{Not sure where this goes yet: small blobs, unfinished:}

Fix $\cU$, an open cover of $M$. Define the `small blob complex' $\bc^{\cU}_*(M)$ to be the subcomplex of $\bc_*(M)$ of all blob diagrams in which every blob is contained in some open set of $\cU$. Say that an open cover $\cV$ is strictly subordinate to $\cU$ if the closure of every open set of $\cV$ is contained in some open set of $\cU$.

\begin{lem}
\label{lem:CH-small-blobs}
Fix an open cover $\cU$, and a sequence $\cV_k$ of open covers which are each strictly subordinate to $\cU$. \nn{Do, perhaps, the $\cV_k$ have to form a strictly subordinate sequence?} For a given $k$, consider $\cG_k$ the subspace of $C_k(\Homeo(M)) \tensor \bc_*(M)$ spanned by $f \tensor b$, where $f:P^k \times M \to M$ is a $k$-parameter family of homeomorphisms such that for each $p \in P$, $f(p, -)$ makes $b$ small with respect to $\cV_k$. We can choose an up-to-homotopy representative $\ev$ of the chain map of Property \ref{property:evaluation} which gives the action of families of homeomorphisms, which restricts to give a map
$$\ev : \cG_k \subset C_k(\Homeo(M)) \tensor \bc_*(M) \to \bc^{\cU}_*(M)$$
for each $k$.
\end{lem}
\begin{rem}
We can't quite do the same with all $\cV_k$ just equal to $\cU$, but we can get by if we give ourselves arbitrarily little room to maneuver, by making the blobs we act on slightly smaller.
\end{rem}
\begin{proof}
We choose yet another open cover, $\cW$, which so fine that the union (disjoint or not) of any one open set $V \in \cV$ with $k$ open sets $W_i \in \cW$ is contained in a disjoint union of open sets of $\cU$.
Now, in the proof of Proposition \ref{CHprop}
\todo{I think I need to understand better that proof before I can write this!}
\end{proof}

\begin{thm}[Small blobs]
The inclusion $i: \bc^{\cU}_*(M) \into \bc_*(M)$ is a homotopy equivalence.
\end{thm}
\begin{proof}
We begin by describing the homotopy inverse in small degrees, to illustrate the general technique.
We will construct a chain map $s:  \bc_*(M) \to \bc^{\cU}_*(M)$ and a homotopy $h:\bc_*(M) \to \bc_{*+1}(M)$ so that $\bdy h+h \bdy=i\circ s - \id$. The composition $s \circ i$ will just be the identity.

On $0$-blobs, $s$ is just the identity; a blob diagram without any blobs is compatible with any open cover. Nevertheless, we'll begin introducing nomenclature at this point: for configuration $\beta$ of disjoint embedded balls in $M$ we'll associate a one parameter family of homeomorphisms $\phi_\beta : \Delta^1 \to \Homeo(M)$ (here $\Delta^m$ is the standard simplex $\setc{\mathbf{x} \in \Real^{m+1}}{\sum_{i=0}^m x_i = 1}$). For $0$-blobs, where $\beta = \eset$, all these homeomorphisms are just the identity.

When $\beta$ is a collection of disjoint embedded balls in $M$, we say that a homeomorphism of $M$ `makes $\beta$ small' if the image of each ball in $\beta$ under the homeomorphism is contained in some open set of $\cU$. Further, we'll say a homeomorphism `makes $\beta$ $\epsilon$-small' if the image of each ball is contained in some open ball of radius $\epsilon$.

On a $1$-blob $b$, with ball $\beta$, $s$ is defined as the sum of two terms. Essentially, the first term `makes $\beta$ small', while the other term `gets the boundary right'. First, pick a one-parameter family $\phi_\beta : \Delta^1 \to \Homeo(M)$ of homeomorphisms, so $\phi_\beta(1,0)$ is the identity and $\phi_\beta(0,1)$ makes the ball $\beta$ small --- in fact, not just small with respect to $\cU$, but $\epsilon/2$-small, where $\epsilon > 0$ is such that every $\epsilon$-ball is contained in some open set of $\cU$. Next, pick a two-parameter family $\phi_{\eset \prec \beta} : \Delta^2 \to \Homeo(M)$ so that $\phi_{\eset \prec \beta}(0,x_1,x_2)$ makes the ball $\beta$ $\frac{3\epsilon}{4}$-small for all $x_1+x_2=1$, while $\phi_{\eset \prec \beta}(x_0,0,x_2) = \phi_\eset(x_0,x_2)$ and $\phi_{\eset \prec \beta}(x_0,x_1,0) = \phi_\beta(x_0,x_1)$. (It's perhaps not obvious that this is even possible --- see Lemma \ref{lem:extend-small-homeomorphisms} below.) We now define $s$ by
$$s(b) = \restrict{\phi_\beta}{x_0=0}(b) + \restrict{\phi_{\eset \prec \beta}}{x_0=0}(\bdy b).$$
Here, $\restrict{\phi_\beta}{x_0=0} = \phi_\beta(0,1)$ is just a homeomorphism, which we apply to $b$, while $\restrict{\phi_{\eset \prec \beta}}{x_0=0}$ is a one parameter family of homeomorphisms which acts on the $0$-blob $\bdy b$ to give a $1$-blob. To be precise, this action is via the chain map identified in Lemma \ref{lem:CH-small-blobs} with $\cV_0$ the open cover by $\epsilon/2$-balls and $\cV_1$ the open cover by $\frac{3\epsilon}{4}$-balls. From this, it is immediate that $s(b) \in \bc^{\cU}_1(M)$, as desired.

We now check that $s$, as defined so far, is a chain map, calculating
\begin{align*}
\bdy (s(b)) & = \restrict{\phi_\beta}{x_0=0}(\bdy b) + (\bdy \restrict{\phi_{\eset \prec \beta}}{x_0=0})(\bdy b) \\
		 & = \restrict{\phi_\beta}{x_0=0}(\bdy b) + \restrict{\phi_\eset}{x_0=0}(\bdy b) - \restrict{\phi_\beta}{x_0=0}(\bdy b) \\
		 & = \restrict{\phi_\eset}{x_0=0}(\bdy b) \\
		 & = s(\bdy b)
\end{align*}
Next, we compute the compositions $s \circ i$ and $i \circ s$. If we start with a small $1$-blob diagram $b$, first include it up to the full blob complex then apply $s$, we get exactly back to $b$, at least assuming we adopt the convention that for any ball $\beta$ which is already small, we choose the families of homeomorphisms $\phi_\beta$ and $\phi_{\eset \prec \beta}$ to always be the identity. In the other direction, $i \circ s$, we will need to construct a homotopy $h:\bc_*(M) \to \bc_{*+1}(M)$ for $*=0$ or $1$.

The homotopy $h$ is defined by $$h(b) = \phi_\eset(b)$$ when $b$ is a $0$-blob (here $\phi_\eset$ is a one parameter family of homeomorphisms, so this is a $1$-blob), and $$h(b) = \phi_\beta(b) + \phi_{\eset \prec \beta}(\bdy b)$$ when $b$ is a $1$-blob (here $\beta$ is the ball in $b$, and the first term is the action of a one parameter family of homeomorphisms on a $1$-blob, and the second term is the action of a two parameter family of homeomorphisms on a $0$-blob, so both are $2$-blobs). We then calculate
\begin{align*}
(\bdy h+h \bdy)(b) & = \bdy (\phi_{\beta}(b) + \phi_{\eset \prec \beta}(\bdy b)) + \phi_\eset(\bdy b)  \\
	& =  \restrict{\phi_\beta}{x_0=0}(b) - \restrict{\phi_\beta}{x_1=0}(b) - \phi_\beta(\bdy b) + (\bdy \phi_{\eset \prec \beta})(\bdy b) + \phi_\eset(\bdy b) \\
	& =  \restrict{\phi_\beta}{x_0=0}(b) - b - \phi_\beta(\bdy b) + \restrict{\phi_{\eset \prec \beta}}{x_0=0}(\bdy b) -  \phi_\eset(\bdy b) + \phi_\beta(\bdy b) + \phi_\eset(\bdy b) \\
	& = \restrict{\phi_\beta}{x_0=0}(b) - b + \restrict{\phi_{\eset \prec \beta}}{x_0=0}(\bdy b) \\
	& = (i \circ s - \id)(b).
\end{align*}


In order to define $s$ on arbitrary blob diagrams, we first fix a sequence of strictly subordinate covers for $\cU$. First choose an $\epsilon > 0$ so every $\epsilon$ ball is contained in some open set of $\cU$. For $k \geq 1$, let $\cV_{k}$ be the open cover of $M$ by $\epsilon (1-2^{-k})$ balls, and $\cV_0 = \cU$. Certainly $\cV_k$ is strictly subordinate to $\cU$. We now chose the chain map $\ev$ provided by Lemma \ref{lem:CH-small-blobs} for the open covers $\cV_k$ strictly subordinate to $\cU$. Note that $\cV_1$ and $\cV_2$ have already implicitly appeared in the description above.

Next, we choose a `shrinking system' for $\left(\cU,\{\cV_k\}_{k \geq 1}\right)$, namely for each increasing sequence of blob configurations
$\beta_0 \prec \beta_1 \prec \cdots \prec \beta_m$, an $m+1$ parameter family of diffeomorphisms
$\phi_{\beta_0 \prec \cdots \prec \beta_m} : \Delta^{m+1} \to \Diff{M}$, such that
\begin{itemize}
\item for any $x$ with $x_0 = 0$, $\phi_{\beta_0 \prec \cdots \prec \beta_m}(x)(\beta_0)$ is subordinate to $\cV_{m+1}$, and
\item for each $i = 1, \ldots, m$,
\begin{align*}
\phi_{\beta_0 \prec \cdots \prec \beta_m}&(x_0, \ldots, x_{i-1},0,x_{i+1},\ldots,x_m) = \\ &\phi_{\beta_0 \prec \cdots \prec \beta_{i-1} \prec \beta_{i+1} \prec \cdots \prec \beta_m}(x_0,\ldots, x_{i-1},x_{i+1},\ldots,x_m).
\end{align*}
\end{itemize}
Again, we've already made the choices for $\phi_{\beta}$ and for $\phi_{\eset \prec \beta}$, where $\beta$ is a single ball. It's not immediately obvious that it's possible to make such choices, but it follows readily from the following.

\begin{lem}
\label{lem:extend-small-homeomorphisms}
Fix a collection of disjoint embedded balls $\beta$ in $M$ and some open cover $\cV$. Suppose we have a map $f :  X \to \Homeo(M)$ on some compact $X$ such that for each $x \in \bdy X$, $f(x)$ makes $\beta$ $\cV$-small. Then we can extend $f$ to a map $\tilde{f} : X \times [0,1] \to \Homeo(M)$ so that $\tilde{f}(x,0) = f(x)$ and for every $x \in \bdy X \times [0,1] \cup X \times \{1\}$, $\tilde{f}(x)$ makes $\beta$ $\cV$-small.
\end{lem}
\begin{proof}
Fix a metric on $M$, and pick $\epsilon > 0$ so every $\epsilon$ ball in $M$ is contained in some open set of $\cV$. First construct a family of homeomorphisms $g_s : M \to M$, $s \in [1,\infty)$ so $g_1$ is the identity, and $g_s(\beta_i) \subset \beta_i$ and $\rad g_s(\beta_i) \leq \frac{1}{s} \rad \beta_i$ for each ball $\beta_i$. 
There is some $K$ which uniformly bounds the expansion factors of all the homeomorphisms $f(x)$, that is $d(f(x)(a), f(x)(b)) < K d(a,b)$ for all $x \in X, a,b \in M$. Write $S=\epsilon^{-1} K \max_i \{\rad \beta_i\}$ (note that is $S<1$, we can just take $S=1$, as already $f(x)$ makes $\beta$ small for all $x$). Now define $\tilde{f}(t, x) = f(x) \compose g_{(S-1)t+1}$.

If $x \in \bdy X$, then $g_{(S-1)t+1}(\beta_i) \subset \beta_i$, and by hypothesis $f(x)$ makes $\beta_i$ small, so $\tilde{f}(t, x)$ makes $\beta$ $\cV$-small for all $t \in [0,1]$. Alternatively, $\rad g_S(\beta_i) \leq \frac{1}{S} \rad \beta_i \leq \frac{\epsilon}{K}$, so $\rad \tilde{f}(1,x)(\beta_i) \leq \epsilon$, and so $\tilde{f}(1,x)$ makes $\beta$ $\cV$-small for all $x \in X$.
\end{proof}

In fact, the application of this Lemma would allow us to choose the families of diffeomorphisms $\phi_{\beta_0 \prec \cdots \prec \beta_m}$ so that for any $x$ with $x_0 = 0$, $\phi_{\beta_0 \prec \cdots \prec \beta_m}(x)(\beta_m)$ is subordinate to any fixed open cover, for example $\cV_1$ (that is, the covering by $\epsilon/2$ balls), not just $\cV_{m+1}$, which is a weaker condition. Regardless, because of the way we have chosen the $\ev$ map, we only ensure that $\ev(\restrict{\phi_{\beta_0 \prec \cdots \prec \beta_m}}{x_0 = 0} \tensor \beta_0) \in \bc_{\deg \beta_0 + m}^{\cU}(M)$, so the distinction is not important.

We now describe the general case. For a $k$-blob diagram $b \in \bc_k(M)$, denote by $b_\cS$ for $\cS \subset \{0, \ldots, k-1\}$ the blob diagram obtained by erasing the corresponding blobs. In particular, $b_\eset = b$, $b_{\{0,\ldots,k-1\}} \in \bc_0(M)$, and $d b_\cS = \sum_{i \notin \cS} \pm  b_{\cS \cup \{i\}}$.
Similarly, for a disjoint embedding of $k$ balls $\beta$ (that is, a blob diagram but without the labels on regions), $\beta_\cS$ denotes the result of erasing a subset of blobs. We'll write $\beta' \prec \beta$ if $\beta' = \beta_\cS$ for some $\cS$. Finally, for finite sequences, we'll write $i \prec i'$ if $i$ is subsequence of $i'$, and $i \prec_1 i$ if the lengths differ by exactly 1.


\nn{revision marker ...}

\newcommand{\length}[1]{\operatorname{length}(#1)}

We've finally reached the point where we can define a map $s: \bc_*(M) \to \bc^{\cU}_*(M)$, and then a homotopy $h:\bc_*(M) \to \bc_{*+1}(M)$ so that $dh+hd=i\circ s$.  We have
$$s(b) = \sum_{i} ev(\restrict{\phi_{i(b)}}{x_0 = 0} \tensor b_i)$$
where the sum is over sequences $i=(i_1,\ldots,i_m)$ in $\{1,\ldots,k\}$, with $0\leq m \leq k$, $i(b)$ denotes the increasing sequence of blob configurations
$$\beta_{(i_1,\ldots,i_m)} \prec \beta_{(i_2,\ldots,i_m)} \prec \cdots \prec \beta_{()},$$
and, as usual, $b_i$ denotes $b$ with blobs $i_1, \ldots, i_m$ erased. We'll also write
$$s(b) = \sum_{m=0}^{k} \sum_{\length{i}=m} ev(\restrict{\phi_{i(b)}}{x_0 = 0} \tensor b_i),$$
where we arrange the sum according to the length of $i$.
The homotopy $h:\bc_*(M) \to \bc_{*+1}(M)$ is similarly given by
$$h(b) = \sum_{i} ev(\phi_{i(b)}, b_i).$$

Before completing the proof, we unpack this definition for $b \in \bc_2(M)$, a $2$-blob. We'll write $\beta$ for the underlying balls (either nested or disjoint).
Now $s$ is the sum of $5$ terms, split into three groups depending on with the length of the sequence $i$ is $0, 1$ or $2$. Thus
\begin{align*}
s(b) & = \restrict{\phi_{\beta}}{x_0 = 0}(b) + \\
	& \quad + \restrict{\phi_{\beta_1 \prec \beta}}{x_0 = 0}(b_1) + \restrict{\phi_{\beta_2 \prec \beta}}{x_0 = 0}(b_2) + \\
	& \quad + \restrict{\phi_{\eset \prec \beta_1 \prec \beta}}{x_0 = 0}(b_{12}) + \restrict{\phi_{\eset \prec \beta_2 \prec \beta}}{x_0 = 0}(b_{12}).
\end{align*}

As in the $k=1$ case, the first term, corresponding to $i(b) = \eset$, makes the all balls in $\beta$ $\cV_1$-small. However, if this were the only term $s$ would not be a chain map, because we have no control over $\restrict{\phi_{\beta}}{x_0 = 0}(\bdy b)$. This necessitates the other terms, which fix the boundary at successively higher codimensions.

It may be useful to look at Figure \ref{fig:erectly-a-tent-badly} to help understand the arrangement. The red, blue and orange $2$-cells there correspond to the $m=0$, $m=1$ and $m=2$ terms respectively, while the $3$-cells (only one of each type is shown) correspond to the terms in the homotopy $h$.
\begin{figure}[!ht]
$$\mathfig{0.5}{smallblobs/tent}$$
\caption{``Erecting a tent badly.'' We know where we want to send a simplex, and each of the iterated boundary components. However, these do not agree, and we need to stitch the pieces together. Note that these diagrams don't exactly match the situation in the text: a $k$-simplex has $k+1$ boundary components, while a $k$-blob has $k$ boundary terms.}
\label{fig:erectly-a-tent-badly}
\end{figure}

\nn{lots of signs are wrong ...}
\begin{align*}
\bdy s(b) & =  \restrict{\phi_{\beta}}{x_0 = 0}(\bdy b) + \\
	& \quad + \restrict{\phi_{\beta}}{x_0 = 0}(b_1) - \restrict{\phi_{\beta_1}}{x_0 = 0}(b_1) + \restrict{\phi_{\beta}}{x_0 = 0}(b_2) - \restrict{\phi_{\beta_2}}{x_0 = 0}(b_2) + \\
	& \quad - \restrict{\phi_{\beta_1 \prec \beta}}{x_0 = 0}(b_{12}) - \restrict{\phi_{\beta_2 \prec \beta}}{x_0 = 0}(b_{12}) + \\
	& \quad + \restrict{\phi_{\beta_1 \prec \beta}}{x_0 = 0}(b_{12}) - \restrict{\phi_{\eset  \prec \beta}}{x_0 = 0}(b_{12}) + \restrict{\phi_{\eset \prec \beta_1}}{x_0 = 0}(b_{12}) + \\
	& \quad + \restrict{\phi_{\beta_2 \prec \beta}}{x_0 = 0}(b_{12}) - \restrict{\phi_{\eset \prec \beta}}{x_0 = 0}(b_{12}) + \restrict{\phi_{\eset \prec \beta_2}}{x_0 = 0}(b_{12}), \\ 
\intertext{while}
s(\bdy(b)) & = s(b_1) - s(b_2) \\
		& = \restrict{\phi_{\beta_1}}{x_0=0}(b_1) + \restrict{\phi_{\eset \prec \beta_1}}{x_0=0}(b_{12}) - \restrict{\phi_{\beta_2}}{x_0=0}(b_2) - \restrict{\phi_{\eset \prec \beta_2}}{x_0=0}(b_{12}) .
\end{align*}
\nn{that does indeed work, modulo signs}

We need to check that $s$ is a chain map, and that \todo{} the image of $s$ in fact lies in $\bc^{\cU}_*(M)$.  Calculate
\begin{align*}
\bdy(s(b)) & = \sum_{m=0}^{k-1} \sum_{\length{i}=m} \ev\left(\bdy(\restrict{\phi_{i(b)}}{x_0 = 0})\tensor b_i\right) + (-1)^m \ev\left(\restrict{\phi_{i(b)}}{x_0 = 0} \tensor \bdy b_i\right) \\
                & = \sum_{m=0}^{k-1} \sum_{\length{i}=m} \ev\left(\sum_{i' \prec_1 i} \pm \restrict{\phi_{i'(b)}}{x_0 = 0})\tensor b_i\right) + (-1)^m \ev\left(\restrict{\phi_{i(b)}}{x_0 = 0}\tensor \sum_{i \prec_1 i'} \pm b_{i'}\right) \\
\intertext{and telescoping the sum}
		& = \sum_{m=0}^{k-2} \left(\sum_{\length{i}=m}  (-1)^m \ev\left(\restrict{\phi_{i(b)}}{x_0 = 0} \tensor \sum_{i \prec_1 i'} \pm b_{i'}\right) \right) + \left(\sum_{\length{i}=m+1} \ev\left(\sum_{i' \prec_1 i} \pm \restrict{\phi_{i'(b)}}{x_0 = 0} \tensor b_i\right) \right) + \\
		& \qquad + (-1)^{k-1} \sum_{\length{i}=k-1} \ev\left(\restrict{\phi_{i(b)}}{x_0 = 0} \tensor \sum_{i \prec_1 i'} \pm b_{i'}\right) \\
		& = (-1)^{k-1} \sum_{\length{i}=k-1} \ev\left(\restrict{\phi_{i(b)}}{x_0 = 0} \tensor \sum_{i \prec_1 i'} \pm b_{i'}\right)
\end{align*}

Finally, we need to check that $dh+hd=i\circ s$. \todo{}
\end{proof}
