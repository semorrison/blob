%!TEX root = ../blob1.tex

\section{The blob complex}
\label{sec:blob-definition}

Let $X$ be an $n$-manifold.
Let $\cC$ be a fixed system of fields and local relations.
We'll assume it is enriched over \textbf{Vect}, and if it is not we can make it so by allowing finite
linear combinations of elements of $\cC(X; c)$, for fixed $c\in \cC(\bd X)$.

%In this section we will usually suppress boundary conditions on $X$ from the notation, e.g. by writing $\lf(X)$ instead of $\lf(X; c)$.

We want to replace the quotient
\[
	A(X) \deq \lf(X) / U(X)
\]
of Definition \ref{defn:TQFT-invariant} with a resolution
\[
	\cdots \to \bc_2(X) \to \bc_1(X) \to \bc_0(X) .
\]

We will define $\bc_0(X)$, $\bc_1(X)$ and $\bc_2(X)$, then give the general case $\bc_k(X)$. 
In fact, on the first pass we will intentionally describe the definition in a misleadingly simple way, then explain the technical difficulties, and finally give a cumbersome but complete definition in Definition \ref{defn:blobs}. If (we don't recommend it) you want to keep track of the ways in which this initial description is misleading, or you're reading through a second time to understand the technical difficulties, keep note that later we will give precise meanings to ``a ball in $X$'', ``nested'' and ``disjoint'', that are not quite the intuitive ones. Moreover some of the pieces into which we cut manifolds below are not themselves manifolds, and it requires special attention to define fields on these pieces.

We of course define $\bc_0(X) = \lf(X)$.
(If $X$ has nonempty boundary, instead define $\bc_0(X; c) = \lf(X; c)$ for each $c \in \lf{\bdy X}$.
We'll omit this sort of detail in the rest of this section.)
In other words, $\bc_0(X)$ is just the vector space of all fields on $X$.

We want the vector space $\bc_1(X)$ to capture `the space of all local relations that can be imposed on $\bc_0(X)$'.
Thus we say  a $1$-blob diagram consists of:
\begin{itemize}
\item An closed ball in $X$ (``blob") $B \sub X$.
\item A boundary condition $c \in \cC(\bdy B) = \cC(\bd(X \setmin B))$.
\item A field $r \in \cC(X \setmin B; c)$.
\item A local relation field $u \in U(B; c)$.
\end{itemize}
(See Figure \ref{blob1diagram}.) Since $c$ is implicitly determined by $u$ or $r$, we usually omit it from the notation.
\begin{figure}[t]\begin{equation*}
\mathfig{.6}{definition/single-blob}
\end{equation*}\caption{A 1-blob diagram.}\label{blob1diagram}\end{figure}
In order to get the linear structure correct, we define
\[
	\bc_1(X) \deq \bigoplus_B \bigoplus_c U(B; c) \otimes \lf(X \setmin B; c) .
\]
The first direct sum is indexed by all blobs $B\subset X$, and the second
by all boundary conditions $c \in \cC(\bd B)$.
Note that $\bc_1(X)$ is spanned by 1-blob diagrams $(B, u, r)$.

Define the boundary map $\bd : \bc_1(X) \to \bc_0(X)$ by 
\[ 
	(B, u, r) \mapsto u\bullet r, 
\]
where $u\bullet r$ denotes the field on $X$ obtained by gluing $u$ to $r$.
In other words $\bd : \bc_1(X) \to \bc_0(X)$ is given by
just erasing the blob from the picture
(but keeping the blob label $u$).

Note that directly from the definition we have
\begin{thm}
\label{thm:skein-modules}
The skein module $A(X)$ is naturally isomorphic to $\bc_0(X)/\bd(\bc_1(X))) = H_0(\bc_*(X))$.
\end{thm}
This also establishes the second 
half of Property \ref{property:contractibility}.

Next, we want the vector space $\bc_2(X)$ to capture `the space of all relations 
(redundancies, syzygies) among the 
local relations encoded in $\bc_1(X)$'.
A $2$-blob diagram, comes in one of two types, disjoint and nested.
A disjoint 2-blob diagram consists of
\begin{itemize}
\item A pair of closed balls (blobs) $B_1, B_2 \sub X$ with disjoint interiors.
\item A field $r \in \cC(X \setmin (B_1 \cup B_2); c_1, c_2)$
(where $c_i \in \cC(\bd B_i)$).
\item Local relation fields $u_i \in U(B_i; c_i)$, $i=1,2$.
\end{itemize}
(See Figure \ref{blob2ddiagram}.)
\begin{figure}[t]\begin{equation*}
\mathfig{.6}{definition/disjoint-blobs}
\end{equation*}\caption{A disjoint 2-blob diagram.}\label{blob2ddiagram}\end{figure}
We also identify $(B_1, B_2, u_1, u_2, r)$ with $-(B_2, B_1, u_2, u_1, r)$;
reversing the order of the blobs changes the sign.
Define $\bd(B_1, B_2, u_1, u_2, r) = 
(B_2, u_2, u_1\bullet r) - (B_1, u_1, u_2\bullet r) \in \bc_1(X)$.
In other words, the boundary of a disjoint 2-blob diagram
is the sum (with alternating signs)
of the two ways of erasing one of the blobs.
It's easy to check that $\bd^2 = 0$.

A nested 2-blob diagram consists of
\begin{itemize}
\item A pair of nested balls (blobs) $B_1 \subseteq B_2 \subseteq X$.
\item A field $r' \in \cC(B_2 \setminus B_1; c_1, c_2)$ 
(for some $c_1 \in \cC(\bdy B_1)$ and $c_2 \in \cC(\bdy B_2)$).
\item A field $r \in \cC(X \setminus B_2; c_2)$.
\item A local relation field $u \in U(B_1; c_1)$.
\end{itemize}
(See Figure \ref{blob2ndiagram}.)
\begin{figure}[t]\begin{equation*}
\mathfig{.6}{definition/nested-blobs}
\end{equation*}\caption{A nested 2-blob diagram.}\label{blob2ndiagram}\end{figure}
Define $\bd(B_1, B_2, u, r', r) = (B_2, u\bullet r', r) - (B_1, u, r' \bullet r)$.
As in the disjoint 2-blob case, the boundary of a nested 2-blob is the alternating
sum of the two ways of erasing one of the blobs.
When  we erase the inner blob, the outer blob inherits the label $u\bullet r'$.
It is again easy to check that $\bd^2 = 0$. Note that the requirement that
local relations are an ideal with respect to gluing guarantees that $u\bullet r' \in U(B_2)$.

As with the $1$-blob diagrams, in order to get the linear structure correct the actual definition is 
\begin{eqnarray*}
	\bc_2(X) & \deq &
	\left( 
		\bigoplus_{B_1, B_2\; \text{disjoint}} \bigoplus_{c_1, c_2}
			U(B_1; c_1) \otimes U(B_2; c_2) \otimes \lf(X\setmin (B_1\cup B_2); c_1, c_2)
	\right)  \bigoplus \\
	&& \quad\quad  \left( 
		\bigoplus_{B_1 \subset B_2} \bigoplus_{c_1, c_2}
			U(B_1; c_1) \otimes \lf(B_2 \setmin B_1; c_1) \tensor \cC(X \setminus B_2; c_2)
	\right) .
\end{eqnarray*}
For the disjoint blobs, reversing the ordering of $B_1$ and $B_2$ introduces a minus sign
(rather than a new, linearly independent, 2-blob diagram). 

Before describing the general case, note that when we say blobs are disjoint, we will only mean that their interiors are disjoint. Nested blobs may have boundaries that overlap, or indeed may coincide.
A $k$-blob diagram consists of
\begin{itemize}
\item A collection of blobs $B_i \sub X$, $i = 1, \ldots, k$.
For each $i$ and $j$, we require that either $B_i$ and $B_j$ have disjoint interiors or
$B_i \sub B_j$ or $B_j \sub B_i$.
If a blob has no other blobs strictly contained in it, we call it a twig blob.
\item Fields (boundary conditions) $c_i \in \cC(\bd B_i)$.
(These are implied by the data in the next bullets, so we usually
suppress them from the notation.)
The fields $c_i$ and $c_j$ must have identical restrictions to $\bd B_i \cap \bd B_j$
if the latter space is not empty.
\item A field $r \in \cC(X \setmin B^t; c^t)$,
where $B^t$ is the union of all the twig blobs and $c^t \in \cC(\bd B^t)$
is determined by the $c_i$'s.
The field $r$ is required to be splittable along the boundaries of all blobs, twigs or not. (This is equivalent to asking for a field on of the components of $X \setmin B^t$.)
\item For each twig blob $B_j$ a local relation field $u_j \in U(B_j; c_j)$.
If $B_i = B_j$ then $u_i = u_j$.
\end{itemize}
(See Figure \ref{blobkdiagram}.)
\begin{figure}[t]\begin{equation*}
\mathfig{.7}{definition/k-blobs}
\end{equation*}\caption{A $k$-blob diagram.}\label{blobkdiagram}\end{figure}

If two blob diagrams $D_1$ and $D_2$ 
differ only by a reordering of the blobs, then we identify
$D_1 = \pm D_2$, where the sign is the sign of the permutation relating $D_1$ and $D_2$.

Roughly, then, $\bc_k(X)$ is all finite linear combinations of $k$-blob diagrams.
As before, the official definition is in terms of direct sums
of tensor products:
\[
	\bc_k(X) \deq \bigoplus_{\overline{B}} \bigoplus_{\overline{c}}
		\left( \bigotimes_j U(B_j; c_j)\right) \otimes \lf(X \setmin B^t; c^t) .
\]
Here $\overline{B}$ runs over all configurations of blobs, satisfying the conditions above.
The index $\overline{c}$ runs over all boundary conditions, again as described above and $j$ runs over all indices of twig blobs.
The final $\lf(X \setmin B^t; c^t)$ must be interpreted as fields which are splittable along all of the blobs in $\overline{B}$.

The boundary map 
\[
	\bd : \bc_k(X) \to \bc_{k-1}(X)
\]
is defined as follows.
Let $b = (\{B_i\}, \{u_j\}, r)$ be a $k$-blob diagram.
Let $E_j(b)$ denote the result of erasing the $j$-th blob.
If $B_j$ is not a twig blob, this involves only decrementing
the indices of blobs $B_{j+1},\ldots,B_{k}$.
If $B_j$ is a twig blob, we have to assign new local relation labels
if removing $B_j$ creates new twig blobs. \todo{Have to say what happens when no new twig blobs are created}
If $B_l$ becomes a twig after removing $B_j$, then set $u_l = u_j\bullet r_l$,
where $r_l$ is the restriction of $r$ to $B_l \setmin B_j$.
Finally, define
\eq{
    \bd(b) = \sum_{j=1}^{k} (-1)^{j+1} E_j(b).
}
The $(-1)^{j+1}$ factors imply that the terms of $\bd^2(b)$ all cancel.
Thus we have a chain complex.

Note that Property \ref{property:functoriality}, that the blob complex is functorial with respect to homeomorphisms, is immediately obvious from the definition.
A homeomorphism acts in an obvious way on blobs and on fields.

At this point, it is time to pay back our debt and define certain notions more carefully.

In order to precisely state the general definition, we'll need a suitable notion of cutting up a manifold into balls.
\begin{defn}
\label{defn:gluing-decomposition}
A \emph{gluing decomposition} of an $n$-manifold $X$ is a sequence of manifolds $M_0 \to M_1 \to \cdots \to M_m = X$ such that $M_0$ is a disjoint union of balls, and each $M_k$ is obtained from $M_{k-1}$ by gluing together some disjoint pair of homeomorphic $n{-}1$-manifolds in the boundary of $M_{k-1}$.
\end{defn}
Given a gluing decomposition $M_0 \to M_1 \to \cdots \to M_m = X$, we say that a field is splittable along it if it is the image of a field on $M_0$.

By `a ball in $X$' we don't literally mean a submanifold homeomorphic to a ball, but rather the image of a map from the pair $(B^n, S^{n-1})$ into $X$, which is an embedding on the interior. The boundary of a ball in $X$ is the image of a locally embedded $n{-}1$-sphere. \todo{examples, e.g. balls which actually look like an annulus, but we remember the boundary} 

\begin{defn}
\label{defn:ball-decomposition}
A \emph{ball decomposition} of an $n$-manifold $X$ is a collection of balls in $X$, such that there exists some gluing decomposition $M_0  \to \cdots \to M_m = X$ so that the balls are the images of the components of $M_0$ in $X$. 
\end{defn}
In particular, the union of all the balls in a ball decomposition comprises all of $X$. \todo{example}

We'll now slightly restrict the possible configurations of blobs.
\begin{defn}
\label{defn:configuration}
A configuration of $k$ blobs in $X$ is an ordered collection of $k$ balls in $X$ such that there is some gluing decomposition $M_0  \to \cdots \to M_m = X$ of $X$ and each of the balls is the image of some connected component of one of the $M_k$. Such a gluing decomposition is \emph{compatible} with the configuration.
\end{defn}
In particular, this implies what we said about blobs above: that for any two blobs in a configuration of blobs in $X$, they either have disjoint interiors, or one blob is strictly contained in the other. We describe these as disjoint blobs and nested blobs. Note that nested blobs may have boundaries that overlap, or indeed coincide. Blobs may meet the boundary of $X$.

Note that the boundaries of a configuration of $k$ blobs may cut up the manifold $X$ into components which are not themselves manifolds. \todo{example: the components between the boundaries of the balls may be pathological}

In the informal description above, in the definition of a $k$-blob diagram we asked for any collection of $k$ balls which were pairwise disjoint or nested. We now further insist that the balls are a configuration in the sense of Definition \ref{defn:configuration}. Also, we asked for a local relation on each twig blob, and a field on the complement of the twig blobs; this is unsatisfactory because that complement need not be a manifold. Thus, the official definition is
\begin{defn}
\label{defn:blob-diagram}
A $k$-blob diagram on $X$ consists of
\begin{itemize}
\item a configuration of $k$ blobs in $X$,
\item and a field $r \in \cC(X)$ which is splittable along some gluing decomposition compatible with that configuration,
\end{itemize}
such that
the restriction of $r$ to each twig blob $B_i$ lies in the subspace $U(B_i) \subset \cC(B_i)$.
\end{defn}
and
\begin{defn}
\label{defn:blobs}
The $k$-th vector space $\bc_k(X)$ of the \emph{blob complex} of $X$ is the direct sum of all configurations of $k$ blobs in $X$ of the vector space of $k$-blob diagrams with that configuration, modulo identifying the vector spaces for configurations that only differ by a permutation of the balls by the sign of that permutation. The differential $bc_k(X) \to bc_{k-1}(X)$ is, as above, the signed sum of ways of forgetting one ball from the configuration, preserving the field $r$.
\end{defn}
We readily see that if a gluing decomposition is compatible with some configuration of blobs, then it is also compatible with any configuration obtained by forgetting some blobs, ensuring that the differential in fact lands in the space of $k{-}1$-blob diagrams.
A slight compensation to the complication of the official definition arising from attention to splitting is that the differential now just preserves the entire field $r$ without having to say anything about gluing together fields on smaller components.

\todo{this notion of configuration of blobs is the minimal one that allows gluing and engulfing}




We define the {\it support} of a blob diagram $b$, $\supp(b) \sub X$, 
to be the union of the blobs of $b$.
For $y \in \bc_*(X)$ with $y = \sum c_i b_i$ ($c_i$ a non-zero number, $b_i$ a blob diagram),
we define $\supp(y) \deq \bigcup_i \supp(b_i)$.

We note that blob diagrams in $X$ have a structure similar to that of a simplicial set,
but with simplices replaced by a more general class of combinatorial shapes.
Let $P$ be the minimal set of (isomorphisms classes of) polyhedra which is closed under products
and cones, and which contains the point.
We can associate an element $p(b)$ of $P$ to each blob diagram $b$ 
(equivalently, to each rooted tree) according to the following rules:
\begin{itemize}
\item $p(\emptyset) = pt$, where $\emptyset$ denotes a 0-blob diagram or empty tree;
\item $p(a \du b) = p(a) \times p(b)$, where $a \du b$ denotes the distant (non-overlapping) union 
of two blob diagrams (equivalently, join two trees at the roots); and
\item $p(\bar{b}) = \kone(p(b))$, where $\bar{b}$ is obtained from $b$ by adding an outer blob which 
encloses all the others (equivalently, add a new edge to the root, with the new vertex becoming the root).
\end{itemize}
For example, a diagram of $k$ strictly nested blobs corresponds to a $k$-simplex, while
a diagram of $k$ disjoint blobs corresponds to a $k$-cube.
(This correspondence works best if we think of each twig label $u_i$ as having the form
$x - s(e(x))$, where $x$ is an arbitrary field on $B_i$, $e: \cC(B_i) \to C$ is the evaluation map, 
and $s:C \to \cC(B_i)$ is some fixed section of $e$. \todo{This parenthetical remark mysteriously specialises to the category case})


