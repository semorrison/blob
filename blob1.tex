\documentclass[11pt,leqno]{amsart}

\newcommand{\pathtotrunk}{./}
\input{text/article_preamble.tex}
\input{text/top_matter.tex}

% test edit #3

%%%%% excerpts from my include file of standard macros

\def\bc{{\mathcal B}}

\def\z{\mathbb{Z}}
\def\r{\mathbb{R}}
\def\c{\mathbb{C}}
\def\t{\mathbb{T}}

\def\du{\sqcup}
\def\bd{\partial}
\def\sub{\subset}
\def\sup{\supset}
%\def\setmin{\smallsetminus}
\def\setmin{\setminus}
\def\ep{\epsilon}
\def\sgl{_\mathrm{gl}}
\def\op{^\mathrm{op}}
\def\deq{\stackrel{\mathrm{def}}{=}}
\def\pd#1#2{\frac{\partial #1}{\partial #2}}

\def\nn#1{{{\it \small [#1]}}}


% equations
\newcommand{\eq}[1]{\begin{displaymath}#1\end{displaymath}}
\newcommand{\eqar}[1]{\begin{eqnarray*}#1\end{eqnarray*}}
\newcommand{\eqspl}[1]{\begin{displaymath}\begin{split}#1\end{split}\end{displaymath}}

% tricky way to iterate macros over a list
\def\semicolon{;}
\def\applytolist#1{
    \expandafter\def\csname multi#1\endcsname##1{
        \def\multiack{##1}\ifx\multiack\semicolon
            \def\next{\relax}
        \else
            \csname #1\endcsname{##1}
            \def\next{\csname multi#1\endcsname}
        \fi
        \next}
    \csname multi#1\endcsname}

% \def\cA{{\cal A}} for A..Z
\def\calc#1{\expandafter\def\csname c#1\endcsname{{\mathcal #1}}}
\applytolist{calc}QWERTYUIOPLKJHGFDSAZXCVBNM;

% \DeclareMathOperator{\pr}{pr} etc.
\def\declaremathop#1{\expandafter\DeclareMathOperator\csname #1\endcsname{#1}}
\applytolist{declaremathop}{pr}{im}{id}{gl}{tr}{rot}{Eq}{obj}{mor}{ob}{Rep}{Tet}{cat}{Diff}{sign};



%%%%%% end excerpt





\title{Blob Homology}

\begin{document}



\makeatletter
\@addtoreset{equation}{section}
\gdef\theequation{\thesection.\arabic{equation}}
\makeatother


\maketitle

\section{Introduction}

(motivation, summary/outline, etc.)

(motivation:
(1) restore exactness in pictures-mod-relations;
(1') add relations-amongst-relations etc. to pictures-mod-relations;
(2) want answer independent of handle decomp (i.e. don't
just go from coend to derived coend (e.g. Hochschild homology));
(3) ...
)

\section{Definitions}

\subsection{Fields}

Fix a top dimension $n$.

A {\it system of fields}
\nn{maybe should look for better name; but this is the name I use elsewhere}
is a collection of functors $\cC$ from manifolds of dimension $n$ or less
to sets.
These functors must satisfy various properties (see KW TQFT notes for details).
For example:
there is a canonical identification $\cC(X \du Y) = \cC(X) \times \cC(Y)$;
there is a restriction map $\cC(X) \to \cC(\bd X)$;
gluing manifolds corresponds to fibered products of fields;
given a field $c \in \cC(Y)$ there is a ``product field"
$c\times I \in \cC(Y\times I)$; ...
\nn{should eventually include full details of definition of fields.}

\nn{note: probably will suppress from notation the distinction
between fields and their (orientation-reversal) duals}

\nn{remark that if top dimensional fields are not already linear
then we will soon linearize them(?)}

The definition of a system of fields is intended to generalize
the relevant properties of the following two examples of fields.

The first example: Fix a target space $B$ and define $\cC(X)$ (where $X$
is a manifold of dimension $n$ or less) to be the set of
all maps from $X$ to $B$.

The second example will take longer to explain.
Given an $n$-category $C$ with the right sort of duality
(e.g. pivotal 2-category, 1-category with duals, star 1-category, disklike $n$-category),
we can construct a system of fields as follows.
Roughly speaking, $\cC(X)$ will the set of all embedded cell complexes in $X$
with codimension $i$ cells labeled by $i$-morphisms of $C$.
We'll spell this out for $n=1,2$ and then describe the general case.

If $X$ has boundary, we require that the cell decompositions are in general
position with respect to the boundary --- the boundary intersects each cell
transversely, so cells meeting the boundary are mere half-cells.

Put another way, the cell decompositions we consider are dual to standard cell
decompositions of $X$.

We will always assume that our $n$-categories have linear $n$-morphisms.

For $n=1$, a field on a 0-manifold $P$ is a labeling of each point of $P$ with
an object (0-morphism) of the 1-category $C$.
A field on a 1-manifold $S$ consists of
\begin{itemize}
    \item A cell decomposition of $S$ (equivalently, a finite collection
of points in the interior of $S$);
    \item a labeling of each 1-cell (and each half 1-cell adjacent to $\bd S$)
by an object (0-morphism) of $C$;
    \item a transverse orientation of each 0-cell, thought of as a choice of
``domain" and ``range" for the two adjacent 1-cells; and
    \item a labeling of each 0-cell by a morphism (1-morphism) of $C$, with
domain and range determined by the transverse orientation and the labelings of the 1-cells.
\end{itemize}

If $C$ is an algebra (i.e. if $C$ has only one 0-morphism) we can ignore the labels
of 1-cells, so a field on a 1-manifold $S$ is a finite collection of points in the
interior of $S$, each transversely oriented and each labeled by an element (1-morphism)
of the algebra.

\medskip

For $n=2$, fields are just the sort of pictures based on 2-categories (e.g.\ tensor categories)
that are common in the literature.
We describe these carefully here.

A field on a 0-manifold $P$ is a labeling of each point of $P$ with
an object of the 2-category $C$.
A field of a 1-manifold is defined as in the $n=1$ case, using the 0- and 1-morphisms of $C$.
A field on a 2-manifold $Y$ consists of
\begin{itemize}
    \item A cell decomposition of $Y$ (equivalently, a graph embedded in $Y$ such
that each component of the complement is homeomorphic to a disk);
    \item a labeling of each 2-cell (and each partial 2-cell adjacent to $\bd Y$)
by a 0-morphism of $C$;
    \item a transverse orientation of each 1-cell, thought of as a choice of
``domain" and ``range" for the two adjacent 2-cells;
    \item a labeling of each 1-cell by a 1-morphism of $C$, with
domain and range determined by the transverse orientation of the 1-cell
and the labelings of the 2-cells;
    \item for each 0-cell, a homeomorphism of the boundary $R$ of a small neighborhood
of the 0-cell to $S^1$ such that the intersections of the 1-cells with $R$ are not mapped
to $\pm 1 \in S^1$; and
    \item a labeling of each 0-cell by a 2-morphism of $C$, with domain and range
determined by the labelings of the 1-cells and the parameterizations of the previous
bullet.
\end{itemize}
\nn{need to say this better; don't try to fit everything into the bulleted list}

For general $n$, a field on a $k$-manifold $X^k$ consists of
\begin{itemize}
    \item A cell decomposition of $X$;
    \item an explicit general position homeomorphism from the link of each $j$-cell
to the boundary of the standard $(k-j)$-dimensional bihedron; and
    \item a labeling of each $j$-cell by a $(k-j)$-dimensional morphism of $C$, with
domain and range determined by the labelings of the link of $j$-cell.
\end{itemize}

%\nn{next definition might need some work; I think linearity relations should
%be treated differently (segregated) from other local relations, but I'm not sure
%the next definition is the best way to do it}

\medskip

For top dimensional ($n$-dimensional) manifolds, we're actually interested
in the linearized space of fields.
By default, define $\cC_l(X) = \c[\cC(X)]$; that is, $\cC_l(X)$ is
the vector space of finite
linear combinations of fields on $X$.
If $X$ has boundary, we of course fix a boundary condition: $\cC_l(X; a) = \c[\cC(X; a)]$.
Thus the restriction (to boundary) maps are well defined because we never
take linear combinations of fields with differing boundary conditions.

In some cases we don't linearize the default way; instead we take the
spaces $\cC_l(X; a)$ to be part of the data for the system of fields.
In particular, for fields based on linear $n$-category pictures we linearize as follows.
Define $\cC_l(X; a) = \c[\cC(X; a)]/K$, where $K$ is the space generated by
obvious relations on 0-cell labels.
More specifically, let $L$ be a cell decomposition of $X$
and let $p$ be a 0-cell of $L$.
Let $\alpha_c$ and $\alpha_d$ be two labelings of $L$ which are identical except that
$\alpha_c$ labels $p$ by $c$ and $\alpha_d$ labels $p$ by $d$.
Then the subspace $K$ is generated by things of the form
$\lambda \alpha_c + \alpha_d - \alpha_{\lambda c + d}$, where we leave it to the reader
to infer the meaning of $\alpha_{\lambda c + d}$.
Note that we are still assuming that $n$-categories have linear spaces of $n$-morphisms.

\nn{Maybe comment further: if there's a natural basis of morphisms, then no need;
will do something similar below; in general, whenever a label lives in a linear
space we do something like this; ? say something about tensor
product of all the linear label spaces?  Yes:}

For top dimensional ($n$-dimensional) manifolds, we linearize as follows.
Define an ``almost-field" to be a field without labels on the 0-cells.
(Recall that 0-cells are labeled by $n$-morphisms.)
To each unlabeled 0-cell in an almost field there corresponds a (linear) $n$-morphism
space determined by the labeling of the link of the 0-cell.
(If the 0-cell were labeled, the label would live in this space.)
We associate to each almost-labeling the tensor product of these spaces (one for each 0-cell).
We now define $\cC_l(X; a)$ to be the direct sum over all almost labelings of the
above tensor products.



\subsection{Local relations}

Let $B^n$ denote the standard $n$-ball.
A {\it local relation} is a collection subspaces $U(B^n; c) \sub \cC_l(B^n; c)$
(for all $c \in \cC(\bd B^n)$) satisfying the following (three?) properties.

\nn{Roughly, these are (1) the local relations imply (extended) isotopy;
(2) $U(B^n; \cdot)$ is an ideal w.r.t.\ gluing; and
(3) this ideal is generated by ``small" generators (contained in an open cover of $B^n$).
See KW TQFT notes for details.  Need to transfer details to here.}

For maps into spaces, $U(B^n; c)$ is generated by things of the form $a-b \in \cC_l(B^n; c)$,
where $a$ and $b$ are maps (fields) which are homotopic rel boundary.

For $n$-category pictures, $U(B^n; c)$ is equal to the kernel of the evaluation map
$\cC_l(B^n; c) \to \mor(c', c'')$, where $(c', c'')$ is some (any) division of $c$ into
domain and range.

\nn{maybe examples of local relations before general def?}

Note that the $Y$ is an $n$-manifold which is merely homeomorphic to the standard $B^n$,
then any homeomorphism $B^n \to Y$ induces the same local subspaces for $Y$.
We'll denote these by $U(Y; c) \sub \cC_l(Y; c)$, $c \in \cC(\bd Y)$.
\nn{Is this true in high (smooth) dimensions?  Self-diffeomorphisms of $B^n$
rel boundary might not be isotopic to the identity.  OK for PL and TOP?}

Given a system of fields and local relations, we define the skein space
$A(Y^n; c)$ to be the space of all finite linear combinations of fields on
the $n$-manifold $Y$ modulo local relations.
The Hilbert space $Z(Y; c)$ for the TQFT based on the fields and local relations
is defined to be the dual of $A(Y; c)$.
(See KW TQFT notes or xxxx for details.)

The blob complex is in some sense the derived version of $A(Y; c)$.



\subsection{The blob complex}

Let $X$ be an $n$-manifold.
Assume a fixed system of fields.
In this section we will usually suppress boundary conditions on $X$ from the notation
(e.g. write $\cC_l(X)$ instead of $\cC_l(X; c)$).

We only consider compact manifolds, so if $Y \sub X$ is a closed codimension 0
submanifold of $X$, then $X \setmin Y$ implicitly means the closure
$\overline{X \setmin Y}$.

We will define $\bc_0(X)$, $\bc_1(X)$ and $\bc_2(X)$, then give the general case.

Define $\bc_0(X) = \cC_l(X)$.
(If $X$ has nonempty boundary, instead define $\bc_0(X; c) = \cC_l(X; c)$.
We'll omit this sort of detail in the rest of this section.)
In other words, $\bc_0(X)$ is just the space of all linearized fields on $X$.

$\bc_1(X)$ is the space of all local relations that can be imposed on $\bc_0(X)$.
More specifically, define a 1-blob diagram to consist of
\begin{itemize}
\item An embedded closed ball (``blob") $B \sub X$.
%\nn{Does $B$ need a homeo to the standard $B^n$?  I don't think so.
%(See note in previous subsection.)}
%\item A field (boundary condition) $c \in \cC(\bd B) = \cC(\bd(X \setmin B))$.
\item A field $r \in \cC(X \setmin B; c)$
(for some $c \in \cC(\bd B) = \cC(\bd(X \setmin B))$).
\item A local relation field $u \in U(B; c)$
(same $c$ as previous bullet).
\end{itemize}
%(Note that the field $c$ is determined (implicitly) as the boundary of $u$ and/or $r$,
%so we will omit $c$ from the notation.)
Define $\bc_1(X)$ to be the space of all finite linear combinations of
1-blob diagrams, modulo the simple relations relating labels of 0-cells and
also the label ($u$ above) of the blob.
\nn{maybe spell this out in more detail}
(See xxxx above.)
\nn{maybe restate this in terms of direct sums of tensor products.}

There is a map $\bd : \bc_1(X) \to \bc_0(X)$ which sends $(B, r, u)$ to $ru$, the linear
combination of fields on $X$ obtained by gluing $r$ to $u$.
In other words $\bd : \bc_1(X) \to \bc_0(X)$ is given by
just erasing the blob from the picture
(but keeping the blob label $u$).

Note that the skein space $A(X)$
is naturally isomorphic to $\bc_0(X)/\bd(\bc_1(X))) = H_0(\bc_*(X))$.

$\bc_2(X)$ is the space of all relations (redundancies) among the relations of $\bc_1(X)$.
More specifically, $\bc_2(X)$ is the space of all finite linear combinations of
2-blob diagrams (defined below), modulo the usual linear label relations.
\nn{and also modulo blob reordering relations?}

\nn{maybe include longer discussion to motivate the two sorts of 2-blob diagrams}

There are two types of 2-blob diagram: disjoint and nested.
A disjoint 2-blob diagram consists of
\begin{itemize}
\item A pair of disjoint closed balls (blobs) $B_0, B_1 \sub X$.
%\item Fields (boundary conditions) $c_i \in \cC(\bd B_i)$.
\item A field $r \in \cC(X \setmin (B_0 \cup B_1); c_0, c_1)$
(where $c_i \in \cC(\bd B_i)$).
\item Local relation fields $u_i \in U(B_i; c_i)$.
\end{itemize}
Define $\bd(B_0, B_1, r, u_0, u_1) = (B_1, ru_0, u_1) - (B_0, ru_1, u_0) \in \bc_1(X)$.
In other words, the boundary of a disjoint 2-blob diagram
is the sum (with alternating signs)
of the two ways of erasing one of the blobs.
It's easy to check that $\bd^2 = 0$.

A nested 2-blob diagram consists of
\begin{itemize}
\item A pair of nested balls (blobs) $B_0 \sub B_1 \sub X$.
\item A field $r \in \cC(X \setmin B_0; c_0)$
(for some $c_0 \in \cC(\bd B_0)$).
Let $r = r_1 \cup r'$, where $r_1 \in \cC(B_1 \setmin B_0; c_0, c_1)$
(for some $c_1 \in \cC(B_1)$) and
$r' \in \cC(X \setmin B_1; c_1)$.
\item A local relation field $u_0 \in U(B_0; c_0)$.
\end{itemize}
Define $\bd(B_0, B_1, r, u_0) = (B_1, r', r_1u_0) - (B_0, r, u_0)$.
Note that xxxx above guarantees that $r_1u_0 \in U(B_1)$.
As in the disjoint 2-blob case, the boundary of a nested 2-blob is the alternating
sum of the two ways of erasing one of the blobs.
If we erase the inner blob, the outer blob inherits the label $r_1u_0$.

Now for the general case.
A $k$-blob diagram consists of
\begin{itemize}
\item A collection of blobs $B_i \sub X$, $i = 0, \ldots, k-1$.
For each $i$ and $j$, we require that either $B_i \cap B_j$ is empty or
$B_i \sub B_j$ or $B_j \sub B_i$.
(The case $B_i = B_j$ is allowed.
If $B_i \sub B_j$ the boundaries of $B_i$ and $B_j$ are allowed to intersect.)
If a blob has no other blobs strictly contained in it, we call it a twig blob.
%\item Fields (boundary conditions) $c_i \in \cC(\bd B_i)$.
%(These are implied by the data in the next bullets, so we usually
%suppress them from the notation.)
%$c_i$ and $c_j$ must have identical restrictions to $\bd B_i \cap \bd B_j$
%if the latter space is not empty.
\item A field $r \in \cC(X \setmin B^t; c^t)$,
where $B^t$ is the union of all the twig blobs and $c^t \in \cC(\bd B^t)$.
\item For each twig blob $B_j$ a local relation field $u_j \in U(B_j; c_j)$,
where $c_j$ is the restriction of $c^t$ to $\bd B_j$.
If $B_i = B_j$ then $u_i = u_j$.
\end{itemize}

We define $\bc_k(X)$ to be the vector space of all finite linear combinations
of $k$-blob diagrams, modulo the linear label relations and
blob reordering relations defined in the remainder of this paragraph.
Let $x$ be a blob diagram with one undetermined $n$-morphism label.
The unlabeled entity is either a blob or a 0-cell outside of the twig blobs.
Let $a$ and $b$ be two possible $n$-morphism labels for
the unlabeled blob or 0-cell.
Let $c = \lambda a + b$.
Let $x_a$ be the blob diagram with label $a$, and define $x_b$ and $x_c$ similarly.
Then we impose the relation
\eq{
    x_c = \lambda x_a + x_b .
}
\nn{should do this in terms of direct sums of tensor products}
Let $x$ and $x'$ be two blob diagrams which differ only by a permutation $\pi$
of their blob labelings.
Then we impose the relation
\eq{
    x = \sign(\pi) x' .
}

(Alert readers will have noticed that for $k=2$ our definition
of $\bc_k(X)$ is slightly different from the previous definition
of $\bc_2(X)$ --- we did not impose the reordering relations.
The general definition takes precedence;
the earlier definition was simplified for purposes of exposition.)

The boundary map $\bd : \bc_k(X) \to \bc_{k-1}(X)$ is defined as follows.
Let $b = (\{B_i\}, r, \{u_j\})$ be a $k$-blob diagram.
Let $E_j(b)$ denote the result of erasing the $j$-th blob.
If $B_j$ is not a twig blob, this involves only decrementing
the indices of blobs $B_{j+1},\ldots,B_{k-1}$.
If $B_j$ is a twig blob, we have to assign new local relation labels
if removing $B_j$ creates new twig blobs.
If $B_l$ becomes a twig after removing $B_j$, then set $u_l = r_lu_j$,
where $r_l$ is the restriction of $r$ to $B_l \setmin B_j$.
Finally, define
\eq{
    \bd(b) = \sum_{j=0}^{k-1} (-1)^j E_j(b).
}
The $(-1)^j$ factors imply that the terms of $\bd^2(b)$ all cancel.
Thus we have a chain complex.

\nn{?? say something about the ``shape" of tree? (incl = cone, disj = product)}


\nn{TO DO:
expand definition to handle DGA and $A_\infty$ versions of $n$-categories;
relations to Chas-Sullivan string stuff}



\section{Basic properties of the blob complex}

\begin{prop} \label{disjunion}
There is a natural isomorphism $\bc_*(X \du Y) \cong \bc_*(X) \otimes \bc_*(Y)$.
\end{prop}
\begin{proof}
Given blob diagrams $b_1$ on $X$ and $b_2$ on $Y$, we can combine them
(putting the $b_1$ blobs before the $b_2$ blobs in the ordering) to get a
blob diagram $(b_1, b_2)$ on $X \du Y$.
Because of the blob reordering relations, all blob diagrams on $X \du Y$ arise this way.
In the other direction, any blob diagram on $X\du Y$ is equal (up to sign)
to one that puts $X$ blobs before $Y$ blobs in the ordering, and so determines
a pair of blob diagrams on $X$ and $Y$.
These two maps are compatible with our sign conventions \nn{say more about this?} and
with the linear label relations.
The two maps are inverses of each other.
\nn{should probably say something about sign conventions for the differential
in a tensor product of chain complexes; ask Scott}
\end{proof}

For the next proposition we will temporarily restore $n$-manifold boundary
conditions to the notation.

Suppose that for all $c \in \cC(\bd B^n)$
we have a splitting $s: H_0(\bc_*(B^n, c)) \to \bc_0(B^n; c)$
of the quotient map
$p: \bc_0(B^n; c) \to H_0(\bc_*(B^n, c))$.
\nn{always the case if we're working over $\c$}.
Then
\begin{prop} \label{bcontract}
For all $c \in \cC(\bd B^n)$ the natural map $p: \bc_*(B^n, c) \to H_0(\bc_*(B^n, c))$
is a chain homotopy equivalence
with inverse $s: H_0(\bc_*(B^n, c)) \to \bc_*(B^n; c)$.
Here we think of $H_0(\bc_*(B^n, c))$ as a 1-step complex concentrated in degree 0.
\end{prop}
\begin{proof}
By assumption $p\circ s = \id$, so all that remains is to find a degree 1 map
$h : \bc_*(B^n; c) \to \bc_*(B^n; c)$ such that $\bd h + h\bd = \id - s \circ p$.
For $i \ge 1$, define $h_i : \bc_i(B^n; c) \to \bc_{i+1}(B^n; c)$ by adding
an $(i{+}1)$-st blob equal to all of $B^n$.
In other words, add a new outermost blob which encloses all of the others.
Define $h_0 : \bc_0(B^n; c) \to \bc_1(B^n; c)$ by setting $h_0(x)$ equal to
the 1-blob with blob $B^n$ and label $x - s(p(x)) \in U(B^n; c)$.
\nn{$x$ is a 0-blob diagram, i.e. $x \in \cC(B^n; c)$}
\end{proof}

(Note that for the above proof to work, we need the linear label relations
for blob labels.
Also we need to blob reordering relations (?).)

(Note also that if there is no splitting $s$, we can let $h_0 = 0$ and get a homotopy
equivalence to the 2-step complex $U(B^n; c) \to \cC(B^n; c)$.)

(For fields based on $n$-cats, $H_0(\bc_*(B^n; c)) \cong \mor(c', c'')$.)

\medskip

As we noted above,
\begin{prop}
There is a natural isomorphism $H_0(\bc_*(X)) \cong A(X)$.
\qed
\end{prop}


% oops -- duplicate

%\begin{prop} \label{functorialprop}
%The assignment $X \mapsto \bc_*(X)$ extends to a functor from the category of
%$n$-manifolds and homeomorphisms to the category of chain complexes and linear isomorphisms.
%\end{prop}

%\begin{proof}
%Obvious.
%\end{proof}

%\nn{need to same something about boundaries and boundary conditions above.
%maybe fix the boundary and consider the category of $n$-manifolds with the given boundary.}


\begin{prop}
For fixed fields ($n$-cat), $\bc_*$ is a functor from the category
of $n$-manifolds and diffeomorphisms to the category of chain complexes and
(chain map) isomorphisms.
\qed
\end{prop}

\nn{need to same something about boundaries and boundary conditions above.
maybe fix the boundary and consider the category of $n$-manifolds with the given boundary.}


In particular,
\begin{prop}  \label{diff0prop}
There is an action of $\Diff(X)$ on $\bc_*(X)$.
\qed
\end{prop}

The above will be greatly strengthened in Section \ref{diffsect}.

\medskip

For the next proposition we will temporarily restore $n$-manifold boundary
conditions to the notation.

Let $X$ be an $n$-manifold, $\bd X = Y \cup (-Y) \cup Z$.
Gluing the two copies of $Y$ together yields an $n$-manifold $X\sgl$
with boundary $Z\sgl$.
Given compatible fields (pictures, boundary conditions) $a$, $b$ and $c$ on $Y$, $-Y$ and $Z$,
we have the blob complex $\bc_*(X; a, b, c)$.
If $b = -a$ (the orientation reversal of $a$), then we can glue up blob diagrams on
$X$ to get blob diagrams on $X\sgl$:

\begin{prop}
There is a natural chain map
\eq{
    \gl: \bigoplus_a \bc_*(X; a, -a, c) \to \bc_*(X\sgl; c\sgl).
}
The sum is over all fields $a$ on $Y$ compatible at their
($n{-}2$-dimensional) boundaries with $c$.
`Natural' means natural with respect to the actions of diffeomorphisms.
\qed
\end{prop}

The above map is very far from being an isomorphism, even on homology.
This will be fixed in Section \ref{gluesect} below.

An instance of gluing we will encounter frequently below is where $X = X_1 \du X_2$
and $X\sgl = X_1 \cup_Y X_2$.
(Typically one of $X_1$ or $X_2$ is a disjoint union of balls.)
For $x_i \in \bc_*(X_i)$, we introduce the notation
\eq{
    x_1 \bullet x_2 \deq \gl(x_1 \otimes x_2) .
}
Note that we have resumed our habit of omitting boundary labels from the notation.


\bigskip

\nn{what else?}




\section{$n=1$ and Hochschild homology}

In this section we analyze the blob complex in dimension $n=1$
and find that for $S^1$ the homology of the blob complex is the
Hochschild homology of the category (algebroid) that we started with.
\nn{or maybe say here that the complexes are quasi-isomorphic?  in general,
should perhaps put more emphasis on the complexes and less on the homology.}

Notation: $HB_i(X) = H_i(\bc_*(X))$.

Let us first note that there is no loss of generality in assuming that our system of
fields comes from a category.
(Or maybe (???) there {\it is} a loss of generality.
Given any system of fields, $A(I; a, b) = \cC(I; a, b)/U(I; a, b)$ can be
thought of as the morphisms of a 1-category $C$.
More specifically, the objects of $C$ are $\cC(pt)$, the morphisms from $a$ to $b$
are $A(I; a, b)$, and composition is given by gluing.
If we instead take our fields to be $C$-pictures, the $\cC(pt)$ does not change
and neither does $A(I; a, b) = HB_0(I; a, b)$.
But what about $HB_i(I; a, b)$ for $i > 0$?
Might these higher blob homology groups be different?
Seems unlikely, but I don't feel like trying to prove it at the moment.
In any case, we'll concentrate on the case of fields based on 1-category
pictures for the rest of this section.)

(Another question: $\bc_*(I)$ is an $A_\infty$-category.
How general of an $A_\infty$-category is it?
Given an arbitrary $A_\infty$-category can one find fields and local relations so
that $\bc_*(I)$ is in some sense equivalent to the original $A_\infty$-category?
Probably not, unless we generalize to the case where $n$-morphisms are complexes.)

Continuing...

Let $C$ be a *-1-category.
Then specializing the definitions from above to the case $n=1$ we have:
\begin{itemize}
\item $\cC(pt) = \ob(C)$ .
\item Let $R$ be a 1-manifold and $c \in \cC(\bd R)$.
Then an element of $\cC(R; c)$ is a collection of (transversely oriented)
points in the interior
of $R$, each labeled by a morphism of $C$.
The intervals between the points are labeled by objects of $C$, consistent with
the boundary condition $c$ and the domains and ranges of the point labels.
\item There is an evaluation map $e: \cC(I; a, b) \to \mor(a, b)$ given by
composing the morphism labels of the points.
Note that we also need the * of *-1-category here in order to make all the morphisms point
the same way.
\item For $x \in \mor(a, b)$ let $\chi(x) \in \cC(I; a, b)$ be the field with a single
point (at some standard location) labeled by $x$.
Then the kernel of the evaluation map $U(I; a, b)$ is generated by things of the
form $y - \chi(e(y))$.
Thus we can, if we choose, restrict the blob twig labels to things of this form.
\end{itemize}

We want to show that $HB_*(S^1)$ is naturally isomorphic to the
Hochschild homology of $C$.
\nn{Or better that the complexes are homotopic
or quasi-isomorphic.}
In order to prove this we will need to extend the blob complex to allow points to also
be labeled by elements of $C$-$C$-bimodules.
%Given an interval (1-ball) so labeled, there is an evaluation map to some tensor product
%(over $C$) of $C$-$C$-bimodules.
%Define the local relations $U(I; a, b)$ to be the direct sum of the kernels of these maps.
%Now we can define the blob complex for $S^1$.
%This complex is the sum of complexes with a fixed cyclic tuple of bimodules present.
%If $M$ is a $C$-$C$-bimodule, let $G_*(M)$ denote the summand of $\bc_*(S^1)$ corresponding
%to the cyclic 1-tuple $(M)$.
%In other words, $G_*(M)$ is a blob-like complex where exactly one point is labeled
%by an element of $M$ and the remaining points are labeled by morphisms of $C$.
%It's clear that $G_*(C)$ is isomorphic to the original bimodule-less
%blob complex for $S^1$.
%\nn{Is it really so clear?  Should say more.}

%\nn{alternative to the above paragraph:}
Fix points $p_1, \ldots, p_k \in S^1$ and $C$-$C$-bimodules $M_1, \ldots M_k$.
We define a blob-like complex $F_*(S^1, (p_i), (M_i))$.
The fields have elements of $M_i$ labeling $p_i$ and elements of $C$ labeling
other points.
The blob twig labels lie in kernels of evaluation maps.
(The range of these evaluation maps is a tensor product (over $C$) of $M_i$'s.)
Let $F_*(M) = F_*(S^1, (*), (M))$, where $* \in S^1$ is some standard base point.
In other words, fields for $F_*(M)$ have an element of $M$ at the fixed point $*$
and elements of $C$ at variable other points.

We claim that the homology of $F_*(M)$ is isomorphic to the Hochschild
homology of $M$.
\nn{Or maybe we should claim that $M \to F_*(M)$ is the/a derived coend.
Or maybe that $F_*(M)$ is quasi-isomorphic (or perhaps homotopic) to the Hochschild
complex of $M$.}
This follows from the following lemmas:
\begin{itemize}
\item $F_*(M_1 \oplus M_2) \cong F_*(M_1) \oplus F_*(M_2)$.
\item An exact sequence $0 \to M_1 \to M_2 \to M_3 \to 0$
gives rise to an exact sequence $0 \to F_*(M_1) \to F_*(M_2) \to F_*(M_3) \to 0$.
(See below for proof.)
\item $F_*(C\otimes C)$ (the free $C$-$C$-bimodule with one generator) is
quasi-isomorphic to the 0-step complex $C$.
(See below for proof.)
\item $F_*(C)$ (here $C$ is wearing its $C$-$C$-bimodule hat) is quasi-isomorphic to $\bc_*(S^1)$.
(See below for proof.)
\end{itemize}

First we show that $F_*(C\otimes C)$ is
quasi-isomorphic to the 0-step complex $C$.

Let $F'_* \sub F_*(C\otimes C)$ be the subcomplex where the label of
the point $*$ is $1 \otimes 1 \in C\otimes C$.
We will show that the inclusion $i: F'_* \to F_*(C\otimes C)$ is a quasi-isomorphism.

Fix a small $\ep > 0$.
Let $B_\ep$ be the ball of radius $\ep$ around $* \in S^1$.
Let $F^\ep_* \sub F_*(C\otimes C)$ be the subcomplex
generated by blob diagrams $b$ such that $B_\ep$ is either disjoint from
or contained in each blob of $b$, and the two boundary points of $B_\ep$ are not labeled points of $b$.
For a field (picture) $y$ on $B_\ep$, let $s_\ep(y)$ be the equivalent picture with~$*$
labeled by $1\otimes 1$ and the only other labeled points at distance $\pm\ep/2$ from $*$.
(See Figure xxxx.)
Note that $y - s_\ep(y) \in U(B_\ep)$.
\nn{maybe it's simpler to assume that there are no labeled points, other than $*$, in $B_\ep$.}

Define a degree 1 chain map $j_\ep : F^\ep_* \to F^\ep_*$ as follows.
Let $x \in F^\ep_*$ be a blob diagram.
If $*$ is not contained in any twig blob, $j_\ep(x)$ is obtained by adding $B_\ep$ to
$x$ as a new twig blob, with label $y - s_\ep(y)$, where $y$ is the restriction of $x$ to $B_\ep$.
If $*$ is contained in a twig blob $B$ with label $u = \sum z_i$, $j_\ep(x)$ is obtained as follows.
Let $y_i$ be the restriction of $z_i$ to $B_\ep$.
Let $x_i$ be equal to $x$ outside of $B$, equal to $z_i$ on $B \setmin B_\ep$,
and have an additional blob $B_\ep$ with label $y_i - s_\ep(y_i)$.
Define $j_\ep(x) = \sum x_i$.
\nn{need to check signs coming from blob complex differential}

Note that if $x \in F'_* \cap F^\ep_*$ then $j_\ep(x) \in F'_*$ also.

The key property of $j_\ep$ is
\eq{
    \bd j_\ep + j_\ep \bd = \id - \sigma_\ep ,
}
where $\sigma_\ep : F^\ep_* \to F^\ep_*$ is given by replacing the restriction $y$ of each field
mentioned in $x \in F^\ep_*$ with $s_\ep(y)$.
Note that $\sigma_\ep(x) \in F'_*$.

If $j_\ep$ were defined on all of $F_*(C\otimes C)$, it would show that $\sigma_\ep$
is a homotopy inverse to the inclusion $F'_* \to F_*(C\otimes C)$.
One strategy would be to try to stitch together various $j_\ep$ for progressively smaller
$\ep$ and show that $F'_*$ is homotopy equivalent to $F_*(C\otimes C)$.
Instead, we'll be less ambitious and just show that
$F'_*$ is quasi-isomorphic to $F_*(C\otimes C)$.

If $x$ is a cycle in $F_*(C\otimes C)$, then for sufficiently small $\ep$ we have
$x \in F_*^\ep$.
(This is true for any chain in $F_*(C\otimes C)$, since chains are sums of
finitely many blob diagrams.)
Then $x$ is homologous to $s_\ep(x)$, which is in $F'_*$, so the inclusion map
$F'_* \sub F_*(C\otimes C)$ is surjective on homology.
If $y \in F_*(C\otimes C)$ and $\bd y = x \in F'_*$, then $y \in F^\ep_*$ for some $\ep$
and
\eq{
    \bd y = \bd (\sigma_\ep(y) + j_\ep(x)) .
}
Since $\sigma_\ep(y) + j_\ep(x) \in F'$, it follows that the inclusion map is injective on homology.
This completes the proof that $F'_*$ is quasi-isomorphic to $F_*(C\otimes C)$.

\medskip

Let $F''_* \sub F'_*$ be the subcomplex of $F'_*$ where $*$ is not contained in any blob.
We will show that the inclusion $i: F''_* \to F'_*$ is a homotopy equivalence.

First, a lemma:  Let $G''_*$ and $G'_*$ be defined the same as $F''_*$ and $F'_*$, except with
$S^1$ replaced some (any) neighborhood of $* \in S^1$.
Then $G''_*$ and $G'_*$ are both contractible
and the inclusion $G''_* \sub G'_*$ is a homotopy equivalence.
For $G'_*$ the proof is the same as in (\ref{bcontract}), except that the splitting
$G'_0 \to H_0(G'_*)$ concentrates the point labels at two points to the right and left of $*$.
For $G''_*$ we note that any cycle is supported \nn{need to establish terminology for this; maybe
in ``basic properties" section above} away from $*$.
Thus any cycle lies in the image of the normal blob complex of a disjoint union
of two intervals, which is contractible by (\ref{bcontract}) and (\ref{disjunion}).
Actually, we need the further (easy) result that the inclusion
$G''_* \to G'_*$ induces an isomorphism on $H_0$.

Next we construct a degree 1 map (homotopy) $h: F'_* \to F'_*$ such that
for all $x \in F'_*$ we have
\eq{
    x - \bd h(x) - h(\bd x) \in F''_* .
}
Since $F'_0 = F''_0$, we can take $h_0 = 0$.
Let $x \in F'_1$, with single blob $B \sub S^1$.
If $* \notin B$, then $x \in F''_1$ and we define $h_1(x) = 0$.
If $* \in B$, then we work in the image of $G'_*$ and $G''_*$ (with respect to $B$).
Choose $x'' \in G''_1$ such that $\bd x'' = \bd x$.
Since $G'_*$ is contractible, there exists $y \in G'_2$ such that $\bd y = x - x''$.
Define $h_1(x) = y$.
The general case is similar, except that we have to take lower order homotopies into account.
Let $x \in F'_k$.
If $*$ is not contained in any of the blobs of $x$, then define $h_k(x) = 0$.
Otherwise, let $B$ be the outermost blob of $x$ containing $*$.
By xxxx above, $x = x' \bullet p$, where $x'$ is supported on $B$ and $p$ is supported away from $B$.
So $x' \in G'_l$ for some $l \le k$.
Choose $x'' \in G''_l$ such that $\bd x'' = \bd (x' - h_{l-1}\bd x')$.
Choose $y \in G'_{l+1}$ such that $\bd y = x' - x'' - h_{l-1}\bd x'$.
Define $h_k(x) = y \bullet p$.
This completes the proof that $i: F''_* \to F'_*$ is a homotopy equivalence.
\nn{need to say above more clearly and settle on notation/terminology}

Finally, we show that $F''_*$ is contractible.
\nn{need to also show that $H_0$ is the right thing; easy, but I won't do it now}
Let $x$ be a cycle in $F''_*$.
The union of the supports of the diagrams in $x$ does not contain $*$, so there exists a
ball $B \subset S^1$ containing the union of the supports and not containing $*$.
Adding $B$ as a blob to $x$ gives a contraction.
\nn{need to say something else in degree zero}

This completes the proof that $F_*(C\otimes C)$ is
homotopic to the 0-step complex $C$.

\medskip

Next we show that $F_*(C)$ is quasi-isomorphic to $\bc_*(S^1)$.
$F_*(C)$ differs from $\bc_*(S^1)$ only in that the base point *
is always a labeled point in $F_*(C)$, while in $\bc_*(S^1)$ it may or may not be.
In other words, there is an inclusion map $i: F_*(C) \to \bc_*(S^1)$.

We define a quasi-inverse \nn{right term?} $s: \bc_*(S^1) \to F_*(C)$ to the inclusion as follows.
If $y$ is a field defined on a neighborhood of *, define $s(y) = y$ if
* is a labeled point in $y$.
Otherwise, define $s(y)$ to be the result of adding a label 1 (identity morphism) at *.
Let $x \in \bc_*(S^1)$.
Let $s(x)$ be the result of replacing each field $y$ (containing *) mentioned in
$x$ with $y$.
It is easy to check that $s$ is a chain map and $s \circ i = \id$.

Let $G^\ep_* \sub \bc_*(S^1)$ be the subcomplex where there are no labeled points
in a neighborhood $B_\ep$ of *, except perhaps *.
Note that for any chain $x \in \bc_*(S^1)$, $x \in G^\ep_*$ for sufficiently small $\ep$.
\nn{rest of argument goes similarly to above}

\bigskip

\nn{still need to prove exactness claim}

\nn{What else needs to be said to establish quasi-isomorphism to Hochschild complex?
Do we need a map from hoch to blob?
Does the above exactness and contractibility guarantee such a map without writing it
down explicitly?
Probably it's worth writing down an explicit map even if we don't need to.}


We can also describe explicitly a map from the standard Hochschild
complex to the blob complex on the circle. \nn{What properties does this
map have?}

\begin{figure}%
$$\mathfig{0.6}{barycentric/barycentric}$$
\caption{The Hochschild chain $a \tensor b \tensor c$ is sent to
the sum of six blob $2$-chains, corresponding to a barycentric subdivision of a $2$-simplex.}
\label{fig:Hochschild-example}%
\end{figure}

As an example, Figure \ref{fig:Hochschild-example} shows the image of the Hochschild chain $a \tensor b \tensor c$. Only the $0$-cells are shown explicitly.
The edges marked $x, y$ and $z$ carry the $1$-chains
\begin{align*}
x & = \mathfig{0.1}{barycentric/ux} & u_x = \mathfig{0.1}{barycentric/ux_ca} - \mathfig{0.1}{barycentric/ux_c-a} \\
y & = \mathfig{0.1}{barycentric/uy} & u_y = \mathfig{0.1}{barycentric/uy_cab} - \mathfig{0.1}{barycentric/uy_ca-b} \\
z & = \mathfig{0.1}{barycentric/uz} & u_z = \mathfig{0.1}{barycentric/uz_c-a-b} - \mathfig{0.1}{barycentric/uz_cab}
\end{align*}
and the $2$-chain labelled $A$ is
\begin{equation*}
A = \mathfig{0.1}{barycentric/Ax}+\mathfig{0.1}{barycentric/Ay}.
\end{equation*}
Note that we then have
\begin{equation*}
\bdy A = x+y+z.
\end{equation*}

In general, the Hochschild chain $\Tensor_{i=1}^n a_i$ is sent to the sum of $n!$ blob $(n-1)$-chains, indexed by permutations,
$$\phi\left(\Tensor_{i=1}^n a_i) = \sum_{\pi} \phi^\pi(a_1, \ldots, a_n)$$
with ... (hmmm, problems making this precise; you need to decide where to put the labels, but then it's hard to make an honest chain map!)


\section{Action of $C_*(\Diff(X))$}  \label{diffsect}

Let $CD_*(X)$ denote $C_*(\Diff(X))$, the singular chain complex of
the space of diffeomorphisms
of the $n$-manifold $X$ (fixed on $\bd X$).
For convenience, we will permit the singular cells generating $CD_*(X)$ to be more general
than simplices --- they can be based on any linear polyhedron.
\nn{be more restrictive here?  does more need to be said?}

\begin{prop}  \label{CDprop}
For each $n$-manifold $X$ there is a chain map
\eq{
    e_X : CD_*(X) \otimes \bc_*(X) \to \bc_*(X) .
}
On $CD_0(X) \otimes \bc_*(X)$ it agrees with the obvious action of $\Diff(X)$ on $\bc_*(X)$
(Proposition (\ref{diff0prop})).
For any splitting $X = X_1 \cup X_2$, the following diagram commutes
\eq{ \xymatrix{
     CD_*(X) \otimes \bc_*(X) \ar[r]^{e_X}    & \bc_*(X) \\
     CD_*(X_1) \otimes CD_*(X_2) \otimes \bc_*(X_1) \otimes \bc_*(X_2)
        \ar@/_4ex/[r]_{e_{X_1} \otimes e_{X_2}}  \ar[u]^{\gl \otimes \gl}  &
            \bc_*(X_1) \otimes \bc_*(X_2) \ar[u]_{\gl}
} }
Any other map satisfying the above two properties is homotopic to $e_X$.
\end{prop}

The proof will occupy the remainder of this section.

\medskip

Let $f: P \times X \to X$ be a family of diffeomorphisms and $S \sub X$.
We say that {\it $f$ is supported on $S$} if $f(p, x) = f(q, x)$ for all
$x \notin S$ and $p, q \in P$.
Note that if $f$ is supported on $S$ then it is also supported on any $R \sup S$.

Let $\cU = \{U_\alpha\}$ be an open cover of $X$.
A $k$-parameter family of diffeomorphisms $f: P \times X \to X$ is
{\it adapted to $\cU$} if there is a factorization
\eq{
    P = P_1 \times \cdots \times P_m
}
(for some $m \le k$)
and families of diffeomorphisms
\eq{
    f_i :  P_i \times X \to X
}
such that
\begin{itemize}
\item each $f_i(p, \cdot): X \to X$ is supported on some connected $V_i \sub X$;
\item the $V_i$'s are mutually disjoint;
\item each $V_i$ is the union of at most $k_i$ of the $U_\alpha$'s,
where $k_i = \dim(P_i)$; and
\item $f(p, \cdot) = f_1(p_1, \cdot) \circ \cdots \circ f_m(p_m, \cdot) \circ g$
for all $p = (p_1, \ldots, p_m)$, for some fixed $g \in \Diff(X)$.
\end{itemize}
A chain $x \in C_k(\Diff(X))$ is (by definition) adapted to $\cU$ if it is the sum
of singular cells, each of which is adapted to $\cU$.

\begin{lemma}  \label{extension_lemma}
Let $x \in CD_k(X)$ be a singular chain such that $\bd x$ is adapted to $\cU$.
Then $x$ is homotopic (rel boundary) to some $x' \in CD_k(X)$ which is adapted to $\cU$.
\end{lemma}

The proof will be given in Section \ref{fam_diff_sect}.

\medskip

Let $B_1, \ldots, B_m$ be a collection of disjoint balls in $X$
(e.g.~the support of a blob diagram).
We say that $f:P\times X\to X$ is {\it compatible} with $\{B_j\}$ if
$f$ has support a disjoint collection of balls $D_i \sub X$ and for all $i$ and $j$
either $B_j \sub D_i$ or $B_j \cap D_i = \emptyset$.
A chain $x \in CD_k(X)$ is compatible with $\{B_j\}$ if it is a sum of singular cells,
each of which is compatible.
(Note that we could strengthen the definition of compatibility to incorporate
a factorization condition, similar to the definition of ``adapted to" above.
The weaker definition given here will suffice for our needs below.)

\begin{cor}  \label{extension_lemma_2}
Let $x \in CD_k(X)$ be a singular chain such that $\bd x$ is compatible with $\{B_j\}$.
Then $x$ is homotopic (rel boundary) to some $x' \in CD_k(X)$ which is compatible with $\{B_j\}$.
\end{cor}
\begin{proof}
This will follow from Lemma \ref{extension_lemma} for
appropriate choice of cover $\cU = \{U_\alpha\}$.
Let $U_{\alpha_1}, \ldots, U_{\alpha_k}$ be any $k$ open sets of $\cU$, and let
$V_1, \ldots, V_m$ be the connected components of $U_{\alpha_1}\cup\cdots\cup U_{\alpha_k}$.
Choose $\cU$ fine enough so that there exist disjoint balls $B'_j \sup B_j$ such that for all $i$ and $j$
either $V_i \sub B'_j$ or $V_i \cap B'_j = \emptyset$.

Apply Lemma \ref{extension_lemma} first to each singular cell $f_i$ of $\bd x$,
with the (compatible) support of $f_i$ in place of $X$.
This insures that the resulting homotopy $h_i$ is compatible.
Now apply Lemma \ref{extension_lemma} to $x + \sum h_i$.
\nn{actually, need to start with the 0-skeleton of $\bd x$, then 1-skeleton, etc.; fix this}
\end{proof}

\medskip

((argument continues roughly as follows: up to homotopy, there is only one way to define $e_X$
on compatible $x\otimes y \in CD_*(X)\otimes \bc_*(X)$.
This is because $x$ is the gluing of $x'$ and $x''$, where $x'$ has degree zero and is defined on
the complement of the $D_i$'s, and $x''$ is defined on the $D_i$'s.
We have no choice on $x'$, since we already know the map on 0-parameter families of diffeomorphisms.
We have no choice, up to homotopy, on $x''$, since the target chain complex is contractible.))


\section{Families of Diffeomorphisms}  \label{fam_diff_sect}


Lo, the proof of Lemma (\ref{extension_lemma}):

\nn{should this be an appendix instead?}

\nn{for pedagogical reasons, should do $k=1,2$ cases first; probably do this in
later draft}

\nn{not sure what the best way to deal with boundary is; for now just give main argument, worry
about boundary later}

Recall that we are given
an open cover $\cU = \{U_\alpha\}$ and an
$x \in CD_k(X)$ such that $\bd x$ is adapted to $\cU$.
We must find a homotopy of $x$ (rel boundary) to some $x' \in CD_k(X)$ which is adapted to $\cU$.

Let $\{r_\alpha : X \to [0,1]\}$ be a partition of unity for $\cU$.

As a first approximation to the argument we will eventually make, let's replace $x$
with a single singular cell
\eq{
    f: P \times X \to X .
}
Also, we'll ignore for now issues around $\bd P$.

Our homotopy will have the form
\eqar{
    F: I \times P \times X &\to& X \\
    (t, p, x) &\mapsto& f(u(t, p, x), x)
}
for some function
\eq{
    u : I \times P \times X \to P .
}
First we describe $u$, then we argue that it does what we want it to do.

For each cover index $\alpha$ choose a cell decomposition $K_\alpha$ of $P$.
The various $K_\alpha$ should be in general position with respect to each other.
We will see below that the $K_\alpha$'s need to be sufficiently fine in order
to insure that $F$ above is a homotopy through diffeomorphisms of $X$ and not
merely a homotopy through maps $X\to X$.

Let $L$ be the union of all the $K_\alpha$'s.
$L$ is itself a cell decomposition of $P$.
\nn{next two sentences not needed?}
To each cell $a$ of $L$ we associate the tuple $(c_\alpha)$,
where $c_\alpha$ is the codimension of the cell of $K_\alpha$ which contains $c$.
Since the $K_\alpha$'s are in general position, we have $\sum c_\alpha \le k$.

Let $J$ denote the handle decomposition of $P$ corresponding to $L$.
Each $i$-handle $C$ of $J$ has an $i$-dimensional tangential coordinate and,
more importantly, a $k{-}i$-dimensional normal coordinate.

For each (top-dimensional) $k$-cell $c$ of each $K_\alpha$, choose a point $p_c \in c \sub P$.
Let $D$ be a $k$-handle of $J$, and let $D$ also denote the corresponding
$k$-cell of $L$.
To $D$ we associate the tuple $(c_\alpha)$ of $k$-cells of the $K_\alpha$'s
which contain $d$, and also the corresponding tuple $(p_{c_\alpha})$ of points in $P$.

For $p \in D$ we define
\eq{
    u(t, p, x) = (1-t)p + t \sum_\alpha r_\alpha(x) p_{c_\alpha} .
}
(Recall that $P$ is a single linear cell, so the weighted average of points of $P$
makes sense.)

So far we have defined $u(t, p, x)$ when $p$ lies in a $k$-handle of $J$.
For handles of $J$ of index less than $k$, we will define $u$ to
interpolate between the values on $k$-handles defined above.

If $p$ lies in a $k{-}1$-handle $E$, let $\eta : E \to [0,1]$ be the normal coordinate
of $E$.
In particular, $\eta$ is equal to 0 or 1 only at the intersection of $E$
with a $k$-handle.
Let $\beta$ be the index of the $K_\beta$ containing the $k{-}1$-cell
corresponding to $E$.
Let $q_0, q_1 \in P$ be the points associated to the two $k$-cells of $K_\beta$
adjacent to the $k{-}1$-cell corresponding to $E$.
For $p \in E$, define
\eq{
    u(t, p, x) = (1-t)p + t \left( \sum_{\alpha \ne \beta} r_\alpha(x) p_{c_\alpha}
            + r_\beta(x) (\eta(p) q_1 + (1-\eta(p)) q_0) \right) .
}

In general, for $E$ a $k{-}j$-handle, there is a normal coordinate
$\eta: E \to R$, where $R$ is some $j$-dimensional polyhedron.
The vertices of $R$ are associated to $k$-cells of the $K_\alpha$, and thence to points of $P$.
If we triangulate $R$ (without introducing new vertices), we can linearly extend
a map from the vertices of $R$ into $P$ to a map of all of $R$ into $P$.
Let $\cN$ be the set of all $\beta$ for which $K_\beta$ has a $k$-cell whose boundary meets
the $k{-}j$-cell corresponding to $E$.
For each $\beta \in \cN$, let $\{q_{\beta i}\}$ be the set of points in $P$ associated to the aforementioned $k$-cells.
Now define, for $p \in E$,
\eq{
    u(t, p, x) = (1-t)p + t \left(
            \sum_{\alpha \notin \cN} r_\alpha(x) p_{c_\alpha}
                + \sum_{\beta \in \cN} r_\beta(x) \left( \sum_i \eta_{\beta i}(p) \cdot q_{\beta i} \right)
             \right) .
}
Here $\eta_{\beta i}(p)$ is the weight given to $q_{\beta i}$ by the linear extension
mentioned above.

This completes the definition of $u: I \times P \times X \to P$.

\medskip

Next we verify that $u$ has the desired properties.

Since $u(0, p, x) = p$ for all $p\in P$ and $x\in X$, $F(0, p, x) = f(p, x)$ for all $p$ and $x$.
Therefore $F$ is a homotopy from $f$ to something.

Next we show that if the $K_\alpha$'s are sufficiently fine cell decompositions,
then $F$ is a homotopy through diffeomorphisms.
We must show that the derivative $\pd{F}{x}(t, p, x)$ is non-singular for all $(t, p, x)$.
We have
\eq{
%   \pd{F}{x}(t, p, x) = \pd{f}{x}(u(t, p, x), x) + \pd{f}{p}(u(t, p, x), x) \pd{u}{x}(t, p, x) .
    \pd{F}{x} = \pd{f}{x} + \pd{f}{p} \pd{u}{x} .
}
Since $f$ is a family of diffeomorphisms, $\pd{f}{x}$ is non-singular and
\nn{bounded away from zero, or something like that}.
(Recall that $X$ and $P$ are compact.)
Also, $\pd{f}{p}$ is bounded.
So if we can insure that $\pd{u}{x}$ is sufficiently small, we are done.
It follows from Equation xxxx above that $\pd{u}{x}$ depends on $\pd{r_\alpha}{x}$
(which is bounded)
and the differences amongst the various $p_{c_\alpha}$'s and $q_{\beta i}$'s.
These differences are small if the cell decompositions $K_\alpha$ are sufficiently fine.
This completes the proof that $F$ is a homotopy through diffeomorphisms.

\medskip

Next we show that for each handle $D \sub P$, $F(1, \cdot, \cdot) : D\times X \to X$
is a singular cell adapted to $\cU$.
This will complete the proof of the lemma.
\nn{except for boundary issues and the `$P$ is a cell' assumption}

Let $j$ be the codimension of $D$.
(Or rather, the codimension of its corresponding cell.  From now on we will not make a distinction
between handle and corresponding cell.)
Then $j = j_1 + \cdots + j_m$, $0 \le m \le k$,
where the $j_i$'s are the codimensions of the $K_\alpha$
cells of codimension greater than 0 which intersect to form $D$.
We will show that
if the relevant $U_\alpha$'s are disjoint, then
$F(1, \cdot, \cdot) : D\times X \to X$
is a product of singular cells of dimensions $j_1, \ldots, j_m$.
If some of the relevant $U_\alpha$'s intersect, then we will get a product of singular
cells whose dimensions correspond to a partition of the $j_i$'s.
We will consider some simple special cases first, then do the general case.

First consider the case $j=0$ (and $m=0$).
A quick look at Equation xxxx above shows that $u(1, p, x)$, and hence $F(1, p, x)$,
is independent of $p \in P$.
So the corresponding map $D \to \Diff(X)$ is constant.

Next consider the case $j = 1$ (and $m=1$, $j_1=1$).
Now Equation yyyy applies.
We can write $D = D'\times I$, where the normal coordinate $\eta$ is constant on $D'$.
It follows that the singular cell $D \to \Diff(X)$ can be written as a product
of a constant map $D' \to \Diff(X)$ and a singular 1-cell $I \to \Diff(X)$.
The singular 1-cell is supported on $U_\beta$, since $r_\beta = 0$ outside of this set.

Next case: $j=2$, $m=1$, $j_1 = 2$.
This is similar to the previous case, except that the normal bundle is 2-dimensional instead of
1-dimensional.
We have that $D \to \Diff(X)$ is a product of a constant singular $k{-}2$-cell
and a 2-cell with support $U_\beta$.

Next case: $j=2$, $m=2$, $j_1 = j_2 = 1$.
In this case the codimension 2 cell $D$ is the intersection of two
codimension 1 cells, from $K_\beta$ and $K_\gamma$.
We can write $D = D' \times I \times I$, where the normal coordinates are constant
on $D'$, and the two $I$ factors correspond to $\beta$ and $\gamma$.
If $U_\beta$ and $U_\gamma$ are disjoint, then we can factor $D$ into a constant $k{-}2$-cell and
two 1-cells, supported on $U_\beta$ and $U_\gamma$ respectively.
If $U_\beta$ and $U_\gamma$ intersect, then we can factor $D$ into a constant $k{-}2$-cell and
a 2-cell supported on $U_\beta \cup U_\gamma$.
\nn{need to check that this is true}

\nn{finally, general case...}

\nn{this completes proof}




\section{$A_\infty$ action on the boundary}

Let $Y$ be an $n{-}1$-manifold.
The collection of complexes $\{\bc_*(Y\times I; a, b)\}$, where $a, b \in \cC(Y)$ are boundary
conditions on $\bd(Y\times I) = Y\times \{0\} \cup Y\times\{1\}$, has the structure
of an $A_\infty$ category.

Composition of morphisms (multiplication) depends of a choice of homeomorphism
$I\cup I \cong I$.  Given this choice, gluing gives a map
\eq{
    \bc_*(Y\times I; a, b) \otimes \bc_*(Y\times I; b, c) \to \bc_*(Y\times (I\cup I); a, c)
            \cong \bc_*(Y\times I; a, c)
}
Using (\ref{CDprop}) and the inclusion $\Diff(I) \sub \Diff(Y\times I)$ gives the various
higher associators of the $A_\infty$ structure, more or less canonically.

\nn{is this obvious?  does more need to be said?}

Let $\cA(Y)$ denote the $A_\infty$ category $\bc_*(Y\times I; \cdot, \cdot)$.

Similarly, if $Y \sub \bd X$, a choice of collaring homeomorphism
$(Y\times I) \cup_Y X \cong X$ gives the collection of complexes $\bc_*(X; r, a)$
(variable $a \in \cC(Y)$; fixed $r \in \cC(\bd X \setmin Y)$) the structure of a representation of the
$A_\infty$ category $\{\bc_*(Y\times I; \cdot, \cdot)\}$.
Again the higher associators come from the action of $\Diff(I)$ on a collar neighborhood
of $Y$ in $X$.

In the next section we use the above $A_\infty$ actions to state and prove
a gluing theorem for the blob complexes of $n$-manifolds.







\section{Gluing}  \label{gluesect}

Let $Y$ be an $n{-}1$-manifold and let $X$ be an $n$-manifold with a copy
of $Y \du -Y$ contained in its boundary.
Gluing the two copies of $Y$ together we obtain a new $n$-manifold $X\sgl$.
We wish to describe the blob complex of $X\sgl$ in terms of the blob complex
of $X$.
More precisely, we want to describe $\bc_*(X\sgl; c\sgl)$,
where $c\sgl \in \cC(\bd X\sgl)$,
in terms of the collection $\{\bc_*(X; c, \cdot, \cdot)\}$, thought of as a representation
of the $A_\infty$ category $\cA(Y\du-Y) \cong \cA(Y)\times \cA(Y)\op$.

\begin{thm}
$\bc_*(X\sgl; c\sgl)$ is quasi-isomorphic to the the self tensor product
of $\{\bc_*(X; c, \cdot, \cdot)\}$ over $\cA(Y)$.
\end{thm}

The proof will occupy the remainder of this section.

\nn{...}

\bigskip

\nn{need to define/recall def of (self) tensor product over an $A_\infty$ category}





\section{Extension to ...}

\nn{Need to let the input $n$-category $C$ be a graded thing
(e.g.~DGA or $A_\infty$ $n$-category).}

\nn{maybe this should be done earlier in the exposition?
if we can plausibly claim that the various proofs work almost
the same with the extended def, then maybe it's better to extend late (here)}


\section{What else?...}

\begin{itemize}
\item Derive Hochschild standard results from blob point of view?
\item $n=2$ examples
\item Kh
\item dimension $n+1$ (generalized Deligne conjecture?)
\item should be clear about PL vs Diff; probably PL is better
(or maybe not)
\item say what we mean by $n$-category, $A_\infty$ or $E_\infty$ $n$-category
\item something about higher derived coend things (derived 2-coend, e.g.)
\end{itemize}





\end{document}



%Recall that for $n$-category picture fields there is an evaluation map
%$m: \bc_0(B^n; c, c') \to \mor(c, c')$.
%If we regard $\mor(c, c')$ as a complex concentrated in degree 0, then this becomes a chain
%map $m: \bc_*(B^n; c, c') \to \mor(c, c')$.
