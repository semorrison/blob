\documentclass[11pt,leqno]{amsart}

\newcommand{\pathtotrunk}{./}
\input{text/article_preamble.tex}
\input{text/top_matter.tex}

% test edit #3

%%%%% excerpts from my include file of standard macros

\def\bc{{\mathcal B}}

\def\z{\mathbb{Z}}
\def\r{\mathbb{R}}
\def\c{\mathbb{C}}
\def\t{\mathbb{T}}

\def\du{\sqcup}
\def\bd{\partial}
\def\sub{\subset}
\def\sup{\supset}
%\def\setmin{\smallsetminus}
\def\setmin{\setminus}
\def\ep{\epsilon}
\def\sgl{_\mathrm{gl}}
\def\op{^\mathrm{op}}
\def\deq{\stackrel{\mathrm{def}}{=}}
\def\pd#1#2{\frac{\partial #1}{\partial #2}}

\def\nn#1{{{\it \small [#1]}}}


% equations
\newcommand{\eq}[1]{\begin{displaymath}#1\end{displaymath}}
\newcommand{\eqar}[1]{\begin{eqnarray*}#1\end{eqnarray*}}
\newcommand{\eqspl}[1]{\begin{displaymath}\begin{split}#1\end{split}\end{displaymath}}

% tricky way to iterate macros over a list
\def\semicolon{;}
\def\applytolist#1{
    \expandafter\def\csname multi#1\endcsname##1{
        \def\multiack{##1}\ifx\multiack\semicolon
            \def\next{\relax}
        \else
            \csname #1\endcsname{##1}
            \def\next{\csname multi#1\endcsname}
        \fi
        \next}
    \csname multi#1\endcsname}

% \def\cA{{\cal A}} for A..Z
\def\calc#1{\expandafter\def\csname c#1\endcsname{{\mathcal #1}}}
\applytolist{calc}QWERTYUIOPLKJHGFDSAZXCVBNM;

% \DeclareMathOperator{\pr}{pr} etc.
\def\declaremathop#1{\expandafter\DeclareMathOperator\csname #1\endcsname{#1}}
\applytolist{declaremathop}{pr}{im}{id}{gl}{ev}{coinv}{tr}{rot}{Eq}{obj}{mor}{ob}{Rep}{Tet}{cat}{Maps}{Diff}{sign}{supp}{maps};



%%%%%% end excerpt





\title{Blob Homology}

\begin{document}



\makeatletter
\@addtoreset{equation}{section}
\gdef\theequation{\thesection.\arabic{equation}}
\makeatother


\maketitle

\textbf{Draft version, do not distribute.}

\versioninfo

\section*{Todo}

\subsection*{What else?...}

\begin{itemize}
\item Derive Hochschild standard results from blob point of view?
\item $n=2$ examples
\item Kh
\item dimension $n+1$ (generalized Deligne conjecture?)
\item should be clear about PL vs Diff; probably PL is better
(or maybe not)
\item say what we mean by $n$-category, $A_\infty$ or $E_\infty$ $n$-category
\item something about higher derived coend things (derived 2-coend, e.g.)
\end{itemize}


\section{Introduction}

(motivation, summary/outline, etc.)

(motivation:
(1) restore exactness in pictures-mod-relations;
(1') add relations-amongst-relations etc. to pictures-mod-relations;
(2) want answer independent of handle decomp (i.e. don't
just go from coend to derived coend (e.g. Hochschild homology));
(3) ...
)



We then show that blob homology enjoys the following
\ref{property:gluing} properties.

\begin{property}[Functoriality]
\label{property:functoriality}%
Blob homology is functorial with respect to diffeomorphisms. That is, fixing an $n$-dimensional system of fields $\cF$ and local relations $\cU$, the association
\begin{equation*}
X \mapsto \bc_*^{\cF,\cU}(X)
\end{equation*}
is a functor from $n$-manifolds and diffeomorphisms between them to chain complexes and isomorphisms between them.
\scott{Do we want to or need to weaken `isomorphisms' to `homotopy equivalences' or `quasi-isomorphisms'?}
\end{property}

\begin{property}[Disjoint union]
\label{property:disjoint-union}
The blob complex of a disjoint union is naturally the tensor product of the blob complexes.
\begin{equation*}
\bc_*(X_1 \sqcup X_2) \iso \bc_*(X_1) \tensor \bc_*(X_2)
\end{equation*}
\end{property}

\begin{property}[A map for gluing]
\label{property:gluing-map}%
If $X_1$ and $X_2$ are $n$-manifolds, with $Y$ a codimension $0$-submanifold of $\bdy X_1$, and $Y^{\text{op}}$ a codimension $0$-submanifold of $\bdy X_2$,
there is a chain map
\begin{equation*}
\gl_Y: \bc_*(X_1) \tensor \bc_*(X_2) \to \bc_*(X_1 \cup_Y X_2).
\end{equation*}
\end{property}

\begin{property}[Contractibility]
\label{property:contractibility}%
\todo{Err, requires a splitting?}
The blob complex for an $n$-category on an $n$-ball is quasi-isomorphic to its $0$-th homology.
\begin{equation}
\xymatrix{\bc_*^{\cC}(B^n) \ar[r]^{\iso}_{\text{qi}} & H_0(\bc_*^{\cC}(B^n))}
\end{equation}
\todo{Say that this is just the original $n$-category?}
\end{property}

\begin{property}[Skein modules]
\label{property:skein-modules}%
The $0$-th blob homology of $X$ is the usual skein module associated to $X$. (See \S \ref{sec:local-relations}.)
\begin{equation*}
H_0(\bc_*^{\cF,\cU}(X)) \iso A^{\cF,\cU}(X)
\end{equation*}
\end{property}

\begin{property}[Hochschild homology when $X=S^1$]
\label{property:hochschild}%
The blob complex for a $1$-category $\cC$ on the circle is
quasi-isomorphic to the Hochschild complex.
\begin{equation*}
\xymatrix{\bc_*^{\cC}(S^1) \ar[r]^{\iso}_{\text{qi}} & HC_*(\cC)}
\end{equation*}
\end{property}

\begin{property}[Evaluation map]
\label{property:evaluation}%
There is an `evaluation' chain map
\begin{equation*}
\ev_X: \CD{X} \tensor \bc_*(X) \to \bc_*(X).
\end{equation*}
(Here $\CD{X}$ is the singular chain complex of the space of diffeomorphisms of $X$, fixed on $\bdy X$.)

Restricted to $C_0(\Diff(X))$ this is just the action of diffeomorphisms described in Property \ref{property:functoriality}. Further, for
any codimension $1$-submanifold $Y \subset X$ dividing $X$ into $X_1 \cup_Y X_2$, the following diagram
(using the gluing maps described in Property \ref{property:gluing-map}) commutes.
\begin{equation*}
\xymatrix{
     \CD{X} \otimes \bc_*(X) \ar[r]^{\ev_X}    & \bc_*(X) \\
     \CD{X_1} \otimes \CD{X_2} \otimes \bc_*(X_1) \otimes \bc_*(X_2)
        \ar@/_4ex/[r]_{\ev_{X_1} \otimes \ev_{X_2}}  \ar[u]^{\gl^{\Diff}_Y \otimes \gl_Y}  &
            \bc_*(X_1) \otimes \bc_*(X_2) \ar[u]_{\gl_Y}
}
\end{equation*}
\end{property}

\begin{property}[Gluing formula]
\label{property:gluing}%
\mbox{}% <-- gets the indenting right
\begin{itemize}
\item For any $(n-1)$-manifold $Y$, the blob homology of $Y \times I$ is
naturally an $A_\infty$ category. % We'll write $\bc_*(Y)$ for $\bc_*(Y \times I)$ below.

\item For any $n$-manifold $X$, with $Y$ a codimension $0$-submanifold of its boundary, the blob homology of $X$ is naturally an
$A_\infty$ module for $\bc_*(Y \times I)$.

\item For any $n$-manifold $X$, with $Y \cup Y^{\text{op}}$ a codimension
$0$-submanifold of its boundary, the blob homology of $X'$, obtained from
$X$ by gluing along $Y$, is the $A_\infty$ self-tensor product of
$\bc_*(X)$ as an $\bc_*(Y \times I)$-bimodule.
\begin{equation*}
\bc_*(X') \iso \bc_*(X) \Tensor^{A_\infty}_{\mathclap{\bc_*(Y \times I)}}
\end{equation*}
\todo{How do you write self tensor product?}
\end{itemize}
\end{property}

Properties \ref{property:functoriality}, \ref{property:gluing-map} and \ref{property:skein-modules} will be immediate from the definition given in
\S \ref{sec:blob-definition}, and we'll recall them at the appropriate points there. \todo{Make sure this gets done.}
Properties \ref{property:disjoint-union} and \ref{property:contractibility} are established in \S \ref{sec:basic-properties}.
Property \ref{property:hochschild} is established in \S \ref{sec:hochschild}, Property \ref{property:evaluation} in \S \ref{sec:evaluation},
and Property \ref{property:gluing} in \S \ref{sec:gluing}.

\section{Definitions}
\label{sec:definitions}

\subsection{Systems of fields}
\label{sec:fields}

Fix a top dimension $n$.

A {\it system of fields}
\nn{maybe should look for better name; but this is the name I use elsewhere}
is a collection of functors $\cC$ from manifolds of dimension $n$ or less
to sets.
These functors must satisfy various properties (see \cite{kw:tqft} for details).
For example:
there is a canonical identification $\cC(X \du Y) = \cC(X) \times \cC(Y)$;
there is a restriction map $\cC(X) \to \cC(\bd X)$;
gluing manifolds corresponds to fibered products of fields;
given a field $c \in \cC(Y)$ there is a ``product field"
$c\times I \in \cC(Y\times I)$; ...
\nn{should eventually include full details of definition of fields.}

\nn{note: probably will suppress from notation the distinction
between fields and their (orientation-reversal) duals}

\nn{remark that if top dimensional fields are not already linear
then we will soon linearize them(?)}

The definition of a system of fields is intended to generalize
the relevant properties of the following two examples of fields.

The first example: Fix a target space $B$ and define $\cC(X)$ (where $X$
is a manifold of dimension $n$ or less) to be the set of
all maps from $X$ to $B$.

The second example will take longer to explain.
Given an $n$-category $C$ with the right sort of duality
(e.g. pivotal 2-category, 1-category with duals, star 1-category, disklike $n$-category),
we can construct a system of fields as follows.
Roughly speaking, $\cC(X)$ will the set of all embedded cell complexes in $X$
with codimension $i$ cells labeled by $i$-morphisms of $C$.
We'll spell this out for $n=1,2$ and then describe the general case.

If $X$ has boundary, we require that the cell decompositions are in general
position with respect to the boundary --- the boundary intersects each cell
transversely, so cells meeting the boundary are mere half-cells.

Put another way, the cell decompositions we consider are dual to standard cell
decompositions of $X$.

We will always assume that our $n$-categories have linear $n$-morphisms.

For $n=1$, a field on a 0-manifold $P$ is a labeling of each point of $P$ with
an object (0-morphism) of the 1-category $C$.
A field on a 1-manifold $S$ consists of
\begin{itemize}
    \item A cell decomposition of $S$ (equivalently, a finite collection
of points in the interior of $S$);
    \item a labeling of each 1-cell (and each half 1-cell adjacent to $\bd S$)
by an object (0-morphism) of $C$;
    \item a transverse orientation of each 0-cell, thought of as a choice of
``domain" and ``range" for the two adjacent 1-cells; and
    \item a labeling of each 0-cell by a morphism (1-morphism) of $C$, with
domain and range determined by the transverse orientation and the labelings of the 1-cells.
\end{itemize}

If $C$ is an algebra (i.e. if $C$ has only one 0-morphism) we can ignore the labels
of 1-cells, so a field on a 1-manifold $S$ is a finite collection of points in the
interior of $S$, each transversely oriented and each labeled by an element (1-morphism)
of the algebra.

\medskip

For $n=2$, fields are just the sort of pictures based on 2-categories (e.g.\ tensor categories)
that are common in the literature.
We describe these carefully here.

A field on a 0-manifold $P$ is a labeling of each point of $P$ with
an object of the 2-category $C$.
A field of a 1-manifold is defined as in the $n=1$ case, using the 0- and 1-morphisms of $C$.
A field on a 2-manifold $Y$ consists of
\begin{itemize}
    \item A cell decomposition of $Y$ (equivalently, a graph embedded in $Y$ such
that each component of the complement is homeomorphic to a disk);
    \item a labeling of each 2-cell (and each partial 2-cell adjacent to $\bd Y$)
by a 0-morphism of $C$;
    \item a transverse orientation of each 1-cell, thought of as a choice of
``domain" and ``range" for the two adjacent 2-cells;
    \item a labeling of each 1-cell by a 1-morphism of $C$, with
domain and range determined by the transverse orientation of the 1-cell
and the labelings of the 2-cells;
    \item for each 0-cell, a homeomorphism of the boundary $R$ of a small neighborhood
of the 0-cell to $S^1$ such that the intersections of the 1-cells with $R$ are not mapped
to $\pm 1 \in S^1$; and
    \item a labeling of each 0-cell by a 2-morphism of $C$, with domain and range
determined by the labelings of the 1-cells and the parameterizations of the previous
bullet.
\end{itemize}
\nn{need to say this better; don't try to fit everything into the bulleted list}

For general $n$, a field on a $k$-manifold $X^k$ consists of
\begin{itemize}
    \item A cell decomposition of $X$;
    \item an explicit general position homeomorphism from the link of each $j$-cell
to the boundary of the standard $(k-j)$-dimensional bihedron; and
    \item a labeling of each $j$-cell by a $(k-j)$-dimensional morphism of $C$, with
domain and range determined by the labelings of the link of $j$-cell.
\end{itemize}

%\nn{next definition might need some work; I think linearity relations should
%be treated differently (segregated) from other local relations, but I'm not sure
%the next definition is the best way to do it}

\medskip

For top dimensional ($n$-dimensional) manifolds, we're actually interested
in the linearized space of fields.
By default, define $\cC_l(X) = \c[\cC(X)]$; that is, $\cC_l(X)$ is
the vector space of finite
linear combinations of fields on $X$.
If $X$ has boundary, we of course fix a boundary condition: $\cC_l(X; a) = \c[\cC(X; a)]$.
Thus the restriction (to boundary) maps are well defined because we never
take linear combinations of fields with differing boundary conditions.

In some cases we don't linearize the default way; instead we take the
spaces $\cC_l(X; a)$ to be part of the data for the system of fields.
In particular, for fields based on linear $n$-category pictures we linearize as follows.
Define $\cC_l(X; a) = \c[\cC(X; a)]/K$, where $K$ is the space generated by
obvious relations on 0-cell labels.
More specifically, let $L$ be a cell decomposition of $X$
and let $p$ be a 0-cell of $L$.
Let $\alpha_c$ and $\alpha_d$ be two labelings of $L$ which are identical except that
$\alpha_c$ labels $p$ by $c$ and $\alpha_d$ labels $p$ by $d$.
Then the subspace $K$ is generated by things of the form
$\lambda \alpha_c + \alpha_d - \alpha_{\lambda c + d}$, where we leave it to the reader
to infer the meaning of $\alpha_{\lambda c + d}$.
Note that we are still assuming that $n$-categories have linear spaces of $n$-morphisms.

\nn{Maybe comment further: if there's a natural basis of morphisms, then no need;
will do something similar below; in general, whenever a label lives in a linear
space we do something like this; ? say something about tensor
product of all the linear label spaces?  Yes:}

For top dimensional ($n$-dimensional) manifolds, we linearize as follows.
Define an ``almost-field" to be a field without labels on the 0-cells.
(Recall that 0-cells are labeled by $n$-morphisms.)
To each unlabeled 0-cell in an almost field there corresponds a (linear) $n$-morphism
space determined by the labeling of the link of the 0-cell.
(If the 0-cell were labeled, the label would live in this space.)
We associate to each almost-labeling the tensor product of these spaces (one for each 0-cell).
We now define $\cC_l(X; a)$ to be the direct sum over all almost labelings of the
above tensor products.



\subsection{Local relations}
\label{sec:local-relations}

Let $B^n$ denote the standard $n$-ball.
A {\it local relation} is a collection subspaces $U(B^n; c) \sub \cC_l(B^n; c)$
(for all $c \in \cC(\bd B^n)$) satisfying the following (three?) properties.

\nn{Roughly, these are (1) the local relations imply (extended) isotopy;
(2) $U(B^n; \cdot)$ is an ideal w.r.t.\ gluing; and
(3) this ideal is generated by ``small" generators (contained in an open cover of $B^n$).
See \cite{kw:tqft} for details.  Need to transfer details to here.}

For maps into spaces, $U(B^n; c)$ is generated by things of the form $a-b \in \cC_l(B^n; c)$,
where $a$ and $b$ are maps (fields) which are homotopic rel boundary.

For $n$-category pictures, $U(B^n; c)$ is equal to the kernel of the evaluation map
$\cC_l(B^n; c) \to \mor(c', c'')$, where $(c', c'')$ is some (any) division of $c$ into
domain and range.

\nn{maybe examples of local relations before general def?}

Note that the $Y$ is an $n$-manifold which is merely homeomorphic to the standard $B^n$,
then any homeomorphism $B^n \to Y$ induces the same local subspaces for $Y$.
We'll denote these by $U(Y; c) \sub \cC_l(Y; c)$, $c \in \cC(\bd Y)$.
\nn{Is this true in high (smooth) dimensions?  Self-diffeomorphisms of $B^n$
rel boundary might not be isotopic to the identity.  OK for PL and TOP?}

Given a system of fields and local relations, we define the skein space
$A(Y^n; c)$ to be the space of all finite linear combinations of fields on
the $n$-manifold $Y$ modulo local relations.
The Hilbert space $Z(Y; c)$ for the TQFT based on the fields and local relations
is defined to be the dual of $A(Y; c)$.
(See \cite{kw:tqft} or xxxx for details.)

The blob complex is in some sense the derived version of $A(Y; c)$.



\subsection{The blob complex}
\label{sec:blob-definition}

Let $X$ be an $n$-manifold.
Assume a fixed system of fields.
In this section we will usually suppress boundary conditions on $X$ from the notation
(e.g. write $\cC_l(X)$ instead of $\cC_l(X; c)$).

We only consider compact manifolds, so if $Y \sub X$ is a closed codimension 0
submanifold of $X$, then $X \setmin Y$ implicitly means the closure
$\overline{X \setmin Y}$.

We will define $\bc_0(X)$, $\bc_1(X)$ and $\bc_2(X)$, then give the general case.

Define $\bc_0(X) = \cC_l(X)$.
(If $X$ has nonempty boundary, instead define $\bc_0(X; c) = \cC_l(X; c)$.
We'll omit this sort of detail in the rest of this section.)
In other words, $\bc_0(X)$ is just the space of all linearized fields on $X$.

$\bc_1(X)$ is the space of all local relations that can be imposed on $\bc_0(X)$.
More specifically, define a 1-blob diagram to consist of
\begin{itemize}
\item An embedded closed ball (``blob") $B \sub X$.
%\nn{Does $B$ need a homeo to the standard $B^n$?  I don't think so.
%(See note in previous subsection.)}
%\item A field (boundary condition) $c \in \cC(\bd B) = \cC(\bd(X \setmin B))$.
\item A field $r \in \cC(X \setmin B; c)$
(for some $c \in \cC(\bd B) = \cC(\bd(X \setmin B))$).
\item A local relation field $u \in U(B; c)$
(same $c$ as previous bullet).
\end{itemize}
%(Note that the field $c$ is determined (implicitly) as the boundary of $u$ and/or $r$,
%so we will omit $c$ from the notation.)
Define $\bc_1(X)$ to be the space of all finite linear combinations of
1-blob diagrams, modulo the simple relations relating labels of 0-cells and
also the label ($u$ above) of the blob.
\nn{maybe spell this out in more detail}
(See xxxx above.)
\nn{maybe restate this in terms of direct sums of tensor products.}

There is a map $\bd : \bc_1(X) \to \bc_0(X)$ which sends $(B, r, u)$ to $ru$, the linear
combination of fields on $X$ obtained by gluing $r$ to $u$.
In other words $\bd : \bc_1(X) \to \bc_0(X)$ is given by
just erasing the blob from the picture
(but keeping the blob label $u$).

Note that the skein space $A(X)$
is naturally isomorphic to $\bc_0(X)/\bd(\bc_1(X))) = H_0(\bc_*(X))$.

$\bc_2(X)$ is the space of all relations (redundancies) among the relations of $\bc_1(X)$.
More specifically, $\bc_2(X)$ is the space of all finite linear combinations of
2-blob diagrams (defined below), modulo the usual linear label relations.
\nn{and also modulo blob reordering relations?}

\nn{maybe include longer discussion to motivate the two sorts of 2-blob diagrams}

There are two types of 2-blob diagram: disjoint and nested.
A disjoint 2-blob diagram consists of
\begin{itemize}
\item A pair of disjoint closed balls (blobs) $B_0, B_1 \sub X$.
%\item Fields (boundary conditions) $c_i \in \cC(\bd B_i)$.
\item A field $r \in \cC(X \setmin (B_0 \cup B_1); c_0, c_1)$
(where $c_i \in \cC(\bd B_i)$).
\item Local relation fields $u_i \in U(B_i; c_i)$.
\end{itemize}
Define $\bd(B_0, B_1, r, u_0, u_1) = (B_1, ru_0, u_1) - (B_0, ru_1, u_0) \in \bc_1(X)$.
In other words, the boundary of a disjoint 2-blob diagram
is the sum (with alternating signs)
of the two ways of erasing one of the blobs.
It's easy to check that $\bd^2 = 0$.

A nested 2-blob diagram consists of
\begin{itemize}
\item A pair of nested balls (blobs) $B_0 \sub B_1 \sub X$.
\item A field $r \in \cC(X \setmin B_0; c_0)$
(for some $c_0 \in \cC(\bd B_0)$).
Let $r = r_1 \cup r'$, where $r_1 \in \cC(B_1 \setmin B_0; c_0, c_1)$
(for some $c_1 \in \cC(B_1)$) and
$r' \in \cC(X \setmin B_1; c_1)$.
\item A local relation field $u_0 \in U(B_0; c_0)$.
\end{itemize}
Define $\bd(B_0, B_1, r, u_0) = (B_1, r', r_1u_0) - (B_0, r, u_0)$.
Note that xxxx above guarantees that $r_1u_0 \in U(B_1)$.
As in the disjoint 2-blob case, the boundary of a nested 2-blob is the alternating
sum of the two ways of erasing one of the blobs.
If we erase the inner blob, the outer blob inherits the label $r_1u_0$.

Now for the general case.
A $k$-blob diagram consists of
\begin{itemize}
\item A collection of blobs $B_i \sub X$, $i = 0, \ldots, k-1$.
For each $i$ and $j$, we require that either $B_i \cap B_j$ is empty or
$B_i \sub B_j$ or $B_j \sub B_i$.
(The case $B_i = B_j$ is allowed.
If $B_i \sub B_j$ the boundaries of $B_i$ and $B_j$ are allowed to intersect.)
If a blob has no other blobs strictly contained in it, we call it a twig blob.
%\item Fields (boundary conditions) $c_i \in \cC(\bd B_i)$.
%(These are implied by the data in the next bullets, so we usually
%suppress them from the notation.)
%$c_i$ and $c_j$ must have identical restrictions to $\bd B_i \cap \bd B_j$
%if the latter space is not empty.
\item A field $r \in \cC(X \setmin B^t; c^t)$,
where $B^t$ is the union of all the twig blobs and $c^t \in \cC(\bd B^t)$.
\item For each twig blob $B_j$ a local relation field $u_j \in U(B_j; c_j)$,
where $c_j$ is the restriction of $c^t$ to $\bd B_j$.
If $B_i = B_j$ then $u_i = u_j$.
\end{itemize}

We define $\bc_k(X)$ to be the vector space of all finite linear combinations
of $k$-blob diagrams, modulo the linear label relations and
blob reordering relations defined in the remainder of this paragraph.
Let $x$ be a blob diagram with one undetermined $n$-morphism label.
The unlabeled entity is either a blob or a 0-cell outside of the twig blobs.
Let $a$ and $b$ be two possible $n$-morphism labels for
the unlabeled blob or 0-cell.
Let $c = \lambda a + b$.
Let $x_a$ be the blob diagram with label $a$, and define $x_b$ and $x_c$ similarly.
Then we impose the relation
\eq{
    x_c = \lambda x_a + x_b .
}
\nn{should do this in terms of direct sums of tensor products}
Let $x$ and $x'$ be two blob diagrams which differ only by a permutation $\pi$
of their blob labelings.
Then we impose the relation
\eq{
    x = \sign(\pi) x' .
}

(Alert readers will have noticed that for $k=2$ our definition
of $\bc_k(X)$ is slightly different from the previous definition
of $\bc_2(X)$ --- we did not impose the reordering relations.
The general definition takes precedence;
the earlier definition was simplified for purposes of exposition.)

The boundary map $\bd : \bc_k(X) \to \bc_{k-1}(X)$ is defined as follows.
Let $b = (\{B_i\}, r, \{u_j\})$ be a $k$-blob diagram.
Let $E_j(b)$ denote the result of erasing the $j$-th blob.
If $B_j$ is not a twig blob, this involves only decrementing
the indices of blobs $B_{j+1},\ldots,B_{k-1}$.
If $B_j$ is a twig blob, we have to assign new local relation labels
if removing $B_j$ creates new twig blobs.
If $B_l$ becomes a twig after removing $B_j$, then set $u_l = r_lu_j$,
where $r_l$ is the restriction of $r$ to $B_l \setmin B_j$.
Finally, define
\eq{
    \bd(b) = \sum_{j=0}^{k-1} (-1)^j E_j(b).
}
The $(-1)^j$ factors imply that the terms of $\bd^2(b)$ all cancel.
Thus we have a chain complex.

\nn{?? say something about the ``shape" of tree? (incl = cone, disj = product)}


\nn{TO DO:
expand definition to handle DGA and $A_\infty$ versions of $n$-categories;
relations to Chas-Sullivan string stuff}



\section{Basic properties of the blob complex}
\label{sec:basic-properties}

\begin{prop} \label{disjunion}
There is a natural isomorphism $\bc_*(X \du Y) \cong \bc_*(X) \otimes \bc_*(Y)$.
\end{prop}
\begin{proof}
Given blob diagrams $b_1$ on $X$ and $b_2$ on $Y$, we can combine them
(putting the $b_1$ blobs before the $b_2$ blobs in the ordering) to get a
blob diagram $(b_1, b_2)$ on $X \du Y$.
Because of the blob reordering relations, all blob diagrams on $X \du Y$ arise this way.
In the other direction, any blob diagram on $X\du Y$ is equal (up to sign)
to one that puts $X$ blobs before $Y$ blobs in the ordering, and so determines
a pair of blob diagrams on $X$ and $Y$.
These two maps are compatible with our sign conventions \nn{say more about this?} and
with the linear label relations.
The two maps are inverses of each other.
\nn{should probably say something about sign conventions for the differential
in a tensor product of chain complexes; ask Scott}
\end{proof}

For the next proposition we will temporarily restore $n$-manifold boundary
conditions to the notation.

Suppose that for all $c \in \cC(\bd B^n)$
we have a splitting $s: H_0(\bc_*(B^n, c)) \to \bc_0(B^n; c)$
of the quotient map
$p: \bc_0(B^n; c) \to H_0(\bc_*(B^n, c))$.
\nn{always the case if we're working over $\c$}.
Then
\begin{prop} \label{bcontract}
For all $c \in \cC(\bd B^n)$ the natural map $p: \bc_*(B^n, c) \to H_0(\bc_*(B^n, c))$
is a chain homotopy equivalence
with inverse $s: H_0(\bc_*(B^n, c)) \to \bc_*(B^n; c)$.
Here we think of $H_0(\bc_*(B^n, c))$ as a 1-step complex concentrated in degree 0.
\end{prop}
\begin{proof}
By assumption $p\circ s = \id$, so all that remains is to find a degree 1 map
$h : \bc_*(B^n; c) \to \bc_*(B^n; c)$ such that $\bd h + h\bd = \id - s \circ p$.
For $i \ge 1$, define $h_i : \bc_i(B^n; c) \to \bc_{i+1}(B^n; c)$ by adding
an $(i{+}1)$-st blob equal to all of $B^n$.
In other words, add a new outermost blob which encloses all of the others.
Define $h_0 : \bc_0(B^n; c) \to \bc_1(B^n; c)$ by setting $h_0(x)$ equal to
the 1-blob with blob $B^n$ and label $x - s(p(x)) \in U(B^n; c)$.
\nn{$x$ is a 0-blob diagram, i.e. $x \in \cC(B^n; c)$}
\end{proof}

(Note that for the above proof to work, we need the linear label relations
for blob labels.
Also we need to blob reordering relations (?).)

(Note also that if there is no splitting $s$, we can let $h_0 = 0$ and get a homotopy
equivalence to the 2-step complex $U(B^n; c) \to \cC(B^n; c)$.)

(For fields based on $n$-cats, $H_0(\bc_*(B^n; c)) \cong \mor(c', c'')$.)

\medskip

As we noted above,
\begin{prop}
There is a natural isomorphism $H_0(\bc_*(X)) \cong A(X)$.
\qed
\end{prop}


% oops -- duplicate

%\begin{prop} \label{functorialprop}
%The assignment $X \mapsto \bc_*(X)$ extends to a functor from the category of
%$n$-manifolds and homeomorphisms to the category of chain complexes and linear isomorphisms.
%\end{prop}

%\begin{proof}
%Obvious.
%\end{proof}

%\nn{need to same something about boundaries and boundary conditions above.
%maybe fix the boundary and consider the category of $n$-manifolds with the given boundary.}


\begin{prop}
For fixed fields ($n$-cat), $\bc_*$ is a functor from the category
of $n$-manifolds and diffeomorphisms to the category of chain complexes and
(chain map) isomorphisms.
\qed
\end{prop}

\nn{need to same something about boundaries and boundary conditions above.
maybe fix the boundary and consider the category of $n$-manifolds with the given boundary.}


In particular,
\begin{prop}  \label{diff0prop}
There is an action of $\Diff(X)$ on $\bc_*(X)$.
\qed
\end{prop}

The above will be greatly strengthened in Section \ref{sec:evaluation}.

\medskip

For the next proposition we will temporarily restore $n$-manifold boundary
conditions to the notation.

Let $X$ be an $n$-manifold, $\bd X = Y \cup (-Y) \cup Z$.
Gluing the two copies of $Y$ together yields an $n$-manifold $X\sgl$
with boundary $Z\sgl$.
Given compatible fields (pictures, boundary conditions) $a$, $b$ and $c$ on $Y$, $-Y$ and $Z$,
we have the blob complex $\bc_*(X; a, b, c)$.
If $b = -a$ (the orientation reversal of $a$), then we can glue up blob diagrams on
$X$ to get blob diagrams on $X\sgl$:

\begin{prop}
There is a natural chain map
\eq{
    \gl: \bigoplus_a \bc_*(X; a, -a, c) \to \bc_*(X\sgl; c\sgl).
}
The sum is over all fields $a$ on $Y$ compatible at their
($n{-}2$-dimensional) boundaries with $c$.
`Natural' means natural with respect to the actions of diffeomorphisms.
\qed
\end{prop}

The above map is very far from being an isomorphism, even on homology.
This will be fixed in Section \ref{sec:gluing} below.

An instance of gluing we will encounter frequently below is where $X = X_1 \du X_2$
and $X\sgl = X_1 \cup_Y X_2$.
(Typically one of $X_1$ or $X_2$ is a disjoint union of balls.)
For $x_i \in \bc_*(X_i)$, we introduce the notation
\eq{
    x_1 \bullet x_2 \deq \gl(x_1 \otimes x_2) .
}
Note that we have resumed our habit of omitting boundary labels from the notation.


\bigskip

\nn{what else?}

\section{Hochschild homology when $n=1$}
\label{sec:hochschild}
\input{text/hochschild}

\section{Action of $\CD{X}$}
\label{sec:evaluation}

Let $CD_*(X)$ denote $C_*(\Diff(X))$, the singular chain complex of
the space of diffeomorphisms
of the $n$-manifold $X$ (fixed on $\bd X$).
For convenience, we will permit the singular cells generating $CD_*(X)$ to be more general
than simplices --- they can be based on any linear polyhedron.
\nn{be more restrictive here?  does more need to be said?}

\begin{prop}  \label{CDprop}
For each $n$-manifold $X$ there is a chain map
\eq{
    e_X : CD_*(X) \otimes \bc_*(X) \to \bc_*(X) .
}
On $CD_0(X) \otimes \bc_*(X)$ it agrees with the obvious action of $\Diff(X)$ on $\bc_*(X)$
(Proposition (\ref{diff0prop})).
For any splitting $X = X_1 \cup X_2$, the following diagram commutes
\eq{ \xymatrix{
     CD_*(X) \otimes \bc_*(X) \ar[r]^{e_X}    & \bc_*(X) \\
     CD_*(X_1) \otimes CD_*(X_2) \otimes \bc_*(X_1) \otimes \bc_*(X_2)
        \ar@/_4ex/[r]_{e_{X_1} \otimes e_{X_2}}  \ar[u]^{\gl \otimes \gl}  &
            \bc_*(X_1) \otimes \bc_*(X_2) \ar[u]_{\gl}
} }
Any other map satisfying the above two properties is homotopic to $e_X$.
\end{prop}

\nn{need to rewrite for self-gluing instead of gluing two pieces together}

\nn{Should say something stronger about uniqueness.
Something like: there is
a contractible subcomplex of the complex of chain maps
$CD_*(X) \otimes \bc_*(X) \to \bc_*(X)$ (0-cells are the maps, 1-cells are homotopies, etc.),
and all choices in the construction lie in the 0-cells of this
contractible subcomplex.
Or maybe better to say any two choices are homotopic, and
any two homotopies and second order homotopic, and so on.}

\nn{Also need to say something about associativity.
Put it in the above prop or make it a separate prop?
I lean toward the latter.}
\medskip

The proof will occupy the remainder of this section.
\nn{unless we put associativity prop at end}

\medskip

Let $f: P \times X \to X$ be a family of diffeomorphisms and $S \sub X$.
We say that {\it $f$ is supported on $S$} if $f(p, x) = f(q, x)$ for all
$x \notin S$ and $p, q \in P$.
Note that if $f$ is supported on $S$ then it is also supported on any $R \sup S$.

Let $\cU = \{U_\alpha\}$ be an open cover of $X$.
A $k$-parameter family of diffeomorphisms $f: P \times X \to X$ is
{\it adapted to $\cU$} if there is a factorization
\eq{
    P = P_1 \times \cdots \times P_m
}
(for some $m \le k$)
and families of diffeomorphisms
\eq{
    f_i :  P_i \times X \to X
}
such that
\begin{itemize}
\item each $f_i(p, \cdot): X \to X$ is supported on some connected $V_i \sub X$;
\item the $V_i$'s are mutually disjoint;
\item each $V_i$ is the union of at most $k_i$ of the $U_\alpha$'s,
where $k_i = \dim(P_i)$; and
\item $f(p, \cdot) = f_1(p_1, \cdot) \circ \cdots \circ f_m(p_m, \cdot) \circ g$
for all $p = (p_1, \ldots, p_m)$, for some fixed $g \in \Diff(X)$.
\end{itemize}
A chain $x \in C_k(\Diff(X))$ is (by definition) adapted to $\cU$ if it is the sum
of singular cells, each of which is adapted to $\cU$.

\begin{lemma}  \label{extension_lemma}
Let $x \in CD_k(X)$ be a singular chain such that $\bd x$ is adapted to $\cU$.
Then $x$ is homotopic (rel boundary) to some $x' \in CD_k(X)$ which is adapted to $\cU$.
Furthermore, one can choose the homotopy so that its support is equal to the support of $x$.
\end{lemma}

The proof will be given in Section \ref{sec:localising}.

\medskip

The strategy for the proof of Proposition \ref{CDprop} is as follows.
We will identify a subcomplex
\[
    G_* \sub CD_*(X) \otimes \bc_*(X)
\]
on which the evaluation map is uniquely determined (up to homotopy) by the conditions
in \ref{CDprop}.
We then show that the inclusion of $G_*$ into the full complex
is an equivalence in the appropriate sense.
\nn{need to be more specific here}

Let $p$ be a singular cell in $CD_*(X)$ and $b$ be a blob diagram in $\bc_*(X)$.
Roughly speaking, $p\otimes b$ is in $G_*$ if each component $V$ of the support of $p$
intersects at most one blob $B$ of $b$.
Since $V \cup B$ might not itself be a ball, we need a more careful and complicated definition.
Choose a metric for $X$.
We define $p\otimes b$ to be in $G_*$ if there exist $\epsilon > 0$ such that
$\supp(p) \cup N_\epsilon(b)$ is a union of balls, where $N_\epsilon(b)$ denotes the epsilon
neighborhood of the support of $b$.
\nn{maybe also require that $N_\delta(b)$ is a union of balls for all $\delta<\epsilon$.}

\nn{need to worry about case where the intrinsic support of $p$ is not a union of balls}

\nn{need to eventually show independence of choice of metric.  maybe there's a better way than
choosing a metric.  perhaps just choose a nbd of each ball, but I think I see problems
with that as well.
the bottom line is that we need a scheme for choosing unions of balls
which satisfies the $C$, $C'$, $C''$ claim made a few paragraphs below.}

Next we define the evaluation map $e_X$ on $G_*$.
We'll proceed inductively on $G_i$.
The induction starts on $G_0$, where the evaluation map is determined
by the action of $\Diff(X)$ on $\bc_*(X)$
because $G_0 \sub CD_0\otimes \bc_0$.
Assume we have defined the evaluation map up to $G_{k-1}$ and
let $p\otimes b$ be a generator of $G_k$.
Let $C \sub X$ be a union of balls (as described above) containing $\supp(p)\cup\supp(b)$.
There is a factorization $p = p' \circ g$, where $g\in \Diff(X)$ and $p'$ is a family of diffeomorphisms which is the identity outside of $C$.
\scott{Shouldn't this be $p = g\circ p'$?}
Let $b = b'\bullet b''$, where $b' \in \bc_*(C)$ and $b'' \in \bc_0(X\setmin C)$.
We may assume inductively \scott{why? I don't get this.} that $e_X(\bd(p\otimes b))$ has the form $x\bullet g(b'')$, where
$x \in \bc_*(g(C))$.
Since $\bc_*(g(C))$ is contractible, there exists $y \in \bc_*(g(C))$ such that $\bd y = x$.
\nn{need to say more if degree of $x$ is 0}
Define $e_X(p\otimes b) = y\bullet g(b'')$.

We now show that $e_X$ on $G_*$ is, up to homotopy, independent of the various choices made.
If we make a different series of choice of the chain $y$ in the previous paragraph,
we can inductively construct a homotopy between the two sets of choices,
again relying on the contractibility of $\bc_*(g(G))$.
A similar argument shows that this homotopy is unique up to second order homotopy, and so on.

Given a different set of choices $\{C'\}$ of the unions of balls $\{C\}$,
we can find a third set of choices $\{C''\}$ such that $C, C' \sub C''$.
The argument now proceeds as in the previous paragraph.
\nn{should maybe say more here; also need to back up claim about third set of choices}

Next we show that given $x \in CD_*(X) \otimes \bc_*(X)$ with $\bd x \in G_*$, there exists
a homotopy (rel $\bd x$) to $x' \in G_*$, and further that $x'$ and
this homotopy are unique up to iterated homotopy.

Given $k>0$ and a blob diagram $b$, we say that a cover $\cU$ of $X$ is $k$-compatible with
$b$ if, for any $\{U_1, \ldots, U_k\} \sub \cU$, the union
$U_1\cup\cdots\cup U_k$ is a union of balls which satisfies the condition used to define $G_*$ above.
Note that if a family of diffeomorphisms $p$ is adapted to
$\cU$ and $b$ is a blob diagram occurring in $x$ \scott{huh, what's $x$ here?}, then $p\otimes b \in G_*$.
\nn{maybe emphasize this more; it's one of the main ideas in the proof}

Let $k$ be the degree of $x$ and choose a cover $\cU$ of $X$ such that $\cU$ is
$k$-compatible with each of the (finitely many) blob diagrams occurring in $x$.
We will use Lemma \ref{extension_lemma} with respect to the cover $\cU$ to
construct the homotopy to $G_*$.
First we will construct a homotopy $h \in G_*$ from $\bd x$ to a cycle $z$ such that
each family of diffeomorphisms $p$ occurring in $z$ is adapted to $\cU$.
Then we will construct a homotopy (rel boundary) $r$ from $x + h$ to $y$ such that
each family of diffeomorphisms $p$ occurring in $y$ is adapted to $\cU$.
This implies that $y \in G_*$.
The homotopy $r$ can also be thought of as a homotopy from $x$ to $y-h \in G_*$, and this is the homotopy we seek.

We will define $h$ inductively on bidegrees $(0, k-1), (1, k-2), \ldots, (k-1, 0)$.
Define $h$ to be zero on bidegree $(0, k-1)$.
Let $p\otimes b$ be a generator occurring in $\bd x$ with bidegree $(1, k-2)$.
Using Lemma \ref{extension_lemma}, construct a homotopy $q$ from $p$ to $p'$ which is adapted to $\cU$.
Define $h$ at $p\otimes b$ to be $q\otimes b$.
Let $p'\otimes b'$ be a generator occurring in $\bd x$ with bidegree $(2, k-3)$.
Let $a$ be that portion of $\bd(p'\otimes b')$ which intersects the boundary of
bidegree $(1, k-2)$ stuff.
Apply Lemma \ref{extension_lemma} to $p'$ plus the diffeo part of $h(a)$
(rel the outer boundary of said part),
yielding a family of diffeos $q'$.
\nn{definitely need to say this better}
Define $h$ at $p'\otimes b'$ to be $q'\otimes b'$.
Continuing in this way, we define all of $h$.

The homotopy $r$ is constructed similarly.

\nn{need to say something about uniqueness of $r$, $h$ etc.
postpone this until second draft.}

At this point, we have finished defining the evaluation map.
The uniqueness statement in the proposition is clear from the method of proof.
All that remains is to show that the evaluation map gets along well with cutting and gluing,
as claimed in the proposition.
This is in fact not difficult, since the myriad choices involved in defining the
evaluation map can be made in parallel for the top and bottom
arrows in the commutative diagram.

This completes the proof of Proposition \ref{CDprop}.

\medskip

\nn{say something about associativity here}

\section{Gluing}
\label{sec:gluing}%

\subsection{`Topological' $A_\infty$ $n$-categories}
\label{sec:topological-A-infty}%

This section prepares the ground for establishing Property \ref{property:gluing} by defining the notion of a \emph{topological $A_\infty$-$n$-category}.
The main result of this section is

\begin{thm}
Topological $A_\infty$-$1$-categories are equivalent to `standard'
$A_\infty$-$1$-categories.
\end{thm}

Before proving this theorem, we embark upon a long string of definitions.
For expository purposes, we begin with the $n=1$ special cases, and define
first topological $A_\infty$-algebras, then topological $A_\infty$-categories, and then topological $A_\infty$-modules over these. We then turn
to the general $n$ case, defining topological $A_\infty$-$n$-categories and their modules.
\nn{Something about duals?}
\todo{Explain that we're not making contact with any previous notions for the general $n$ case?}
\kevin{probably we should say something about the relation
to [framed] $E_\infty$ algebras
}

\todo{}
Various citations we might want to make:
\begin{itemize}
\item \cite{MR2061854} McClure and Smith's review article
\item \cite{MR0420610} May, (inter alia, definition of $E_\infty$ operad)
\item \cite{MR0236922,MR0420609} Boardman and Vogt
\item \cite{MR1256989} definition of framed little-discs operad
\end{itemize}

\begin{defn}
\label{defn:topological-algebra}%
A ``topological $A_\infty$-algebra'' $A$ consists of the following data.
\begin{enumerate}
\item For each $1$-manifold $J$ diffeomorphic to the standard interval
$I=\left[0,1\right]$, a complex of vector spaces $A(J)$.
% either roll functoriality into the evaluation map
\item For each pair of intervals $J,J'$ an `evaluation' chain map
$\ev_{J \to J'} : \CD{J \to J'} \tensor A(J) \to A(J')$.
\item For each decomposition of intervals $J = J'\cup J''$,
a gluing map $\gl_{J,J'} : A(J') \tensor A(J'') \to A(J)$.
% or do it as two separate pieces of data
%\item along with an `evaluation' chain map $\ev_J : \CD{J} \tensor A(J) \to A(J)$,
%\item for each diffeomorphism $\phi : J \to J'$, an isomorphism $A(\phi) : A(J) \isoto A(J')$,
%\item and for each pair of intervals $J,J'$ a gluing map $\gl_{J,J'} : A(J) \tensor A(J') \to A(J \cup J')$,
\end{enumerate}
This data is required to satisfy the following conditions.
\begin{itemize}
\item The evaluation chain map is associative, in that the diagram
\begin{equation*}
\xymatrix{
\CD{J' \to J''} \tensor \CD{J \to J'} \tensor A(J) \ar[r]^{\Id \tensor \ev_{J \to J'}} \ar[d]_{\compose \tensor \Id} &
\CD{J' \to J''} \tensor A(J') \ar[d]^{\ev_{J' \to J''}} \\
\CD{J \to J''} \tensor A(J) \ar[r]_{\ev_{J \to J''}} &
A(J'')
}
\end{equation*}
commutes.
\kevin{commutes up to homotopy? in the blob case the evaluation map is ambiguous up to homotopy}
(Here the map $\compose : \CD{J' \to J''} \tensor \CD{J \to J'} \to \CD{J \to J''}$ is a composition: take products of singular chains first, then compose diffeomorphisms.)
%% or the version for separate pieces of data:
%\item If $\phi$ is a diffeomorphism from $J$ to itself, the maps $\ev_J(\phi, -)$ and $A(\phi)$ are the same.
%\item The evaluation chain map is associative, in that the diagram
%\begin{equation*}
%\xymatrix{
%\CD{J} \tensor \CD{J} \tensor A(J) \ar[r]^{\Id \tensor \ev_J} \ar[d]_{\compose \tensor \Id} &
%\CD{J} \tensor A(J) \ar[d]^{\ev_J} \\
%\CD{J} \tensor A(J) \ar[r]_{\ev_J} &
%A(J)
%}
%\end{equation*}
%commutes. (Here the map $\compose : \CD{J} \tensor \CD{J} \to \CD{J}$ is a composition: take products of singular chains first, then use the group multiplication in $\Diff(J)$.)
\item The gluing maps are \emph{strictly} associative. That is, given $J$, $J'$ and $J''$, the diagram
\begin{equation*}
\xymatrix{
A(J) \tensor A(J') \tensor A(J'') \ar[rr]^{\gl_{J,J'} \tensor \Id} \ar[d]_{\Id \tensor \gl_{J',J''}} &&
A(J \cup J') \tensor A(J'') \ar[d]^{\gl_{J \cup J', J''}} \\
A(J) \tensor A(J' \cup J'') \ar[rr]_{\gl_{J, J' \cup J''}} &&
A(J \cup J' \cup J'')
}
\end{equation*}
commutes.
\item The gluing and evaluation maps are compatible.
\nn{give diagram, or just say ``in the obvious way", or refer to diagram in blob eval map section?}
\end{itemize}
\end{defn}

\begin{rem}
We can restrict the evaluation map to $0$-chains, and see that $J \mapsto A(J)$ and $(\phi:J \to J') \mapsto \ev_{J \to J'}(\phi, \bullet)$ together
constitute a functor from the category of intervals and diffeomorphisms between them to the category of complexes of vector spaces.
Further, once this functor has been specified, we only need to know how the evaluation map acts when $J = J'$.
\end{rem}

%% if we do things separately, we should say this:
%\begin{rem}
%Of course, the first and third pieces of data (the complexes, and the isomorphisms) together just constitute a functor from the category of
%intervals and diffeomorphisms between them to the category of complexes of vector spaces.
%Further, one can combine the second and third pieces of data, asking instead for a map
%\begin{equation*}
%\ev_{J,J'} : \CD{J \to J'} \tensor A(J) \to A(J').
%\end{equation*}
%(Any $k$-parameter family of diffeomorphisms in $C_k(\Diff(J \to J'))$ factors into a single diffeomorphism $J \to J'$ and a $k$-parameter family of
%diffeomorphisms in $\CD{J'}$.)
%\end{rem}

To generalise the definition to that of a category, we simply introduce a set of objects which we call $A(pt)$. Now we associate complexes to each
interval with boundary conditions $(J, c_-, c_+)$, with $c_-, c_+ \in A(pt)$, and only ask for gluing maps when the boundary conditions match up:
\begin{equation*}
\gl : A(J, c_-, c_0) \tensor A(J', c_0, c_+) \to A(J \cup J', c_-, c_+).
\end{equation*}
The action of diffeomorphisms (and of $k$-parameter families of diffeomorphisms) ignores the boundary conditions.
\todo{we presumably need to say something about $\Id_c \in A(J, c, c)$.}

At this point we can give two motivating examples. The first is `chains of maps to $M$' for some fixed target space $M$.
\begin{defn}
Define the topological $A_\infty$ category $C_*(\Maps(\bullet \to M))$ by
\begin{enumerate}
\item $A(J) = C_*(\Maps(J \to M))$, singular chains on the space of smooth maps from $J$ to $M$,
\item $\ev_{J,J'} : \CD{J \to J'} \tensor A(J) \to A(J')$ is the composition
\begin{align*}
\CD{J \to J'} \tensor C_*(\Maps(J \to M)) & \to C_*(\Diff(J \to J') \times \Maps(J \to M)) \\ & \to C_*(\Maps(J' \to M)),
\end{align*}
where the first map is the product of singular chains, and the second is precomposition by the inverse of a diffeomorphism\todo{inverse, really?!},
\kevin{I think that's fine.  If we recoil at taking inverses,
we should use smooth maps instead of diffeos}
\item $\gl_{J,J'} : A(J) \tensor A(J')$ takes the product of singular chains, then glues maps to $M$ together.
\end{enumerate}
The associativity conditions are trivially satisfied.
\end{defn}

The second example is simply the blob complex of $Y \times J$, for any $n-1$ manifold $Y$. We define $A(J) = \bc_*(Y \times J)$.
Observe $\Diff(J \to J')$ embeds into $\Diff(Y \times J \to Y \times J')$. The evaluation and gluing maps then come directly from Properties
\ref{property:evaluation} and \ref{property:gluing-map} respectively.

The definition of a module follows closely the definition of an algebra or category.
\begin{defn}
\label{defn:topological-module}%
A topological $A_\infty$-(left-)module $M$ over a topological $A_\infty$ category $A$
consists of the following data.
\begin{enumerate}
\item A functor $K \mapsto M(K)$ from $1$-manifolds diffeomorphic to the standard interval, with a marked point on a upper boundary, to complexes of vector spaces.
\item For each pair of such marked intervals,
an `evaluation' chain map $\ev_{K\to K'} : \CD{K \to K'} \tensor M(K) \to M(K')$.
\item For each decomposition $K = J\cup K'$ of the marked interval
$K$ into an unmarked interval $J$ and a marked interval $K'$, a gluing map
$\gl_{J,K'} : A(J) \tensor M(K') \to M(K)$.
\end{enumerate}
The above data is required to satisfy
conditions analogous to those in Definition \ref{defn:topological-algebra}.
\end{defn}

Any manifold $X$ with $\bdy X = Y$ (or indeed just with $Y$ a codimension $0$-submanifold of $\bdy X$) becomes a topological $A_\infty$ module over
$\bc_*(Y)$, the topological $A_\infty$ category described above. For each interval $K$, we have $M(K) = \bc_*((Y \times K) \cup_Y X)$.
(Here we glue $Y \times pt$ to $X$, where $pt$ is the marked point of $K$.) Again, the evaluation and gluing maps come directly from Properties
\ref{property:evaluation} and \ref{property:gluing-map} respectively.

The definition of a bimodule is like the definition of a module,
except that we have two disjoint marked intervals $K$ and $L$, one with a marked point
on the upper boundary and the other with a marked point on the lower boundary.
There are evaluation maps corresponding to gluing unmarked intervals
to the unmarked ends of $K$ and $L$.

Let $X$ be an $n$-manifold with a copy of $Y \du -Y$ embedded as a
codimension-0 submanifold of $\bdy X$.
Then the the assignment $K,L \mapsto \bc*(X \cup_Y (Y\times K) \cup_{-Y} (-Y\times L))$ has the
structure of a topological $A_\infty$ bimodule over $\bc_*(Y)$.

Next we define the coend
(or gluing or tensor product or self tensor product, depending on the context)
$\gl(M)$ of a topological $A_\infty$ bimodule $M$.
$\gl(M)$ is defined to be the universal thing with the following structure.

\begin{itemize}
\item For each interval $N$ with both endpoints marked, a complex of vector spaces C(N).
\item For each pair of intervals $N,N'$ an evaluation chain map
$\ev_{N \to N'} : \CD{N \to N'} \tensor C(N) \to C(N')$.
\item For each decomposition of intervals $N = K\cup L$,
a gluing map $\gl_{K,L} : M(K,L) \to C(N)$.
\item The evaluation maps are associative.
\nn{up to homotopy?}
\item Gluing is strictly associative.
That is, given a decomposition $N = K\cup J\cup L$, the chain maps associated to
$K\du J\du L \to (K\cup J)\du L \to N$ and $K\du J\du L \to K\du (J\cup L) \to N$
agree.
\item the gluing and evaluation maps are compatible.
\end{itemize}

Bu universal we mean that given any other collection of chain complexes, evaluation maps
and gluing maps, they factor through the universal thing.
\nn{need to say this in more detail, in particular give the properties of the factoring map}

Given $X$ and $Y\du -Y \sub \bdy X$ as above, the assignment
$N \mapsto \bc_*(X \cup_{Y\du -Y} (N\times Y)$ clearly has the structure described
in the above bullet points.
Showing that it is the universal such thing is the content of the gluing theorem proved below.

The definitions for a topological $A_\infty$-$n$-category are very similar to the above
$n=1$ case.
One replaces intervals with manifolds diffeomorphic to the ball $B^n$.
Marked points are replaced by copies of $B^{n-1}$ in $\bdy B^n$.

\nn{give examples: $A(J^n) = \bc_*(Z\times J)$ and $A(J^n) = C_*(\Maps(J \to M))$.}

\todo{the motivating example $C_*(\maps(X, M))$}



\newcommand{\skel}[1]{\operatorname{skeleton}(#1)}

Given a topological $A_\infty$-category $\cC$, we can construct an `algebraic' $A_\infty$ category $\skel{\cC}$. First, pick your
favorite diffeomorphism $\phi: I \cup I \to I$.
\begin{defn}
We'll write $\skel{\cC} = (A, m_k)$. Define $A = \cC(I)$, and $m_2 : A \tensor A \to A$ by
\begin{equation*}
m_2 \cC(I) \tensor \cC(I) \xrightarrow{\gl_{I,I}} \cC(I \cup I) \xrightarrow{\cC(\phi)} \cC(I).
\end{equation*}
Next, we define all the `higher associators' $m_k$ by
\todo{}
\end{defn}

Give an `algebraic' $A_\infty$ category $(A, m_k)$, we can construct a topological $A_\infty$-category, which we call $\bc_*^A$. You should
think of this as a generalisation of the blob complex, although the construction we give will \emph{not} specialise to exactly the usual definition
in the case the $A$ is actually an associative category.

We'll first define $\cT_{k,n}$ to be the set of planar forests consisting of $n-k$ trees, with a total of $n$ leaves. Thus
\todo{$\cT_{0,n}$ has 1 element, with $n$ vertical lines, $\cT_{1,n}$ has $n-1$ elements, each with a single trivalent vertex, $\cT_{2,n}$ etc...}
\begin{align*}
\end{align*}

\begin{defn}
The topological $A_\infty$ category $\bc_*^A$ is doubly graded, by `blob degree' and `internal degree'. We'll write $\bc_k^A$ for the blob degree $k$ piece.
The homological degree of an element $a \in \bc_*^A(J)$
is the sum of the blob degree and the internal degree.

We first define $\bc_0^A(J)$ as a vector space by
\begin{equation*}
\bc_0^A(J) = \DirectSum_{\substack{\{J_i\}_{i=1}^n \\ \mathclap{\bigcup_i J_i = J}}} \Tensor_{i=1}^n (\CD{J_i \to I} \tensor A).
\end{equation*}
(That is, for each division of $J$ into finitely many subintervals,
we have the tensor product of chains of diffeomorphisms from each subinterval to the standard interval,
and a copy of $A$ for each subinterval.)
The internal degree of an element $(f_1 \tensor a_1, \ldots, f_n \tensor a_n)$ is the sum of the dimensions of the singular chains
plus the sum of the homological degrees of the elements of $A$.
The differential is defined just by the graded Leibniz rule and the differentials on $\CD{J_i \to I}$ and on $A$.

Next,
\begin{equation*}
\bc_1^A(J) = \DirectSum_{\substack{\{J_i\}_{i=1}^n \\ \mathclap{\bigcup_i J_i = J}}} \DirectSum_{T \in \cT_{1,n}} \Tensor_{i=1}^n (\CD{J_i \to I} \tensor A).
\end{equation*}
\end{defn}

\begin{figure}[!ht]
\begin{equation*}
\mathfig{0.7}{associahedron/A4-vertices}
\end{equation*}
\caption{The vertices of the $k$-dimensional associahedron are indexed by binary trees on $k+2$ leaves.}
\label{fig:A4-vertices}
\end{figure}

\begin{figure}[!ht]
\begin{equation*}
\mathfig{0.7}{associahedron/A4-faces}
\end{equation*}
\caption{The faces of the $k$-dimensional associahedron are indexed by trees with $2$ vertices on $k+2$ leaves.}
\label{fig:A4-vertices}
\end{figure}

\newcommand{\tm}{\widetilde{m}}

Let $\tm_1(a) = a$.

We now define $\bdy(\tm_k(a_1 \tensor \cdots \tensor a_k))$, first giving an opaque formula, then explaining the combinatorics behind it.
\begin{align}
\notag \bdy(\tm_k(a_1 & \tensor \cdots \tensor a_k)) = \\
\label{eq:bdy-tm-k-1}   & \phantom{+} \sum_{\ell'=0}^{k-1} (-1)^{\abs{\tm_k}+\sum_{j=1}^{\ell'} \abs{a_j}} \tm_k(a_1 \tensor \cdots \tensor \bdy a_{\ell'+1} \tensor \cdots \tensor a_k) + \\
\label{eq:bdy-tm-k-2}   &          +  \sum_{\ell=1}^{k-1} \tm_{\ell}(a_1 \tensor \cdots \tensor a_{\ell}) \tensor \tm_{k-\ell}(a_{\ell+1} \tensor \cdots \tensor a_k) + \\
\label{eq:bdy-tm-k-3}   &          +  \sum_{\ell=1}^{k-1} \sum_{\ell'=0}^{l-1} (-1)^{\abs{\tm_k}+\sum_{j=1}^{\ell'} \abs{a_j}} \tm_{\ell}(a_1 \tensor \cdots \tensor m_{k-\ell + 1}(a_{\ell' + 1} \tensor \cdots \tensor a_{\ell' + k - \ell + 1}) \tensor \cdots \tensor a_k)
\end{align}
The first set of terms in $\bdy(\tm_k(a_1 \tensor \cdots \tensor a_k))$ just have $\bdy$ acting on each argument $a_i$.
The terms appearing in \eqref{eq:bdy-tm-k-2} and \eqref{eq:bdy-tm-k-3} are indexed by trees with $2$ vertices on $k+1$ leaves.
Note here that we have one more leaf than there arguments of $\tm_k$.
(See Figure \ref{fig:A4-vertices}, in which the rightmost branches are helpfully drawn in red.)
We will treat the vertices which involve a rightmost (red) branch differently from the vertices which only involve the first $k$ leaves.
The terms in \eqref{eq:bdy-tm-k-2} arise in the cases in which both
vertices are rightmost, and the corresponding term in $\bdy(\tm_k(a_1 \tensor \cdots \tensor a_k))$ is a tensor product of the form
$$\tm_{\ell}(a_1 \tensor \cdots \tensor a_{\ell}) \tensor \tm_{k-\ell}(a_{\ell+1} \tensor \cdots \tensor a_k)$$
where $\ell + 1$ and $k - \ell + 1$ are the number of branches entering the vertices.
If only one vertex is rightmost, we get the term $$\tm_{\ell}(a_1 \tensor \cdots \tensor m_{k-\ell+1}(a_{\ell' + 1} \tensor \cdots \tensor a_{\ell' + k - \ell}) \tensor \cdots \tensor a_k)$$
in \eqref{eq:bdy-tm-k-3},
where again $\ell + 1$ is the number of branches entering the rightmost vertex, $k-\ell+1$ is the number of branches entering the other vertex, and $\ell'$ is the number of edges meeting the rightmost vertex which start to the left of the other vertex.
For example, we have
\begin{align*}
\bdy(\tm_2(a \tensor b)) & = \left(\tm_2(\bdy a \tensor b) + (-1)^{\abs{a}} \tm_2(a \tensor \bdy b)\right) + \\
                         & \qquad - a \tensor b + m_2(a \tensor b) \\
\bdy(\tm_3(a \tensor b \tensor c)) & = \left(- \tm_3(\bdy a \tensor b \tensor c) + (-1)^{\abs{a} + 1} \tm_3(a \tensor \bdy b \tensor c) + (-1)^{\abs{a} + \abs{b} + 1} \tm_3(a \tensor b \tensor \bdy c)\right) + \\
                                   & \qquad + \left(- \tm_2(a \tensor b) \tensor c + a \tensor \tm_2(b \tensor c)\right) + \\
                                   & \qquad + \left(- \tm_2(m_2(a \tensor b) \tensor c) + \tm_2(a, m_2(b \tensor c)) + m_3(a \tensor b \tensor c)\right)
\end{align*}
\begin{align*}
\bdy(& \tm_4(a \tensor b \tensor c \tensor d)) = \left(\tm_4(\bdy a \tensor b \tensor c \tensor d) + \cdots + \tm_4(a \tensor b \tensor c \tensor \bdy d)\right) + \\
                                             & + \left(\tm_3(a \tensor b \tensor c) \tensor d + \tm_2(a \tensor b) \tensor \tm_2(c \tensor d) + a \tensor \tm_3(b \tensor c \tensor d)\right) + \\
                                             & + \left(\tm_3(m_2(a \tensor b) \tensor c \tensor d) + \tm_3(a \tensor m_2(b \tensor c) \tensor d) + \tm_3(a \tensor b \tensor m_2(c \tensor d))\right. + \\
                                             & + \left.\tm_2(m_3(a \tensor b \tensor c) \tensor d) + \tm_2(a \tensor m_3(b \tensor c \tensor d)) + m_4(a \tensor b \tensor c \tensor d)\right) \\
\end{align*}
See Figure \ref{fig:A4-terms}, comparing it against Figure \ref{fig:A4-faces}, to see this illustrated in the case $k=4$. There the $3$ faces closest
to the top of the diagram have two rightmost vertices, while the other $6$ faces have only one.

\begin{figure}[!ht]
\begin{equation*}
\mathfig{1.0}{associahedron/A4-terms}
\end{equation*}
\caption{The terms of $\bdy(\tm_k(a_1 \tensor \cdots \tensor a_k))$ correspond to the faces of the $k-1$ dimensional associahedron.}
\label{fig:A4-terms}
\end{figure}

\begin{lem}
This definition actually results in a chain complex, that is $\bdy^2 = 0$.
\end{lem}
\begin{proof}
\newcommand{\T}{\text{---}}
\newcommand{\ssum}[1]{{\sum}^{(#1)}}
For the duration of this proof, inside a summation over variables $l_1, \ldots, l_m$, an expression with $m$ dashes will be interpreted
by replacing each dash with contiguous factors from $a_1 \tensor \cdots \tensor a_k$, so the first dash takes the first $l_1$ factors, the second
takes the next $l_2$ factors, and so on. Further, we'll write $\ssum{m}$ for $\sum_{\sum_{i=1}^m l_i = k}$.
In this notation, the formula for the differential becomes
\begin{align}
\notag
\bdy \tm(\T) & = \ssum{2} \tm(\T) \tensor \tm(\T) \times \sigma_{0;l_1,l_2} + \ssum{3} \tm(\T \tensor m(\T) \tensor \T) \times \tau_{0;l_1,l_2,l_3} \\
\intertext{and we calculate}
\notag
\bdy^2 \tm(\T) & = \ssum{2} \bdy \tm(\T) \tensor \tm(\T) \times \sigma_{0;l_1,l_2} \\
\notag         & \qquad + \ssum{2} \tm(\T) \tensor \bdy \tm(\T) \times \sigma_{0;l_1,l_2} \\
\notag         & \qquad + \ssum{3} \bdy \tm(\T \tensor m(\T) \tensor \T) \times \tau_{0;l_1,l_2,l_3} \\
\label{eq:d21} & = \ssum{3} \tm(\T) \tensor \tm(\T) \tensor \tm(\T) \times \sigma_{0;l_1+l_2,l_3} \sigma_{0;l_1,l_2} \\
\label{eq:d22} & \qquad + \ssum{4} \tm(\T \tensor m(\T) \tensor \T) \tensor \tm(\T) \times \sigma_{0;l_1+l_2+l_3,l_4} \tau_{0;l_1,l_2,l_3} \\
\label{eq:d23} & \qquad + \ssum{3} \tm(\T) \tensor \tm(\T) \tensor \tm(\T) \times \sigma_{0;l_1,l_2+l_3} \sigma_{l_1;l_2,l_3} \\
\label{eq:d24} & \qquad + \ssum{4} \tm(\T) \tensor \tm(\T \tensor m(\T) \tensor \T) \times \sigma_{0;l_1,l_2+l_3+l_4} \tau_{l_1;l_2,l_3,l_4} \\
\label{eq:d25} & \qquad + \ssum{4} \tm(\T \tensor m(\T) \tensor \T) \tensor \tm(\T) \times \tau_{0;l_1,l_2,l_3+l_4} ??? \\
\label{eq:d26} & \qquad + \ssum{4} \tm(\T) \tensor \tm(\T \tensor m(\T) \tensor \T) \times \tau_{0;l_1+l_2,l_3,l_4} \sigma_{0;l_1,l_2} \\
\label{eq:d27} & \qquad + \ssum{5} \tm(\T \tensor m(\T) \tensor \T \tensor m(\T) \tensor \T) \times \tau_{0;l_1+l_2+l_3,l_4,l_5} \tau_{0;l_1,l_2,l_3}  \\
\label{eq:d28} & \qquad + \ssum{5} \tm(\T \tensor m(\T \tensor m(\T) \tensor \T) \tensor \T) \times \tau_{0;l_1,l_2+l_3+l_4,l_5} ??? \\
\label{eq:d29} & \qquad + \ssum{5} \tm(\T \tensor m(\T) \tensor \T \tensor m(\T) \tensor \T) \times \tau_{0;l_1,l_2,l_3+l_4+l_5} ???
\end{align}
Now, we see the the expressions on the right hand side of line \eqref{eq:d21} and those on \eqref{eq:d23} cancel. Similarly, line \eqref{eq:d22} cancels
with \eqref{eq:d25}, \eqref{eq:d24} with \eqref{eq:d26}, and \eqref{eq:d27} with \eqref{eq:d29}. Finally, we need to see that \eqref{eq:d28} gives $0$,
by the usual relations between the $m_k$ in an $A_\infty$ algebra.
\end{proof}

\nn{Need to let the input $n$-category $C$ be a graded thing (e.g. DG
$n$-category or $A_\infty$ $n$-category). DG $n$-category case is pretty
easy, I think, so maybe it should be done earlier??}

\bigskip

Outline:
\begin{itemize}
\item recall defs of $A_\infty$ category (1-category only), modules, (self-) tensor product.
use graphical/tree point of view, rather than following Keller exactly
\item define blob complex in $A_\infty$ case; fat mapping cones?  tree decoration?
\item topological $A_\infty$ cat def (maybe this should go first); also modules gluing
\item motivating example: $C_*(\maps(X, M))$
\item maybe incorporate dual point of view (for $n=1$), where points get
object labels and intervals get 1-morphism labels
\end{itemize}


\subsection{$A_\infty$ action on the boundary}

Let $Y$ be an $n{-}1$-manifold.
The collection of complexes $\{\bc_*(Y\times I; a, b)\}$, where $a, b \in \cC(Y)$ are boundary
conditions on $\bd(Y\times I) = Y\times \{0\} \cup Y\times\{1\}$, has the structure
of an $A_\infty$ category.

Composition of morphisms (multiplication) depends of a choice of homeomorphism
$I\cup I \cong I$.  Given this choice, gluing gives a map
\eq{
    \bc_*(Y\times I; a, b) \otimes \bc_*(Y\times I; b, c) \to \bc_*(Y\times (I\cup I); a, c)
            \cong \bc_*(Y\times I; a, c)
}
Using (\ref{CDprop}) and the inclusion $\Diff(I) \sub \Diff(Y\times I)$ gives the various
higher associators of the $A_\infty$ structure, more or less canonically.

\nn{is this obvious?  does more need to be said?}

Let $\cA(Y)$ denote the $A_\infty$ category $\bc_*(Y\times I; \cdot, \cdot)$.

Similarly, if $Y \sub \bd X$, a choice of collaring homeomorphism
$(Y\times I) \cup_Y X \cong X$ gives the collection of complexes $\bc_*(X; r, a)$
(variable $a \in \cC(Y)$; fixed $r \in \cC(\bd X \setmin Y)$) the structure of a representation of the
$A_\infty$ category $\{\bc_*(Y\times I; \cdot, \cdot)\}$.
Again the higher associators come from the action of $\Diff(I)$ on a collar neighborhood
of $Y$ in $X$.

In the next section we use the above $A_\infty$ actions to state and prove
a gluing theorem for the blob complexes of $n$-manifolds.


\subsection{The gluing formula}

Let $Y$ be an $n{-}1$-manifold and let $X$ be an $n$-manifold with a copy
of $Y \du -Y$ contained in its boundary.
Gluing the two copies of $Y$ together we obtain a new $n$-manifold $X\sgl$.
We wish to describe the blob complex of $X\sgl$ in terms of the blob complex
of $X$.
More precisely, we want to describe $\bc_*(X\sgl; c\sgl)$,
where $c\sgl \in \cC(\bd X\sgl)$,
in terms of the collection $\{\bc_*(X; c, \cdot, \cdot)\}$, thought of as a representation
of the $A_\infty$ category $\cA(Y\du-Y) \cong \cA(Y)\times \cA(Y)\op$.

\begin{thm}
$\bc_*(X\sgl; c\sgl)$ is quasi-isomorphic to the the self tensor product
of $\{\bc_*(X; c, \cdot, \cdot)\}$ over $\cA(Y)$.
\end{thm}

The proof will occupy the remainder of this section.

\nn{...}

\bigskip

\nn{need to define/recall def of (self) tensor product over an $A_\infty$ category}




\appendix

\section{Families of Diffeomorphisms}  \label{sec:localising}


Lo, the proof of Lemma (\ref{extension_lemma}):

\nn{should this be an appendix instead?}

\nn{for pedagogical reasons, should do $k=1,2$ cases first; probably do this in
later draft}

\nn{not sure what the best way to deal with boundary is; for now just give main argument, worry
about boundary later}

Recall that we are given
an open cover $\cU = \{U_\alpha\}$ and an
$x \in CD_k(X)$ such that $\bd x$ is adapted to $\cU$.
We must find a homotopy of $x$ (rel boundary) to some $x' \in CD_k(X)$ which is adapted to $\cU$.

Let $\{r_\alpha : X \to [0,1]\}$ be a partition of unity for $\cU$.

As a first approximation to the argument we will eventually make, let's replace $x$
with a single singular cell
\eq{
    f: P \times X \to X .
}
Also, we'll ignore for now issues around $\bd P$.

Our homotopy will have the form
\eqar{
    F: I \times P \times X &\to& X \\
    (t, p, x) &\mapsto& f(u(t, p, x), x)
}
for some function
\eq{
    u : I \times P \times X \to P .
}
First we describe $u$, then we argue that it does what we want it to do.

For each cover index $\alpha$ choose a cell decomposition $K_\alpha$ of $P$.
The various $K_\alpha$ should be in general position with respect to each other.
We will see below that the $K_\alpha$'s need to be sufficiently fine in order
to insure that $F$ above is a homotopy through diffeomorphisms of $X$ and not
merely a homotopy through maps $X\to X$.

Let $L$ be the union of all the $K_\alpha$'s.
$L$ is itself a cell decomposition of $P$.
\nn{next two sentences not needed?}
To each cell $a$ of $L$ we associate the tuple $(c_\alpha)$,
where $c_\alpha$ is the codimension of the cell of $K_\alpha$ which contains $c$.
Since the $K_\alpha$'s are in general position, we have $\sum c_\alpha \le k$.

Let $J$ denote the handle decomposition of $P$ corresponding to $L$.
Each $i$-handle $C$ of $J$ has an $i$-dimensional tangential coordinate and,
more importantly, a $k{-}i$-dimensional normal coordinate.

For each (top-dimensional) $k$-cell $c$ of each $K_\alpha$, choose a point $p_c \in c \sub P$.
Let $D$ be a $k$-handle of $J$, and let $D$ also denote the corresponding
$k$-cell of $L$.
To $D$ we associate the tuple $(c_\alpha)$ of $k$-cells of the $K_\alpha$'s
which contain $d$, and also the corresponding tuple $(p_{c_\alpha})$ of points in $P$.

For $p \in D$ we define
\eq{
    u(t, p, x) = (1-t)p + t \sum_\alpha r_\alpha(x) p_{c_\alpha} .
}
(Recall that $P$ is a single linear cell, so the weighted average of points of $P$
makes sense.)

So far we have defined $u(t, p, x)$ when $p$ lies in a $k$-handle of $J$.
For handles of $J$ of index less than $k$, we will define $u$ to
interpolate between the values on $k$-handles defined above.

If $p$ lies in a $k{-}1$-handle $E$, let $\eta : E \to [0,1]$ be the normal coordinate
of $E$.
In particular, $\eta$ is equal to 0 or 1 only at the intersection of $E$
with a $k$-handle.
Let $\beta$ be the index of the $K_\beta$ containing the $k{-}1$-cell
corresponding to $E$.
Let $q_0, q_1 \in P$ be the points associated to the two $k$-cells of $K_\beta$
adjacent to the $k{-}1$-cell corresponding to $E$.
For $p \in E$, define
\eq{
    u(t, p, x) = (1-t)p + t \left( \sum_{\alpha \ne \beta} r_\alpha(x) p_{c_\alpha}
            + r_\beta(x) (\eta(p) q_1 + (1-\eta(p)) q_0) \right) .
}

In general, for $E$ a $k{-}j$-handle, there is a normal coordinate
$\eta: E \to R$, where $R$ is some $j$-dimensional polyhedron.
The vertices of $R$ are associated to $k$-cells of the $K_\alpha$, and thence to points of $P$.
If we triangulate $R$ (without introducing new vertices), we can linearly extend
a map from the vertices of $R$ into $P$ to a map of all of $R$ into $P$.
Let $\cN$ be the set of all $\beta$ for which $K_\beta$ has a $k$-cell whose boundary meets
the $k{-}j$-cell corresponding to $E$.
For each $\beta \in \cN$, let $\{q_{\beta i}\}$ be the set of points in $P$ associated to the aforementioned $k$-cells.
Now define, for $p \in E$,
\eq{
    u(t, p, x) = (1-t)p + t \left(
            \sum_{\alpha \notin \cN} r_\alpha(x) p_{c_\alpha}
                + \sum_{\beta \in \cN} r_\beta(x) \left( \sum_i \eta_{\beta i}(p) \cdot q_{\beta i} \right)
             \right) .
}
Here $\eta_{\beta i}(p)$ is the weight given to $q_{\beta i}$ by the linear extension
mentioned above.

This completes the definition of $u: I \times P \times X \to P$.

\medskip

Next we verify that $u$ has the desired properties.

Since $u(0, p, x) = p$ for all $p\in P$ and $x\in X$, $F(0, p, x) = f(p, x)$ for all $p$ and $x$.
Therefore $F$ is a homotopy from $f$ to something.

Next we show that if the $K_\alpha$'s are sufficiently fine cell decompositions,
then $F$ is a homotopy through diffeomorphisms.
We must show that the derivative $\pd{F}{x}(t, p, x)$ is non-singular for all $(t, p, x)$.
We have
\eq{
%   \pd{F}{x}(t, p, x) = \pd{f}{x}(u(t, p, x), x) + \pd{f}{p}(u(t, p, x), x) \pd{u}{x}(t, p, x) .
    \pd{F}{x} = \pd{f}{x} + \pd{f}{p} \pd{u}{x} .
}
Since $f$ is a family of diffeomorphisms, $\pd{f}{x}$ is non-singular and
\nn{bounded away from zero, or something like that}.
(Recall that $X$ and $P$ are compact.)
Also, $\pd{f}{p}$ is bounded.
So if we can insure that $\pd{u}{x}$ is sufficiently small, we are done.
It follows from Equation xxxx above that $\pd{u}{x}$ depends on $\pd{r_\alpha}{x}$
(which is bounded)
and the differences amongst the various $p_{c_\alpha}$'s and $q_{\beta i}$'s.
These differences are small if the cell decompositions $K_\alpha$ are sufficiently fine.
This completes the proof that $F$ is a homotopy through diffeomorphisms.

\medskip

Next we show that for each handle $D \sub P$, $F(1, \cdot, \cdot) : D\times X \to X$
is a singular cell adapted to $\cU$.
This will complete the proof of the lemma.
\nn{except for boundary issues and the `$P$ is a cell' assumption}

Let $j$ be the codimension of $D$.
(Or rather, the codimension of its corresponding cell.  From now on we will not make a distinction
between handle and corresponding cell.)
Then $j = j_1 + \cdots + j_m$, $0 \le m \le k$,
where the $j_i$'s are the codimensions of the $K_\alpha$
cells of codimension greater than 0 which intersect to form $D$.
We will show that
if the relevant $U_\alpha$'s are disjoint, then
$F(1, \cdot, \cdot) : D\times X \to X$
is a product of singular cells of dimensions $j_1, \ldots, j_m$.
If some of the relevant $U_\alpha$'s intersect, then we will get a product of singular
cells whose dimensions correspond to a partition of the $j_i$'s.
We will consider some simple special cases first, then do the general case.

First consider the case $j=0$ (and $m=0$).
A quick look at Equation xxxx above shows that $u(1, p, x)$, and hence $F(1, p, x)$,
is independent of $p \in P$.
So the corresponding map $D \to \Diff(X)$ is constant.

Next consider the case $j = 1$ (and $m=1$, $j_1=1$).
Now Equation yyyy applies.
We can write $D = D'\times I$, where the normal coordinate $\eta$ is constant on $D'$.
It follows that the singular cell $D \to \Diff(X)$ can be written as a product
of a constant map $D' \to \Diff(X)$ and a singular 1-cell $I \to \Diff(X)$.
The singular 1-cell is supported on $U_\beta$, since $r_\beta = 0$ outside of this set.

Next case: $j=2$, $m=1$, $j_1 = 2$.
This is similar to the previous case, except that the normal bundle is 2-dimensional instead of
1-dimensional.
We have that $D \to \Diff(X)$ is a product of a constant singular $k{-}2$-cell
and a 2-cell with support $U_\beta$.

Next case: $j=2$, $m=2$, $j_1 = j_2 = 1$.
In this case the codimension 2 cell $D$ is the intersection of two
codimension 1 cells, from $K_\beta$ and $K_\gamma$.
We can write $D = D' \times I \times I$, where the normal coordinates are constant
on $D'$, and the two $I$ factors correspond to $\beta$ and $\gamma$.
If $U_\beta$ and $U_\gamma$ are disjoint, then we can factor $D$ into a constant $k{-}2$-cell and
two 1-cells, supported on $U_\beta$ and $U_\gamma$ respectively.
If $U_\beta$ and $U_\gamma$ intersect, then we can factor $D$ into a constant $k{-}2$-cell and
a 2-cell supported on $U_\beta \cup U_\gamma$.
\nn{need to check that this is true}

\nn{finally, general case...}

\nn{this completes proof}

\input{text/explicit.tex}

% ----------------------------------------------------------------
%\newcommand{\urlprefix}{}
\bibliographystyle{plain}
%Included for winedt:
%input "bibliography/bibliography.bib"
\bibliography{bibliography/bibliography}
% ----------------------------------------------------------------

This paper is available online at \arxiv{?????}, and at
\url{http://tqft.net/blobs}.

% A GTART necessity:
% \Addresses
% ----------------------------------------------------------------
\end{document}
% ----------------------------------------------------------------




%Recall that for $n$-category picture fields there is an evaluation map
%$m: \bc_0(B^n; c, c') \to \mor(c, c')$.
%If we regard $\mor(c, c')$ as a complex concentrated in degree 0, then this becomes a chain
%map $m: \bc_*(B^n; c, c') \to \mor(c, c')$.
