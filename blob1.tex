\documentclass[11pt,leqno]{amsart}

\newcommand{\pathtotrunk}{./}
\input{text/article_preamble.tex}
\input{text/top_matter.tex}


%%%%% excerpts from KW's include file of standard macros

\def\z{\mathbb{Z}}
\def\r{\mathbb{R}}
\def\c{\mathbb{C}}
\def\t{\mathbb{T}}

\def\du{\sqcup}
\def\bd{\partial}
\def\sub{\subset}
\def\sup{\supset}
%\def\setmin{\smallsetminus}
\def\setmin{\setminus}
\def\ep{\epsilon}
\def\sgl{_\mathrm{gl}}
\def\op{^\mathrm{op}}
\def\deq{\stackrel{\mathrm{def}}{=}}
\def\pd#1#2{\frac{\partial #1}{\partial #2}}

\def\nn#1{{{\it \small [#1]}}}


% equations
\newcommand{\eq}[1]{\begin{displaymath}#1\end{displaymath}}
\newcommand{\eqar}[1]{\begin{eqnarray*}#1\end{eqnarray*}}
\newcommand{\eqspl}[1]{\begin{displaymath}\begin{split}#1\end{split}\end{displaymath}}

% tricky way to iterate macros over a list
\def\semicolon{;}
\def\applytolist#1{
    \expandafter\def\csname multi#1\endcsname##1{
        \def\multiack{##1}\ifx\multiack\semicolon
            \def\next{\relax}
        \else
            \csname #1\endcsname{##1}
            \def\next{\csname multi#1\endcsname}
        \fi
        \next}
    \csname multi#1\endcsname}

% \def\cA{{\cal A}} for A..Z
\def\calc#1{\expandafter\def\csname c#1\endcsname{{\mathcal #1}}}
\applytolist{calc}QWERTYUIOPLKJHGFDSAZXCVBNM;

% \DeclareMathOperator{\pr}{pr} etc.
\def\declaremathop#1{\expandafter\DeclareMathOperator\csname #1\endcsname{#1}}
\applytolist{declaremathop}{pr}{im}{gl}{ev}{coinv}{tr}{rot}{Eq}{obj}{mor}{ob}{Rep}{Tet}{cat}{Maps}{Diff}{sign}{supp}{maps};



%%%%%% end excerpt





\title{Blob Homology}

\begin{document}



\makeatletter
\@addtoreset{equation}{section}
\gdef\theequation{\thesection.\arabic{equation}}
\makeatother


\maketitle

\textbf{Draft version, do not distribute.}

\versioninfo

\section*{Todo}

\subsection*{What else?...}

\begin{itemize}
\item higher priority
\begin{itemize}
\item K\&S: learn the state of the art in A-inf categories
(tensor products, Kadeishvili result, ...)
\item K: so-called evaluation map stuff
\item K: topological fields
\item section describing intended applications
\item say something about starting with semisimple n-cat (trivial?? not trivial?)
\item T.O.C.
\end{itemize}
\item medium priority
\begin{itemize}
\item $n=2$ examples
\item dimension $n+1$ (generalized Deligne conjecture?)
\item should be clear about PL vs Diff; probably PL is better
(or maybe not)
\item say what we mean by $n$-category, $A_\infty$ or $E_\infty$ $n$-category
\item something about higher derived coend things (derived 2-coend, e.g.)
\item shuffle product vs gluing product (?)
\item commutative algebra results
\item $A_\infty$ blob complex
\item connection between $A_\infty$ operad and topological $A_\infty$ cat defs
\end{itemize}
\item lower priority
\begin{itemize}
\item Derive Hochschild standard results from blob point of view?
\item Kh
\end{itemize}
\end{itemize}


\section{Introduction}

[Outline for intro]
\begin{itemize}
\item Starting point: TQFTs via fields and local relations.
This gives a satisfactory treatment for semisimple TQFTs
(i.e. TQFTs for which the cylinder 1-category associated to an
$n{-}1$-manifold $Y$ is semisimple for all $Y$).
\item For non-semiemple TQFTs, this approach is less satisfactory.
Our main motivating example (though we will not develop it in this paper)
is the $4{+}1$-dimensional TQFT associated to Khovanov homology.
It associates a bigraded vector space $A_{Kh}(W^4, L)$ to a 4-manifold $W$ together
with a link $L \subset \bd W$.
The original Khovanov homology of a link in $S^3$ is recovered as $A_{Kh}(B^4, L)$.
\item How would we go about computing $A_{Kh}(W^4, L)$?
For $A_{Kh}(B^4, L)$, the main tool is the exact triangle (long exact sequence)
\nn{... $L_1, L_2, L_3$}.
Unfortunately, the exactness breaks if we glue $B^4$ to itself and attempt
to compute $A_{Kh}(S^1\times B^3, L)$.
According to the gluing theorem for TQFTs-via-fields, gluing along $B^3 \subset \bd B^4$
corresponds to taking a coend (self tensor product) over the cylinder category
associated to $B^3$ (with appropriate boundary conditions).
The coend is not an exact functor, so the exactness of the triangle breaks.
\item The obvious solution to this problem is to replace the coend with its derived counterpart.
This presumably works fine for $S^1\times B^3$ (the answer being to Hochschild homology
of an appropriate bimodule), but for more complicated 4-manifolds this leaves much to be desired.
If we build our manifold up via a handle decomposition, the computation
would be a sequence of derived coends.
A different handle decomposition of the same manifold would yield a different
sequence of derived coends.
To show that our definition in terms of derived coends is well-defined, we
would need to show that the above two sequences of derived coends yield the same answer.
This is probably not easy to do.
\item Instead, we would prefer a definition for a derived version of $A_{Kh}(W^4, L)$
which is manifestly invariant.
(That is, a definition that does not
involve choosing a decomposition of $W$.
After all, one of the virtues of our starting point --- TQFTs via field and local relations ---
is that it has just this sort of manifest invariance.)
\item The solution is to replace $A_{Kh}(W^4, L)$, which is a quotient
\[
 \text{linear combinations of fields} \;\big/\; \text{local relations} ,
\]
with an appropriately free resolution (the ``blob complex")
\[
	\cdots\to \bc_2(W, L) \to \bc_1(W, L) \to \bc_0(W, L) .
\]
Here $\bc_0$ is linear combinations of fields on $W$,
$\bc_1$ is linear combinations of local relations on $W$,
$\bc_1$ is linear combinations of relations amongst relations on $W$,
and so on.
\item None of the above ideas depend on the details of the Khovanov homology example,
so we develop the general theory in the paper and postpone specific applications
to later papers.
\item The blob complex enjoys the following nice properties \nn{...}
\end{itemize}

\bigskip
\hrule
\bigskip

We then show that blob homology enjoys the following
\ref{property:gluing} properties.

\begin{property}[Functoriality]
\label{property:functoriality}%
Blob homology is functorial with respect to diffeomorphisms. That is, fixing an $n$-dimensional system of fields $\cF$ and local relations $\cU$, the association
\begin{equation*}
X \mapsto \bc_*^{\cF,\cU}(X)
\end{equation*}
is a functor from $n$-manifolds and diffeomorphisms between them to chain complexes and isomorphisms between them.
\scott{Do we want to or need to weaken `isomorphisms' to `homotopy equivalences' or `quasi-isomorphisms'?}
\end{property}

\begin{property}[Disjoint union]
\label{property:disjoint-union}
The blob complex of a disjoint union is naturally the tensor product of the blob complexes.
\begin{equation*}
\bc_*(X_1 \du X_2) \iso \bc_*(X_1) \tensor \bc_*(X_2)
\end{equation*}
\end{property}

\begin{property}[A map for gluing]
\label{property:gluing-map}%
If $X_1$ and $X_2$ are $n$-manifolds, with $Y$ a codimension $0$-submanifold of $\bdy X_1$, and $Y^{\text{op}}$ a codimension $0$-submanifold of $\bdy X_2$,
there is a chain map
\begin{equation*}
\gl_Y: \bc_*(X_1) \tensor \bc_*(X_2) \to \bc_*(X_1 \cup_Y X_2).
\end{equation*}
\end{property}

\begin{property}[Contractibility]
\label{property:contractibility}%
\todo{Err, requires a splitting?}
The blob complex for an $n$-category on an $n$-ball is quasi-isomorphic to its $0$-th homology.
\begin{equation}
\xymatrix{\bc_*^{\cC}(B^n) \ar[r]^{\iso}_{\text{qi}} & H_0(\bc_*^{\cC}(B^n))}
\end{equation}
\todo{Say that this is just the original $n$-category?}
\end{property}

\begin{property}[Skein modules]
\label{property:skein-modules}%
The $0$-th blob homology of $X$ is the usual skein module associated to $X$. (See \S \ref{sec:local-relations}.)
\begin{equation*}
H_0(\bc_*^{\cF,\cU}(X)) \iso A^{\cF,\cU}(X)
\end{equation*}
\end{property}

\begin{property}[Hochschild homology when $X=S^1$]
\label{property:hochschild}%
The blob complex for a $1$-category $\cC$ on the circle is
quasi-isomorphic to the Hochschild complex.
\begin{equation*}
\xymatrix{\bc_*^{\cC}(S^1) \ar[r]^{\iso}_{\text{qi}} & HC_*(\cC)}
\end{equation*}
\end{property}

\begin{property}[Evaluation map]
\label{property:evaluation}%
There is an `evaluation' chain map
\begin{equation*}
\ev_X: \CD{X} \tensor \bc_*(X) \to \bc_*(X).
\end{equation*}
(Here $\CD{X}$ is the singular chain complex of the space of diffeomorphisms of $X$, fixed on $\bdy X$.)

Restricted to $C_0(\Diff(X))$ this is just the action of diffeomorphisms described in Property \ref{property:functoriality}. Further, for
any codimension $1$-submanifold $Y \subset X$ dividing $X$ into $X_1 \cup_Y X_2$, the following diagram
(using the gluing maps described in Property \ref{property:gluing-map}) commutes.
\begin{equation*}
\xymatrix{
     \CD{X} \otimes \bc_*(X) \ar[r]^{\ev_X}    & \bc_*(X) \\
     \CD{X_1} \otimes \CD{X_2} \otimes \bc_*(X_1) \otimes \bc_*(X_2)
        \ar@/_4ex/[r]_{\ev_{X_1} \otimes \ev_{X_2}}  \ar[u]^{\gl^{\Diff}_Y \otimes \gl_Y}  &
            \bc_*(X_1) \otimes \bc_*(X_2) \ar[u]_{\gl_Y}
}
\end{equation*}
\end{property}

\begin{property}[Gluing formula]
\label{property:gluing}%
\mbox{}% <-- gets the indenting right
\begin{itemize}
\item For any $(n-1)$-manifold $Y$, the blob homology of $Y \times I$ is
naturally an $A_\infty$ category. % We'll write $\bc_*(Y)$ for $\bc_*(Y \times I)$ below.

\item For any $n$-manifold $X$, with $Y$ a codimension $0$-submanifold of its boundary, the blob homology of $X$ is naturally an
$A_\infty$ module for $\bc_*(Y \times I)$.

\item For any $n$-manifold $X$, with $Y \cup Y^{\text{op}}$ a codimension
$0$-submanifold of its boundary, the blob homology of $X'$, obtained from
$X$ by gluing along $Y$, is the $A_\infty$ self-tensor product of
$\bc_*(X)$ as an $\bc_*(Y \times I)$-bimodule.
\begin{equation*}
\bc_*(X') \iso \bc_*(X) \Tensor^{A_\infty}_{\mathclap{\bc_*(Y \times I)}} \!\!\!\!\!\!\xymatrix{ \ar@(ru,rd)@<-1ex>[]}
\end{equation*}
\end{itemize}
\end{property}

Properties \ref{property:functoriality}, \ref{property:gluing-map} and \ref{property:skein-modules} will be immediate from the definition given in
\S \ref{sec:blob-definition}, and we'll recall them at the appropriate points there. \todo{Make sure this gets done.}
Properties \ref{property:disjoint-union} and \ref{property:contractibility} are established in \S \ref{sec:basic-properties}.
Property \ref{property:hochschild} is established in \S \ref{sec:hochschild}, Property \ref{property:evaluation} in \S \ref{sec:evaluation},
and Property \ref{property:gluing} in \S \ref{sec:gluing}.

\section{Definitions}
\label{sec:definitions}

\subsection{Systems of fields}
\label{sec:fields}

Let $\cM_k$ denote the category (groupoid, in fact) with objects 
oriented PL manifolds of dimension
$k$ and morphisms homeomorphisms.
(We could equally well work with a different category of manifolds ---
unoriented, topological, smooth, spin, etc. --- but for definiteness we
will stick with oriented PL.)

Fix a top dimension $n$.

A {\it system of fields}
is a collection of functors $\cC_k$, for $k \le n$, from $\cM_k$ to the
category of sets,
together with some additional data and satisfying some additional conditions, all specified below.

\nn{refer somewhere to my TQFT notes \cite{kw:tqft}, and possibly also to paper with Chris}

Before finishing the definition of fields, we give two motivating examples
(actually, families of examples) of systems of fields.

The first examples: Fix a target space $B$, and let $\cC(X)$ be the set of continuous maps
from X to $B$.

The second examples: Fix an $n$-category $C$, and let $\cC(X)$ be 
the set of sub-cell-complexes of $X$ with codimension-$j$ cells labeled by
$j$-morphisms of $C$.
One can think of such sub-cell-complexes as dual to pasting diagrams for $C$.
This is described in more detail below.

Now for the rest of the definition of system of fields.
\begin{enumerate}
\item There are boundary restriction maps $\cC_k(X) \to \cC_{k-1}(\bd X)$, 
and these maps are a natural
transformation between the functors $\cC_k$ and $\cC_{k-1}\circ\bd$.
For $c \in \cC_{k-1}(\bd X)$, we will denote by $\cC_k(X; c)$ the subset of 
$\cC(X)$ which restricts to $c$.
In this context, we will call $c$ a boundary condition.
\item There are orientation reversal maps $\cC_k(X) \to \cC_k(-X)$, and these maps
again comprise a natural transformation of functors.
In addition, the orientation reversal maps are compatible with the boundary restriction maps.
\item $\cC_k$ is compatible with the symmetric monoidal
structures on $\cM_k$ and sets: $\cC_k(X \du W) \cong \cC_k(X)\times \cC_k(W)$,
compatibly with homeomorphisms, restriction to boundary, and orientation reversal.
\item Gluing without corners.
Let $\bd X = Y \du -Y \du W$, where $Y$ and $W$ are closed $k{-}1$-manifolds.
Let $X\sgl$ denote $X$ glued to itself along $\pm Y$.
Using the boundary restriction, disjoint union, and (in one case) orientation reversal
maps, we get two maps $\cC_k(X) \to \cC(Y)$, corresponding to the two
copies of $Y$ in $\bd X$.
Let $\Eq_Y(\cC_k(X))$ denote the equalizer of these two maps.
Then (here's the axiom/definition part) there is an injective ``gluing" map
\[
	\Eq_Y(\cC_k(X)) \hookrightarrow \cC_k(X\sgl) ,
\]
and this gluing map is compatible with all of the above structure (actions
of homeomorphisms, boundary restrictions, orientation reversal, disjoint union).
Furthermore, up to homeomorphisms of $X\sgl$ isotopic to the identity,
the gluing map is surjective.
From the point of view of $X\sgl$ and the image $Y \subset X\sgl$ of the 
gluing surface, we say that fields in the image of the gluing map
are transverse to $Y$ or cuttable along $Y$.
\item Gluing with corners.
Let $\bd X = Y \cup -Y \cup W$, where $\pm Y$ and $W$ might intersect along their boundaries.
Let $X\sgl$ denote $X$ glued to itself along $\pm Y$.
Note that $\bd X\sgl = W\sgl$, where $W\sgl$ denotes $W$ glued to itself
(without corners) along two copies of $\bd Y$.
Let $c\sgl \in \cC_{k-1}(W\sgl)$ be a be a cuttable field on $W\sgl$ and let
$c \in \cC_{k-1}(W)$ be the cut open version of $c\sgl$.
Let $\cC^c_k(X)$ denote the subset of $\cC(X)$ which restricts to $c$ on $W$.
(This restriction map uses the gluing without corners map above.)
Using the boundary restriction, gluing without corners, and (in one case) orientation reversal
maps, we get two maps $\cC^c_k(X) \to \cC(Y)$, corresponding to the two
copies of $Y$ in $\bd X$.
Let $\Eq^c_Y(\cC_k(X))$ denote the equalizer of these two maps.
Then (here's the axiom/definition part) there is an injective ``gluing" map
\[
	\Eq^c_Y(\cC_k(X)) \hookrightarrow \cC_k(X\sgl, c\sgl) ,
\]
and this gluing map is compatible with all of the above structure (actions
of homeomorphisms, boundary restrictions, orientation reversal, disjoint union).
Furthermore, up to homeomorphisms of $X\sgl$ isotopic to the identity,
the gluing map is surjective.
From the point of view of $X\sgl$ and the image $Y \subset X\sgl$ of the 
gluing surface, we say that fields in the image of the gluing map
are transverse to $Y$ or cuttable along $Y$.
\item There are maps $\cC_{k-1}(Y) \to \cC_k(Y \times I)$, denoted
$c \mapsto c\times I$.
These maps comprise a natural transformation of functors, and commute appropriately
with all the structure maps above (disjoint union, boundary restriction, etc.)
Furthermore, if $f: Y\times I \to Y\times I$ is a fiber-preserving homeomorphism
covering $\bar{f}:Y\to Y$, then $f(c\times I) = \bar{f}(c)\times I$.
\end{enumerate}


\bigskip
\hrule
\bigskip

\input{text/fields.tex}


\bigskip
\hrule
\bigskip

\nn{note: probably will suppress from notation the distinction
between fields and their (orientation-reversal) duals}

\nn{remark that if top dimensional fields are not already linear
then we will soon linearize them(?)}

We now describe in more detail systems of fields coming from sub-cell-complexes labeled
by $n$-category morphisms.

Given an $n$-category $C$ with the right sort of duality
(e.g. pivotal 2-category, 1-category with duals, star 1-category, disklike $n$-category),
we can construct a system of fields as follows.
Roughly speaking, $\cC(X)$ will the set of all embedded cell complexes in $X$
with codimension $i$ cells labeled by $i$-morphisms of $C$.
We'll spell this out for $n=1,2$ and then describe the general case.

If $X$ has boundary, we require that the cell decompositions are in general
position with respect to the boundary --- the boundary intersects each cell
transversely, so cells meeting the boundary are mere half-cells.

Put another way, the cell decompositions we consider are dual to standard cell
decompositions of $X$.

We will always assume that our $n$-categories have linear $n$-morphisms.

For $n=1$, a field on a 0-manifold $P$ is a labeling of each point of $P$ with
an object (0-morphism) of the 1-category $C$.
A field on a 1-manifold $S$ consists of
\begin{itemize}
    \item A cell decomposition of $S$ (equivalently, a finite collection
of points in the interior of $S$);
    \item a labeling of each 1-cell (and each half 1-cell adjacent to $\bd S$)
by an object (0-morphism) of $C$;
    \item a transverse orientation of each 0-cell, thought of as a choice of
``domain" and ``range" for the two adjacent 1-cells; and
    \item a labeling of each 0-cell by a morphism (1-morphism) of $C$, with
domain and range determined by the transverse orientation and the labelings of the 1-cells.
\end{itemize}

If $C$ is an algebra (i.e. if $C$ has only one 0-morphism) we can ignore the labels
of 1-cells, so a field on a 1-manifold $S$ is a finite collection of points in the
interior of $S$, each transversely oriented and each labeled by an element (1-morphism)
of the algebra.

\medskip

For $n=2$, fields are just the sort of pictures based on 2-categories (e.g.\ tensor categories)
that are common in the literature.
We describe these carefully here.

A field on a 0-manifold $P$ is a labeling of each point of $P$ with
an object of the 2-category $C$.
A field of a 1-manifold is defined as in the $n=1$ case, using the 0- and 1-morphisms of $C$.
A field on a 2-manifold $Y$ consists of
\begin{itemize}
    \item A cell decomposition of $Y$ (equivalently, a graph embedded in $Y$ such
that each component of the complement is homeomorphic to a disk);
    \item a labeling of each 2-cell (and each partial 2-cell adjacent to $\bd Y$)
by a 0-morphism of $C$;
    \item a transverse orientation of each 1-cell, thought of as a choice of
``domain" and ``range" for the two adjacent 2-cells;
    \item a labeling of each 1-cell by a 1-morphism of $C$, with
domain and range determined by the transverse orientation of the 1-cell
and the labelings of the 2-cells;
    \item for each 0-cell, a homeomorphism of the boundary $R$ of a small neighborhood
of the 0-cell to $S^1$ such that the intersections of the 1-cells with $R$ are not mapped
to $\pm 1 \in S^1$; and
    \item a labeling of each 0-cell by a 2-morphism of $C$, with domain and range
determined by the labelings of the 1-cells and the parameterizations of the previous
bullet.
\end{itemize}
\nn{need to say this better; don't try to fit everything into the bulleted list}

For general $n$, a field on a $k$-manifold $X^k$ consists of
\begin{itemize}
    \item A cell decomposition of $X$;
    \item an explicit general position homeomorphism from the link of each $j$-cell
to the boundary of the standard $(k-j)$-dimensional bihedron; and
    \item a labeling of each $j$-cell by a $(k-j)$-dimensional morphism of $C$, with
domain and range determined by the labelings of the link of $j$-cell.
\end{itemize}

%\nn{next definition might need some work; I think linearity relations should
%be treated differently (segregated) from other local relations, but I'm not sure
%the next definition is the best way to do it}

\medskip

For top dimensional ($n$-dimensional) manifolds, we're actually interested
in the linearized space of fields.
By default, define $\cC_l(X) = \c[\cC(X)]$; that is, $\cC_l(X)$ is
the vector space of finite
linear combinations of fields on $X$.
If $X$ has boundary, we of course fix a boundary condition: $\cC_l(X; a) = \c[\cC(X; a)]$.
Thus the restriction (to boundary) maps are well defined because we never
take linear combinations of fields with differing boundary conditions.

In some cases we don't linearize the default way; instead we take the
spaces $\cC_l(X; a)$ to be part of the data for the system of fields.
In particular, for fields based on linear $n$-category pictures we linearize as follows.
Define $\cC_l(X; a) = \c[\cC(X; a)]/K$, where $K$ is the space generated by
obvious relations on 0-cell labels.
More specifically, let $L$ be a cell decomposition of $X$
and let $p$ be a 0-cell of $L$.
Let $\alpha_c$ and $\alpha_d$ be two labelings of $L$ which are identical except that
$\alpha_c$ labels $p$ by $c$ and $\alpha_d$ labels $p$ by $d$.
Then the subspace $K$ is generated by things of the form
$\lambda \alpha_c + \alpha_d - \alpha_{\lambda c + d}$, where we leave it to the reader
to infer the meaning of $\alpha_{\lambda c + d}$.
Note that we are still assuming that $n$-categories have linear spaces of $n$-morphisms.

\nn{Maybe comment further: if there's a natural basis of morphisms, then no need;
will do something similar below; in general, whenever a label lives in a linear
space we do something like this; ? say something about tensor
product of all the linear label spaces?  Yes:}

For top dimensional ($n$-dimensional) manifolds, we linearize as follows.
Define an ``almost-field" to be a field without labels on the 0-cells.
(Recall that 0-cells are labeled by $n$-morphisms.)
To each unlabeled 0-cell in an almost field there corresponds a (linear) $n$-morphism
space determined by the labeling of the link of the 0-cell.
(If the 0-cell were labeled, the label would live in this space.)
We associate to each almost-labeling the tensor product of these spaces (one for each 0-cell).
We now define $\cC_l(X; a)$ to be the direct sum over all almost labelings of the
above tensor products.



\subsection{Local relations}
\label{sec:local-relations}

\nn{the following is not done yet}

Let $B^n$ denote the standard $n$-ball.
A {\it local relation} is a collection subspaces $U(B^n; c) \sub \cC_l(B^n; c)$
(for all $c \in \cC(\bd B^n)$) satisfying the following two properties.
\begin{enumerate}
\item local relations imply (extended) isotopy \nn{...}
\item $U(B^n; \cdot)$ is an ideal w.r.t.\ gluing \nn{...}
\end{enumerate}
See \cite{kw:tqft} for details.


For maps into spaces, $U(B^n; c)$ is generated by things of the form $a-b \in \cC_l(B^n; c)$,
where $a$ and $b$ are maps (fields) which are homotopic rel boundary.

For $n$-category pictures, $U(B^n; c)$ is equal to the kernel of the evaluation map
$\cC_l(B^n; c) \to \mor(c', c'')$, where $(c', c'')$ is some (any) division of $c$ into
domain and range.

\nn{maybe examples of local relations before general def?}

Note that the $Y$ is an $n$-manifold which is merely homeomorphic to the standard $B^n$,
then any homeomorphism $B^n \to Y$ induces the same local subspaces for $Y$.
We'll denote these by $U(Y; c) \sub \cC_l(Y; c)$, $c \in \cC(\bd Y)$.
\nn{Is this true in high (smooth) dimensions?  Self-diffeomorphisms of $B^n$
rel boundary might not be isotopic to the identity.  OK for PL and TOP?}

Given a system of fields and local relations, we define the skein space
$A(Y^n; c)$ to be the space of all finite linear combinations of fields on
the $n$-manifold $Y$ modulo local relations.
The Hilbert space $Z(Y; c)$ for the TQFT based on the fields and local relations
is defined to be the dual of $A(Y; c)$.
(See \cite{kw:tqft} or xxxx for details.)

The blob complex is in some sense the derived version of $A(Y; c)$.



\subsection{The blob complex}
\label{sec:blob-definition}

Let $X$ be an $n$-manifold.
Assume a fixed system of fields.
In this section we will usually suppress boundary conditions on $X$ from the notation
(e.g. write $\cC_l(X)$ instead of $\cC_l(X; c)$).

We only consider compact manifolds, so if $Y \sub X$ is a closed codimension 0
submanifold of $X$, then $X \setmin Y$ implicitly means the closure
$\overline{X \setmin Y}$.

We will define $\bc_0(X)$, $\bc_1(X)$ and $\bc_2(X)$, then give the general case.

Define $\bc_0(X) = \cC_l(X)$.
(If $X$ has nonempty boundary, instead define $\bc_0(X; c) = \cC_l(X; c)$.
We'll omit this sort of detail in the rest of this section.)
In other words, $\bc_0(X)$ is just the space of all linearized fields on $X$.

$\bc_1(X)$ is the space of all local relations that can be imposed on $\bc_0(X)$.
More specifically, define a 1-blob diagram to consist of
\begin{itemize}
\item An embedded closed ball (``blob") $B \sub X$.
%\nn{Does $B$ need a homeo to the standard $B^n$?  I don't think so.
%(See note in previous subsection.)}
%\item A field (boundary condition) $c \in \cC(\bd B) = \cC(\bd(X \setmin B))$.
\item A field $r \in \cC(X \setmin B; c)$
(for some $c \in \cC(\bd B) = \cC(\bd(X \setmin B))$).
\item A local relation field $u \in U(B; c)$
(same $c$ as previous bullet).
\end{itemize}
%(Note that the field $c$ is determined (implicitly) as the boundary of $u$ and/or $r$,
%so we will omit $c$ from the notation.)
Define $\bc_1(X)$ to be the space of all finite linear combinations of
1-blob diagrams, modulo the simple relations relating labels of 0-cells and
also the label ($u$ above) of the blob.
\nn{maybe spell this out in more detail}
(See xxxx above.)
\nn{maybe restate this in terms of direct sums of tensor products.}

There is a map $\bd : \bc_1(X) \to \bc_0(X)$ which sends $(B, r, u)$ to $ru$, the linear
combination of fields on $X$ obtained by gluing $r$ to $u$.
In other words $\bd : \bc_1(X) \to \bc_0(X)$ is given by
just erasing the blob from the picture
(but keeping the blob label $u$).

Note that the skein space $A(X)$
is naturally isomorphic to $\bc_0(X)/\bd(\bc_1(X))) = H_0(\bc_*(X))$.

$\bc_2(X)$ is the space of all relations (redundancies) among the relations of $\bc_1(X)$.
More specifically, $\bc_2(X)$ is the space of all finite linear combinations of
2-blob diagrams (defined below), modulo the usual linear label relations.
\nn{and also modulo blob reordering relations?}

\nn{maybe include longer discussion to motivate the two sorts of 2-blob diagrams}

There are two types of 2-blob diagram: disjoint and nested.
A disjoint 2-blob diagram consists of
\begin{itemize}
\item A pair of disjoint closed balls (blobs) $B_0, B_1 \sub X$.
%\item Fields (boundary conditions) $c_i \in \cC(\bd B_i)$.
\item A field $r \in \cC(X \setmin (B_0 \cup B_1); c_0, c_1)$
(where $c_i \in \cC(\bd B_i)$).
\item Local relation fields $u_i \in U(B_i; c_i)$.
\end{itemize}
Define $\bd(B_0, B_1, r, u_0, u_1) = (B_1, ru_0, u_1) - (B_0, ru_1, u_0) \in \bc_1(X)$.
In other words, the boundary of a disjoint 2-blob diagram
is the sum (with alternating signs)
of the two ways of erasing one of the blobs.
It's easy to check that $\bd^2 = 0$.

A nested 2-blob diagram consists of
\begin{itemize}
\item A pair of nested balls (blobs) $B_0 \sub B_1 \sub X$.
\item A field $r \in \cC(X \setmin B_0; c_0)$
(for some $c_0 \in \cC(\bd B_0)$).
Let $r = r_1 \cup r'$, where $r_1 \in \cC(B_1 \setmin B_0; c_0, c_1)$
(for some $c_1 \in \cC(B_1)$) and
$r' \in \cC(X \setmin B_1; c_1)$.
\item A local relation field $u_0 \in U(B_0; c_0)$.
\end{itemize}
Define $\bd(B_0, B_1, r, u_0) = (B_1, r', r_1u_0) - (B_0, r, u_0)$.
Note that xxxx above guarantees that $r_1u_0 \in U(B_1)$.
As in the disjoint 2-blob case, the boundary of a nested 2-blob is the alternating
sum of the two ways of erasing one of the blobs.
If we erase the inner blob, the outer blob inherits the label $r_1u_0$.

Now for the general case.
A $k$-blob diagram consists of
\begin{itemize}
\item A collection of blobs $B_i \sub X$, $i = 0, \ldots, k-1$.
For each $i$ and $j$, we require that either $B_i \cap B_j$ is empty or
$B_i \sub B_j$ or $B_j \sub B_i$.
(The case $B_i = B_j$ is allowed.
If $B_i \sub B_j$ the boundaries of $B_i$ and $B_j$ are allowed to intersect.)
If a blob has no other blobs strictly contained in it, we call it a twig blob.
%\item Fields (boundary conditions) $c_i \in \cC(\bd B_i)$.
%(These are implied by the data in the next bullets, so we usually
%suppress them from the notation.)
%$c_i$ and $c_j$ must have identical restrictions to $\bd B_i \cap \bd B_j$
%if the latter space is not empty.
\item A field $r \in \cC(X \setmin B^t; c^t)$,
where $B^t$ is the union of all the twig blobs and $c^t \in \cC(\bd B^t)$.
\item For each twig blob $B_j$ a local relation field $u_j \in U(B_j; c_j)$,
where $c_j$ is the restriction of $c^t$ to $\bd B_j$.
If $B_i = B_j$ then $u_i = u_j$.
\end{itemize}

We define $\bc_k(X)$ to be the vector space of all finite linear combinations
of $k$-blob diagrams, modulo the linear label relations and
blob reordering relations defined in the remainder of this paragraph.
Let $x$ be a blob diagram with one undetermined $n$-morphism label.
The unlabeled entity is either a blob or a 0-cell outside of the twig blobs.
Let $a$ and $b$ be two possible $n$-morphism labels for
the unlabeled blob or 0-cell.
Let $c = \lambda a + b$.
Let $x_a$ be the blob diagram with label $a$, and define $x_b$ and $x_c$ similarly.
Then we impose the relation
\eq{
    x_c = \lambda x_a + x_b .
}
\nn{should do this in terms of direct sums of tensor products}
Let $x$ and $x'$ be two blob diagrams which differ only by a permutation $\pi$
of their blob labelings.
Then we impose the relation
\eq{
    x = \sign(\pi) x' .
}

(Alert readers will have noticed that for $k=2$ our definition
of $\bc_k(X)$ is slightly different from the previous definition
of $\bc_2(X)$ --- we did not impose the reordering relations.
The general definition takes precedence;
the earlier definition was simplified for purposes of exposition.)

The boundary map $\bd : \bc_k(X) \to \bc_{k-1}(X)$ is defined as follows.
Let $b = (\{B_i\}, r, \{u_j\})$ be a $k$-blob diagram.
Let $E_j(b)$ denote the result of erasing the $j$-th blob.
If $B_j$ is not a twig blob, this involves only decrementing
the indices of blobs $B_{j+1},\ldots,B_{k-1}$.
If $B_j$ is a twig blob, we have to assign new local relation labels
if removing $B_j$ creates new twig blobs.
If $B_l$ becomes a twig after removing $B_j$, then set $u_l = r_lu_j$,
where $r_l$ is the restriction of $r$ to $B_l \setmin B_j$.
Finally, define
\eq{
    \bd(b) = \sum_{j=0}^{k-1} (-1)^j E_j(b).
}
The $(-1)^j$ factors imply that the terms of $\bd^2(b)$ all cancel.
Thus we have a chain complex.

\nn{?? say something about the ``shape" of tree? (incl = cone, disj = product)}


\nn{TO DO:
expand definition to handle DGA and $A_\infty$ versions of $n$-categories;
relations to Chas-Sullivan string stuff}



\section{Basic properties of the blob complex}
\label{sec:basic-properties}

\begin{prop} \label{disjunion}
There is a natural isomorphism $\bc_*(X \du Y) \cong \bc_*(X) \otimes \bc_*(Y)$.
\end{prop}
\begin{proof}
Given blob diagrams $b_1$ on $X$ and $b_2$ on $Y$, we can combine them
(putting the $b_1$ blobs before the $b_2$ blobs in the ordering) to get a
blob diagram $(b_1, b_2)$ on $X \du Y$.
Because of the blob reordering relations, all blob diagrams on $X \du Y$ arise this way.
In the other direction, any blob diagram on $X\du Y$ is equal (up to sign)
to one that puts $X$ blobs before $Y$ blobs in the ordering, and so determines
a pair of blob diagrams on $X$ and $Y$.
These two maps are compatible with our sign conventions \nn{say more about this?} and
with the linear label relations.
The two maps are inverses of each other.
\nn{should probably say something about sign conventions for the differential
in a tensor product of chain complexes; ask Scott}
\end{proof}

For the next proposition we will temporarily restore $n$-manifold boundary
conditions to the notation.

Suppose that for all $c \in \cC(\bd B^n)$
we have a splitting $s: H_0(\bc_*(B^n, c)) \to \bc_0(B^n; c)$
of the quotient map
$p: \bc_0(B^n; c) \to H_0(\bc_*(B^n, c))$.
\nn{always the case if we're working over $\c$}.
Then
\begin{prop} \label{bcontract}
For all $c \in \cC(\bd B^n)$ the natural map $p: \bc_*(B^n, c) \to H_0(\bc_*(B^n, c))$
is a chain homotopy equivalence
with inverse $s: H_0(\bc_*(B^n, c)) \to \bc_*(B^n; c)$.
Here we think of $H_0(\bc_*(B^n, c))$ as a 1-step complex concentrated in degree 0.
\end{prop}
\begin{proof}
By assumption $p\circ s = \id$, so all that remains is to find a degree 1 map
$h : \bc_*(B^n; c) \to \bc_*(B^n; c)$ such that $\bd h + h\bd = \id - s \circ p$.
For $i \ge 1$, define $h_i : \bc_i(B^n; c) \to \bc_{i+1}(B^n; c)$ by adding
an $(i{+}1)$-st blob equal to all of $B^n$.
In other words, add a new outermost blob which encloses all of the others.
Define $h_0 : \bc_0(B^n; c) \to \bc_1(B^n; c)$ by setting $h_0(x)$ equal to
the 1-blob with blob $B^n$ and label $x - s(p(x)) \in U(B^n; c)$.
\nn{$x$ is a 0-blob diagram, i.e. $x \in \cC(B^n; c)$}
\end{proof}

(Note that for the above proof to work, we need the linear label relations
for blob labels.
Also we need to blob reordering relations (?).)

(Note also that if there is no splitting $s$, we can let $h_0 = 0$ and get a homotopy
equivalence to the 2-step complex $U(B^n; c) \to \cC(B^n; c)$.)

(For fields based on $n$-cats, $H_0(\bc_*(B^n; c)) \cong \mor(c', c'')$.)

\medskip

As we noted above,
\begin{prop}
There is a natural isomorphism $H_0(\bc_*(X)) \cong A(X)$.
\qed
\end{prop}


% oops -- duplicate

%\begin{prop} \label{functorialprop}
%The assignment $X \mapsto \bc_*(X)$ extends to a functor from the category of
%$n$-manifolds and homeomorphisms to the category of chain complexes and linear isomorphisms.
%\end{prop}

%\begin{proof}
%Obvious.
%\end{proof}

%\nn{need to same something about boundaries and boundary conditions above.
%maybe fix the boundary and consider the category of $n$-manifolds with the given boundary.}


\begin{prop}
For fixed fields ($n$-cat), $\bc_*$ is a functor from the category
of $n$-manifolds and diffeomorphisms to the category of chain complexes and
(chain map) isomorphisms.
\qed
\end{prop}

\nn{need to same something about boundaries and boundary conditions above.
maybe fix the boundary and consider the category of $n$-manifolds with the given boundary.}


In particular,
\begin{prop}  \label{diff0prop}
There is an action of $\Diff(X)$ on $\bc_*(X)$.
\qed
\end{prop}

The above will be greatly strengthened in Section \ref{sec:evaluation}.

\medskip

For the next proposition we will temporarily restore $n$-manifold boundary
conditions to the notation.

Let $X$ be an $n$-manifold, $\bd X = Y \cup (-Y) \cup Z$.
Gluing the two copies of $Y$ together yields an $n$-manifold $X\sgl$
with boundary $Z\sgl$.
Given compatible fields (pictures, boundary conditions) $a$, $b$ and $c$ on $Y$, $-Y$ and $Z$,
we have the blob complex $\bc_*(X; a, b, c)$.
If $b = -a$ (the orientation reversal of $a$), then we can glue up blob diagrams on
$X$ to get blob diagrams on $X\sgl$:

\begin{prop}
There is a natural chain map
\eq{
    \gl: \bigoplus_a \bc_*(X; a, -a, c) \to \bc_*(X\sgl; c\sgl).
}
The sum is over all fields $a$ on $Y$ compatible at their
($n{-}2$-dimensional) boundaries with $c$.
`Natural' means natural with respect to the actions of diffeomorphisms.
\qed
\end{prop}

The above map is very far from being an isomorphism, even on homology.
This will be fixed in Section \ref{sec:gluing} below.

An instance of gluing we will encounter frequently below is where $X = X_1 \du X_2$
and $X\sgl = X_1 \cup_Y X_2$.
(Typically one of $X_1$ or $X_2$ is a disjoint union of balls.)
For $x_i \in \bc_*(X_i)$, we introduce the notation
\eq{
    x_1 \bullet x_2 \deq \gl(x_1 \otimes x_2) .
}
Note that we have resumed our habit of omitting boundary labels from the notation.


\bigskip

\nn{what else?}

\section{Hochschild homology when $n=1$}
\label{sec:hochschild}
\input{text/hochschild}

\section{Action of $\CD{X}$}
\label{sec:evaluation}

Let $CD_*(X)$ denote $C_*(\Diff(X))$, the singular chain complex of
the space of diffeomorphisms
of the $n$-manifold $X$ (fixed on $\bd X$).
For convenience, we will permit the singular cells generating $CD_*(X)$ to be more general
than simplices --- they can be based on any linear polyhedron.
\nn{be more restrictive here?  does more need to be said?}

\begin{prop}  \label{CDprop}
For each $n$-manifold $X$ there is a chain map
\eq{
    e_X : CD_*(X) \otimes \bc_*(X) \to \bc_*(X) .
}
On $CD_0(X) \otimes \bc_*(X)$ it agrees with the obvious action of $\Diff(X)$ on $\bc_*(X)$
(Proposition (\ref{diff0prop})).
For any splitting $X = X_1 \cup X_2$, the following diagram commutes
\eq{ \xymatrix{
     CD_*(X) \otimes \bc_*(X) \ar[r]^{e_X}    & \bc_*(X) \\
     CD_*(X_1) \otimes CD_*(X_2) \otimes \bc_*(X_1) \otimes \bc_*(X_2)
        \ar@/_4ex/[r]_{e_{X_1} \otimes e_{X_2}}  \ar[u]^{\gl \otimes \gl}  &
            \bc_*(X_1) \otimes \bc_*(X_2) \ar[u]_{\gl}
} }
Any other map satisfying the above two properties is homotopic to $e_X$.
\end{prop}

\nn{need to rewrite for self-gluing instead of gluing two pieces together}

\nn{Should say something stronger about uniqueness.
Something like: there is
a contractible subcomplex of the complex of chain maps
$CD_*(X) \otimes \bc_*(X) \to \bc_*(X)$ (0-cells are the maps, 1-cells are homotopies, etc.),
and all choices in the construction lie in the 0-cells of this
contractible subcomplex.
Or maybe better to say any two choices are homotopic, and
any two homotopies and second order homotopic, and so on.}

\nn{Also need to say something about associativity.
Put it in the above prop or make it a separate prop?
I lean toward the latter.}
\medskip

The proof will occupy the remainder of this section.
\nn{unless we put associativity prop at end}

\medskip

Let $f: P \times X \to X$ be a family of diffeomorphisms and $S \sub X$.
We say that {\it $f$ is supported on $S$} if $f(p, x) = f(q, x)$ for all
$x \notin S$ and $p, q \in P$. Equivalently, $f$ is supported on $S$ if there is a family of diffeomorphisms $f' : P \times S \to S$ and a `background'
diffeomorphism $f_0 : X \to X$ so that
\begin{align}
	f(p,s) & = f_0(f'(p,s)) \;\;\;\; \mbox{for}\; (p, s) \in P\times S \\
\intertext{and}
	f(p,x) & = f_0(x) \;\;\;\; \mbox{for}\; (p, x) \in {P \times (X \setmin S)}.
\end{align}
Note that if $f$ is supported on $S$ then it is also supported on any $R \sup S$.

Let $\cU = \{U_\alpha\}$ be an open cover of $X$.
A $k$-parameter family of diffeomorphisms $f: P \times X \to X$ is
{\it adapted to $\cU$} if there is a factorization
\eq{
    P = P_1 \times \cdots \times P_m
}
(for some $m \le k$)
and families of diffeomorphisms
\eq{
    f_i :  P_i \times X \to X
}
such that
\begin{itemize}
\item each $f_i$ is supported on some connected $V_i \sub X$;
\item the sets $V_i$ are mutually disjoint;
\item each $V_i$ is the union of at most $k_i$ of the $U_\alpha$'s,
where $k_i = \dim(P_i)$; and
\item $f(p, \cdot) = g \circ f_1(p_1, \cdot) \circ \cdots \circ f_m(p_m, \cdot)$
for all $p = (p_1, \ldots, p_m)$, for some fixed $g \in \Diff(X)$.
\end{itemize}
A chain $x \in C_k(\Diff(X))$ is (by definition) adapted to $\cU$ if it is the sum
of singular cells, each of which is adapted to $\cU$.

\begin{lemma}  \label{extension_lemma}
Let $x \in CD_k(X)$ be a singular chain such that $\bd x$ is adapted to $\cU$.
Then $x$ is homotopic (rel boundary) to some $x' \in CD_k(X)$ which is adapted to $\cU$.
Furthermore, one can choose the homotopy so that its support is equal to the support of $x$.
\end{lemma}

The proof will be given in Section \ref{sec:localising}.

\medskip

The strategy for the proof of Proposition \ref{CDprop} is as follows.
We will identify a subcomplex
\[
    G_* \sub CD_*(X) \otimes \bc_*(X)
\]
on which the evaluation map is uniquely determined (up to homotopy) by the conditions
in \ref{CDprop}.
We then show that the inclusion of $G_*$ into the full complex
is an equivalence in the appropriate sense.
\nn{need to be more specific here}

Let $p$ be a singular cell in $CD_*(X)$ and $b$ be a blob diagram in $\bc_*(X)$.
Roughly speaking, $p\otimes b$ is in $G_*$ if each component $V$ of the support of $p$
intersects at most one blob $B$ of $b$.
Since $V \cup B$ might not itself be a ball, we need a more careful and complicated definition.
Choose a metric for $X$.
We define $p\otimes b$ to be in $G_*$ if there exist $\epsilon > 0$ such that
$\supp(p) \cup N_\epsilon(b)$ is a union of balls, where $N_\epsilon(b)$ denotes the epsilon
neighborhood of the support of $b$.
\nn{maybe also require that $N_\delta(b)$ is a union of balls for all $\delta<\epsilon$.}

\nn{need to worry about case where the intrinsic support of $p$ is not a union of balls.
probably we can just stipulate that it is (i.e. only consider families of diffeos with this property).
maybe we should build into the definition of ``adapted" that support takes up all of $U_i$.}

\nn{need to eventually show independence of choice of metric.  maybe there's a better way than
choosing a metric.  perhaps just choose a nbd of each ball, but I think I see problems
with that as well.
the bottom line is that we need a scheme for choosing unions of balls
which satisfies the $C$, $C'$, $C''$ claim made a few paragraphs below.}

Next we define the evaluation map $e_X$ on $G_*$.
We'll proceed inductively on $G_i$.
The induction starts on $G_0$, where the evaluation map is determined
by the action of $\Diff(X)$ on $\bc_*(X)$
because $G_0 \sub CD_0\otimes \bc_0$.
Assume we have defined the evaluation map up to $G_{k-1}$ and
let $p\otimes b$ be a generator of $G_k$.
Let $C \sub X$ be a union of balls (as described above) containing $\supp(p)\cup\supp(b)$.
There is a factorization $p = g \circ p'$, where $g\in \Diff(X)$ and $p'$ is a family of diffeomorphisms which is the identity outside of $C$.
Let $b = b'\bullet b''$, where $b' \in \bc_*(C)$ and $b'' \in \bc_0(X\setmin C)$.
We may assume inductively 
(cf the end of this paragraph)
that $e_X(\bd(p\otimes b))$ has a similar factorization $x\bullet g(b'')$, where
$x \in \bc_*(g(C))$ and $\bd x = 0$.
Since $\bc_*(g(C))$ is contractible, there exists $y \in \bc_*(g(C))$ such that $\bd y = x$.
Define $e_X(p\otimes b) = y\bullet g(b'')$.

We now show that $e_X$ on $G_*$ is, up to homotopy, independent of the various choices made.
If we make a different series of choice of the chain $y$ in the previous paragraph,
we can inductively construct a homotopy between the two sets of choices,
again relying on the contractibility of $\bc_*(g(G))$.
A similar argument shows that this homotopy is unique up to second order homotopy, and so on.

Given a different set of choices $\{C'\}$ of the unions of balls $\{C\}$,
we can find a third set of choices $\{C''\}$ such that $C, C' \sub C''$.
The argument now proceeds as in the previous paragraph.
\nn{should maybe say more here; also need to back up claim about third set of choices}
\nn{this definitely needs reworking}

Next we show that given $x \in CD_*(X) \otimes \bc_*(X)$ with $\bd x \in G_*$, there exists
a homotopy (rel $\bd x$) to $x' \in G_*$, and further that $x'$ and
this homotopy are unique up to iterated homotopy.

Given $k>0$ and a blob diagram $b$, we say that a cover $\cU$ of $X$ is $k$-compatible with
$b$ if, for any $\{U_1, \ldots, U_k\} \sub \cU$, the union
$U_1\cup\cdots\cup U_k$ is a union of balls which satisfies the condition used to define $G_*$ above.
It follows from Lemma \ref{extension_lemma}
that if $\cU$ is $k$-compatible with $b$ and
$p$ is a $k$-parameter family of diffeomorphisms which is adapted to $\cU$, then
$p\otimes b \in G_*$.
\nn{maybe emphasize this more; it's one of the main ideas in the proof}

Let $k$ be the degree of $x$ and choose a cover $\cU$ of $X$ such that $\cU$ is
$k$-compatible with each of the (finitely many) blob diagrams occurring in $x$.
We will use Lemma \ref{extension_lemma} with respect to the cover $\cU$ to
construct the homotopy to $G_*$.
First we will construct a homotopy $h \in G_*$ from $\bd x$ to a cycle $z$ such that
each family of diffeomorphisms $p$ occurring in $z$ is adapted to $\cU$.
Then we will construct a homotopy (rel boundary) $r$ from $x + h$ to $y$ such that
each family of diffeomorphisms $p$ occurring in $y$ is adapted to $\cU$.
This implies that $y \in G_*$.
The homotopy $r$ can also be thought of as a homotopy from $x$ to $y-h \in G_*$, and this is the homotopy we seek.

We will define $h$ inductively on bidegrees $(0, k-1), (1, k-2), \ldots, (k-1, 0)$.
Define $h$ to be zero on bidegree $(0, k-1)$.
Let $p\otimes b$ be a generator occurring in $\bd x$ with bidegree $(1, k-2)$.
Using Lemma \ref{extension_lemma}, construct a homotopy (rel $\bd$) $q$ from $p$ to $p'$ which is adapted to $\cU$.
Define $h$ at $p\otimes b$ to be $q\otimes b$.
Let $p'\otimes b'$ be a generator occurring in $\bd x$ with bidegree $(2, k-3)$.
Let $s$ denote the sum of the $q$'s from the previous step for generators
adjacent to $(\bd p')\otimes b'$.
\nn{need to say more here}
Apply Lemma \ref{extension_lemma} to $p'+s$
yielding a family of diffeos $q'$.
Define $h$ at $p'\otimes b'$ to be $q'\otimes b'$.
Continuing in this way, we define all of $h$.

The homotopy $r$ is constructed similarly.

\nn{need to say something about uniqueness of $r$, $h$ etc.
postpone this until second draft.}

At this point, we have finished defining the evaluation map.
The uniqueness statement in the proposition is clear from the method of proof.
All that remains is to show that the evaluation map gets along well with cutting and gluing,
as claimed in the proposition.
This is in fact not difficult, since the myriad choices involved in defining the
evaluation map can be made in parallel for the top and bottom
arrows in the commutative diagram.

This completes the proof of Proposition \ref{CDprop}.

\medskip

\nn{say something about associativity here}

\input{text/A-infty.tex}

\input{text/gluing.tex}



\section{Commutative algebras as $n$-categories}

\nn{this should probably not be a section by itself.  i'm just trying to write down the outline 
while it's still fresh in my mind.}

If $C$ is a commutative algebra it
can (and will) also be thought of as an $n$-category whose $j$-morphisms are trivial for
$j<n$ and whose $n$-morphisms are $C$. 
The goal of this \nn{subsection?} is to compute
$\bc_*(M^n, C)$ for various commutative algebras $C$.

Let $k[t]$ denote the ring of polynomials in $t$ with coefficients in $k$.

Let $\Sigma^i(M)$ denote the $i$-th symmetric power of $M$, the configuration space of $i$
unlabeled points in $M$.
Note that $\Sigma^0(M)$ is a point.
Let $\Sigma^\infty(M) = \coprod_{i=0}^\infty \Sigma^i(M)$.

Let $C_*(X, k)$ denote the singular chain complex of the space $X$ with coefficients in $k$.

\begin{prop} \label{sympowerprop}
$\bc_*(M, k[t])$ is homotopy equivalent to $C_*(\Sigma^\infty(M), k)$.
\end{prop}

\begin{proof}
To define the chain maps between the two complexes we will use the following lemma:

\begin{lemma}
Let $A_*$ and $B_*$ be chain complexes, and assume $A_*$ is equipped with
a basis (e.g.\ blob diagrams or singular simplices).
For each basis element $c \in A_*$ assume given a contractible subcomplex $R(c)_* \sub B_*$
such that $R(c')_* \sub R(c)_*$ whenever $c'$ is a basis element which is part of $\bd c$.
Then the complex of chain maps (and (iterated) homotopies) $f:A_*\to B_*$ such that
$f(c) \in R(c)_*$ for all $c$ is contractible (and in particular non-empty).
\end{lemma}

\begin{proof}
\nn{easy, but should probably write the details eventually}
\end{proof}

Our first task: For each blob diagram $b$ define a subcomplex $R(b)_* \sub C_*(\Sigma^\infty(M))$
satisfying the conditions of the above lemma.
If $b$ is a 0-blob diagram, then it is just a $k[t]$ field on $M$, which is a 
finite unordered collection of points of $M$ with multiplicities, which is
a point in $\Sigma^\infty(M)$.
Define $R(b)_*$ to be the singular chain complex of this point.
If $(B, u, r)$ is an $i$-blob diagram, let $D\sub M$ be its support (the union of the blobs).
The path components of $\Sigma^\infty(D)$ are contractible, and these components are indexed 
by the numbers of points in each component of $D$.
We may assume that the blob labels $u$ have homogeneous $t$ degree in $k[t]$, and so
$u$ picks out a component $X \sub \Sigma^\infty(D)$.
The field $r$ on $M\setminus D$ can be thought of as a point in $\Sigma^\infty(M\setminus D)$,
and using this point we can embed $X$ in $\Sigma^\infty(M)$.
Define $R(B, u, r)_*$ to be the singular chain complex of $X$, thought of as a 
subspace of $\Sigma^\infty(M)$.
It is easy to see that $R(\cdot)_*$ satisfies the condition on boundaries from the above lemma.
Thus we have defined (up to homotopy) a map from 
$\bc_*(M^n, k[t])$ to $C_*(\Sigma^\infty(M))$.

Next we define, for each simplex $c$ of $C_*(\Sigma^\infty(M))$, a contractible subspace
$R(c)_* \sub \bc_*(M^n, k[t])$.
If $c$ is a 0-simplex we use the identification of the fields $\cC(M)$ and 
$\Sigma^\infty(M)$ described above.
Now let $c$ be an $i$-simplex of $\Sigma^j(M)$.
Choose a metric on $M$, which induces a metric on $\Sigma^j(M)$.
We may assume that the diameter of $c$ is small --- that is, $C_*(\Sigma^j(M))$
is homotopy equivalent to the subcomplex of small simplices.
How small?  $(2r)/3j$, where $r$ is the radius of injectivity of the metric.
Let $T\sub M$ be the ``track" of $c$ in $M$.
\nn{do we need to define this precisely?}
Choose a neighborhood $D$ of $T$ which is a disjoint union of balls of small diameter.
\nn{need to say more precisely how small}
Define $R(c)_*$ to be $\bc_*(D, k[t]) \sub \bc_*(M^n, k[t])$.
This is contractible by \ref{bcontract}.
We can arrange that the boundary/inclusion condition is satisfied if we start with
low-dimensional simplices and work our way up.
\nn{need to be more precise}

\nn{still to do: show indep of choice of metric; show compositions are homotopic to the identity
(for this, might need a lemma that says we can assume that blob diameters are small)}
\end{proof}


\begin{prop} \label{ktcdprop}
The above maps are compatible with the evaluation map actions of $C_*(\Diff(M))$.
\end{prop}

\begin{proof}
The actions agree in degree 0, and both are compatible with gluing.
(cf. uniqueness statement in \ref{CDprop}.)
\end{proof}

\medskip

In view of \ref{hochthm}, we have proved that $HH_*(k[t]) \cong C_*(\Sigma^\infty(S^1), k)$,
and that the cyclic homology of $k[t]$ is related to the action of rotations
on $C_*(\Sigma^\infty(S^1), k)$.
\nn{probably should put a more precise statement about cyclic homology and $S^1$ actions in the Hochschild section}
Let us check this directly.

According to \nn{Loday, 3.2.2}, $HH_i(k[t]) \cong k[t]$ for $i=0,1$ and is zero for $i\ge 2$.
\nn{say something about $t$-degree?  is this in [Loday]?}

We can define a flow on $\Sigma^j(S^1)$ by having the points repel each other.
The fixed points of this flow are the equally spaced configurations.
This defines a map from $\Sigma^j(S^1)$ to $S^1/j$ ($S^1$ modulo a $2\pi/j$ rotation).
The fiber of this map is $\Delta^{j-1}$, the $(j-1)$-simplex, 
and the holonomy of the $\Delta^{j-1}$ bundle
over $S^1/j$ is induced by the cyclic permutation of its $j$ vertices.

In particular, $\Sigma^j(S^1)$ is homotopy equivalent to a circle for $j>0$, and
of course $\Sigma^0(S^1)$ is a point.
Thus the singular homology $H_i(\Sigma^\infty(S^1))$ has infinitely many generators for $i=0,1$
and is zero for $i\ge 2$.
\nn{say something about $t$-degrees also matching up?}

By xxxx and \ref{ktcdprop}, 
the cyclic homology of $k[t]$ is the $S^1$-equivariant homology of $\Sigma^\infty(S^1)$.
Up to homotopy, $S^1$ acts by $j$-fold rotation on $\Sigma^j(S^1) \simeq S^1/j$.
If $k = \z$, $\Sigma^j(S^1)$ contributes the homology of an infinite lens space: $\z$ in degree
0, $\z/j \z$ in odd degrees, and 0 in positive even degrees.
The point $\Sigma^0(S^1)$ contributes the homology of $BS^1$ which is $\z$ in even 
degrees and 0 in odd degrees.
This agrees with the calculation in \nn{Loday, 3.1.7}.

\medskip

Next we consider the case $C = k[t_1, \ldots, t_m]$, commutative polynomials in $m$ variables.
Let $\Sigma_m^\infty(M)$ be the $m$-colored infinite symmetric power of $M$, that is, configurations
of points on $M$ which can have any of $m$ distinct colors but are otherwise indistinguishable.
The components of $\Sigma_m^\infty(M)$ are indexed by $m$-tuples of natural numbers
corresponding to the number of points of each color of a configuration.
A proof similar to that of \ref{sympowerprop} shows that

\begin{prop}
$\bc_*(M, k[t_1, \ldots, t_m])$ is homotopy equivalent to $C_*(\Sigma_m^\infty(M), k)$.
\end{prop}

According to \nn{Loday, 3.2.2},
\[
	HH_n(k[t_1, \ldots, t_m]) \cong \Lambda^n(k^m) \otimes k[t_1, \ldots, t_m] .
\]
Let us check that this is also the singular homology of $\Sigma_m^\infty(S^1)$.
We will content ourselves with the case $k = \z$.
One can define a flow on $\Sigma_m^\infty(S^1)$ where points of the same color repel each other and points of different colors do not interact.
This shows that a component $X$ of $\Sigma_m^\infty(S^1)$ is homotopy equivalent
to the torus $(S^1)^l$, where $l$ is the number of non-zero entries in the $m$-tuple
corresponding to $X$.
The homology calculation we desire follows easily from this.

\nn{say something about cyclic homology in this case?  probably not necessary.}

\medskip

Next we consider the case $C = k[t]/t^l$ --- polynomials in $t$ with $t^l = 0$.
Define $\Delta_l \sub \Sigma^\infty(M)$ to be those configurations of points with $l$ or
more points coinciding.

\begin{prop}
$\bc_*(M, k[t]/t^l)$ is homotopy equivalent to $C_*(\Sigma^\infty(M), \Delta_l, k)$
(relative singular chains with coefficients in $k$).
\end{prop}

\begin{proof}
\nn{...}
\end{proof}

\nn{...}




\appendix

\section{Families of Diffeomorphisms}  \label{sec:localising}


Lo, the proof of Lemma (\ref{extension_lemma}):

\nn{should this be an appendix instead?}

\nn{for pedagogical reasons, should do $k=1,2$ cases first; probably do this in
later draft}

\nn{not sure what the best way to deal with boundary is; for now just give main argument, worry
about boundary later}

Recall that we are given
an open cover $\cU = \{U_\alpha\}$ and an
$x \in CD_k(X)$ such that $\bd x$ is adapted to $\cU$.
We must find a homotopy of $x$ (rel boundary) to some $x' \in CD_k(X)$ which is adapted to $\cU$.

Let $\{r_\alpha : X \to [0,1]\}$ be a partition of unity for $\cU$.

As a first approximation to the argument we will eventually make, let's replace $x$
with a single singular cell
\eq{
    f: P \times X \to X .
}
Also, we'll ignore for now issues around $\bd P$.

Our homotopy will have the form
\eqar{
    F: I \times P \times X &\to& X \\
    (t, p, x) &\mapsto& f(u(t, p, x), x)
}
for some function
\eq{
    u : I \times P \times X \to P .
}
First we describe $u$, then we argue that it does what we want it to do.

For each cover index $\alpha$ choose a cell decomposition $K_\alpha$ of $P$.
The various $K_\alpha$ should be in general position with respect to each other.
We will see below that the $K_\alpha$'s need to be sufficiently fine in order
to insure that $F$ above is a homotopy through diffeomorphisms of $X$ and not
merely a homotopy through maps $X\to X$.

Let $L$ be the union of all the $K_\alpha$'s.
$L$ is itself a cell decomposition of $P$.
\nn{next two sentences not needed?}
To each cell $a$ of $L$ we associate the tuple $(c_\alpha)$,
where $c_\alpha$ is the codimension of the cell of $K_\alpha$ which contains $c$.
Since the $K_\alpha$'s are in general position, we have $\sum c_\alpha \le k$.

Let $J$ denote the handle decomposition of $P$ corresponding to $L$.
Each $i$-handle $C$ of $J$ has an $i$-dimensional tangential coordinate and,
more importantly, a $k{-}i$-dimensional normal coordinate.

For each (top-dimensional) $k$-cell $c$ of each $K_\alpha$, choose a point $p_c \in c \sub P$.
Let $D$ be a $k$-handle of $J$, and let $D$ also denote the corresponding
$k$-cell of $L$.
To $D$ we associate the tuple $(c_\alpha)$ of $k$-cells of the $K_\alpha$'s
which contain $d$, and also the corresponding tuple $(p_{c_\alpha})$ of points in $P$.

For $p \in D$ we define
\eq{
    u(t, p, x) = (1-t)p + t \sum_\alpha r_\alpha(x) p_{c_\alpha} .
}
(Recall that $P$ is a single linear cell, so the weighted average of points of $P$
makes sense.)

So far we have defined $u(t, p, x)$ when $p$ lies in a $k$-handle of $J$.
For handles of $J$ of index less than $k$, we will define $u$ to
interpolate between the values on $k$-handles defined above.

If $p$ lies in a $k{-}1$-handle $E$, let $\eta : E \to [0,1]$ be the normal coordinate
of $E$.
In particular, $\eta$ is equal to 0 or 1 only at the intersection of $E$
with a $k$-handle.
Let $\beta$ be the index of the $K_\beta$ containing the $k{-}1$-cell
corresponding to $E$.
Let $q_0, q_1 \in P$ be the points associated to the two $k$-cells of $K_\beta$
adjacent to the $k{-}1$-cell corresponding to $E$.
For $p \in E$, define
\eq{
    u(t, p, x) = (1-t)p + t \left( \sum_{\alpha \ne \beta} r_\alpha(x) p_{c_\alpha}
            + r_\beta(x) (\eta(p) q_1 + (1-\eta(p)) q_0) \right) .
}

In general, for $E$ a $k{-}j$-handle, there is a normal coordinate
$\eta: E \to R$, where $R$ is some $j$-dimensional polyhedron.
The vertices of $R$ are associated to $k$-cells of the $K_\alpha$, and thence to points of $P$.
If we triangulate $R$ (without introducing new vertices), we can linearly extend
a map from the vertices of $R$ into $P$ to a map of all of $R$ into $P$.
Let $\cN$ be the set of all $\beta$ for which $K_\beta$ has a $k$-cell whose boundary meets
the $k{-}j$-cell corresponding to $E$.
For each $\beta \in \cN$, let $\{q_{\beta i}\}$ be the set of points in $P$ associated to the aforementioned $k$-cells.
Now define, for $p \in E$,
\eq{
    u(t, p, x) = (1-t)p + t \left(
            \sum_{\alpha \notin \cN} r_\alpha(x) p_{c_\alpha}
                + \sum_{\beta \in \cN} r_\beta(x) \left( \sum_i \eta_{\beta i}(p) \cdot q_{\beta i} \right)
             \right) .
}
Here $\eta_{\beta i}(p)$ is the weight given to $q_{\beta i}$ by the linear extension
mentioned above.

This completes the definition of $u: I \times P \times X \to P$.

\medskip

Next we verify that $u$ has the desired properties.

Since $u(0, p, x) = p$ for all $p\in P$ and $x\in X$, $F(0, p, x) = f(p, x)$ for all $p$ and $x$.
Therefore $F$ is a homotopy from $f$ to something.

Next we show that if the $K_\alpha$'s are sufficiently fine cell decompositions,
then $F$ is a homotopy through diffeomorphisms.
We must show that the derivative $\pd{F}{x}(t, p, x)$ is non-singular for all $(t, p, x)$.
We have
\eq{
%   \pd{F}{x}(t, p, x) = \pd{f}{x}(u(t, p, x), x) + \pd{f}{p}(u(t, p, x), x) \pd{u}{x}(t, p, x) .
    \pd{F}{x} = \pd{f}{x} + \pd{f}{p} \pd{u}{x} .
}
Since $f$ is a family of diffeomorphisms, $\pd{f}{x}$ is non-singular and
\nn{bounded away from zero, or something like that}.
(Recall that $X$ and $P$ are compact.)
Also, $\pd{f}{p}$ is bounded.
So if we can insure that $\pd{u}{x}$ is sufficiently small, we are done.
It follows from Equation xxxx above that $\pd{u}{x}$ depends on $\pd{r_\alpha}{x}$
(which is bounded)
and the differences amongst the various $p_{c_\alpha}$'s and $q_{\beta i}$'s.
These differences are small if the cell decompositions $K_\alpha$ are sufficiently fine.
This completes the proof that $F$ is a homotopy through diffeomorphisms.

\medskip

Next we show that for each handle $D \sub P$, $F(1, \cdot, \cdot) : D\times X \to X$
is a singular cell adapted to $\cU$.
This will complete the proof of the lemma.
\nn{except for boundary issues and the `$P$ is a cell' assumption}

Let $j$ be the codimension of $D$.
(Or rather, the codimension of its corresponding cell.  From now on we will not make a distinction
between handle and corresponding cell.)
Then $j = j_1 + \cdots + j_m$, $0 \le m \le k$,
where the $j_i$'s are the codimensions of the $K_\alpha$
cells of codimension greater than 0 which intersect to form $D$.
We will show that
if the relevant $U_\alpha$'s are disjoint, then
$F(1, \cdot, \cdot) : D\times X \to X$
is a product of singular cells of dimensions $j_1, \ldots, j_m$.
If some of the relevant $U_\alpha$'s intersect, then we will get a product of singular
cells whose dimensions correspond to a partition of the $j_i$'s.
We will consider some simple special cases first, then do the general case.

First consider the case $j=0$ (and $m=0$).
A quick look at Equation xxxx above shows that $u(1, p, x)$, and hence $F(1, p, x)$,
is independent of $p \in P$.
So the corresponding map $D \to \Diff(X)$ is constant.

Next consider the case $j = 1$ (and $m=1$, $j_1=1$).
Now Equation yyyy applies.
We can write $D = D'\times I$, where the normal coordinate $\eta$ is constant on $D'$.
It follows that the singular cell $D \to \Diff(X)$ can be written as a product
of a constant map $D' \to \Diff(X)$ and a singular 1-cell $I \to \Diff(X)$.
The singular 1-cell is supported on $U_\beta$, since $r_\beta = 0$ outside of this set.

Next case: $j=2$, $m=1$, $j_1 = 2$.
This is similar to the previous case, except that the normal bundle is 2-dimensional instead of
1-dimensional.
We have that $D \to \Diff(X)$ is a product of a constant singular $k{-}2$-cell
and a 2-cell with support $U_\beta$.

Next case: $j=2$, $m=2$, $j_1 = j_2 = 1$.
In this case the codimension 2 cell $D$ is the intersection of two
codimension 1 cells, from $K_\beta$ and $K_\gamma$.
We can write $D = D' \times I \times I$, where the normal coordinates are constant
on $D'$, and the two $I$ factors correspond to $\beta$ and $\gamma$.
If $U_\beta$ and $U_\gamma$ are disjoint, then we can factor $D$ into a constant $k{-}2$-cell and
two 1-cells, supported on $U_\beta$ and $U_\gamma$ respectively.
If $U_\beta$ and $U_\gamma$ intersect, then we can factor $D$ into a constant $k{-}2$-cell and
a 2-cell supported on $U_\beta \cup U_\gamma$.
\nn{need to check that this is true}

\nn{finally, general case...}

\nn{this completes proof}

\input{text/explicit.tex}

\input{text/obsolete.tex}

% ----------------------------------------------------------------
%\newcommand{\urlprefix}{}
\bibliographystyle{plain}
%Included for winedt:
%input "bibliography/bibliography.bib"
\bibliography{bibliography/bibliography}
% ----------------------------------------------------------------

This paper is available online at \arxiv{?????}, and at
\url{http://tqft.net/blobs},
and at \url{http://canyon23.net/math/}.

% A GTART necessity:
% \Addresses
% ----------------------------------------------------------------
\end{document}
% ----------------------------------------------------------------




%Recall that for $n$-category picture fields there is an evaluation map
%$m: \bc_0(B^n; c, c') \to \mor(c, c')$.
%If we regard $\mor(c, c')$ as a complex concentrated in degree 0, then this becomes a chain
%map $m: \bc_*(B^n; c, c') \to \mor(c, c')$.
